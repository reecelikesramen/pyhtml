{
  "version": 3,
  "sources": ["../client/src/pyhtml.core.ts", "../client/src/core/transports/base.ts", "../client/src/core/transports/webtransport.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/utf8.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/ExtData.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/DecodeError.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/int.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/timestamp.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/ExtensionCodec.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/typedArrays.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/Encoder.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/encode.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/utils/prettyByte.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/CachedKeyDecoder.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/Decoder.ts", "../client/node_modules/.pnpm/@msgpack+msgpack@3.1.3/node_modules/@msgpack/msgpack/src/decode.ts", "../client/src/core/transports/websocket.ts", "../client/src/core/transports/http.ts", "../client/src/core/transport-manager.ts", "../client/node_modules/.pnpm/morphdom@2.7.7/node_modules/morphdom/dist/morphdom-esm.js", "../client/src/core/dom-updater.ts", "../client/src/events/handler.ts", "../client/src/core/app.ts"],
  "sourcesContent": ["/**\n * PyHTML Core Bundle Entry Point\n * Production-optimized client with minimal footprint.\n * Excludes dev features: status overlay, error trace with source loading.\n */\nimport { PyHTMLApp } from './core/app';\n\nexport { PyHTMLApp, PyHTMLConfig } from './core/app';\nexport { TransportManager, TransportConfig } from './core/transport-manager';\nexport { DOMUpdater } from './core/dom-updater';\nexport * from './core/transports';\n\n// Auto-init\nconst app = new PyHTMLApp();\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => app.init());\n} else {\n    app.init();\n}\n\nexport { app };\n", "/**\n * Base transport interface for all transport implementations.\n */\nexport interface Transport {\n    /** Connect to the server */\n    connect(): Promise<void>;\n\n    /** Send a message to the server */\n    send(message: object): void;\n\n    /** Register a message handler */\n    onMessage(handler: MessageHandler): void;\n\n    /** Register a status change handler */\n    onStatusChange(handler: (connected: boolean) => void): void;\n\n    /** Disconnect from the server */\n    disconnect(): void;\n\n    /** Check if connected */\n    isConnected(): boolean;\n\n    /** Transport name for debugging */\n    readonly name: string;\n}\n\nexport type MessageHandler = (message: ServerMessage) => void;\n\nexport interface StackFrame {\n    filename: string;\n    lineno: number;\n    name: string;\n    line: string;\n    colno?: number;     // Python 3.11+ column start\n    end_colno?: number; // Python 3.11+ column end\n}\n\nexport interface ServerMessage {\n    type: 'update' | 'reload' | 'error' | 'console' | 'error_trace';\n    html?: string;\n    error?: string;\n    level?: 'info' | 'warn' | 'error';\n    lines?: string[];\n    trace?: StackFrame[];\n}\n\nexport interface ConsoleMessage {\n    type: 'console';\n    level: 'info' | 'warn' | 'error';\n    lines: string[];\n\n}\n\nexport type ClientMessage = EventMessage | RelocateMessage;\n\nexport interface EventMessage {\n    type: 'event';\n    handler: string;\n    path: string;\n    data: EventData;\n}\n\nexport interface RelocateMessage {\n    type: 'relocate';\n    path: string;\n}\n\nexport interface EventData {\n    type: string;\n    id?: string;\n    value?: string;\n    args?: Record<string, unknown>;\n    [key: string]: unknown;\n}\n\n/**\n * Abstract base class providing common transport functionality.\n */\nexport abstract class BaseTransport implements Transport {\n    protected messageHandlers: MessageHandler[] = [];\n    protected statusHandlers: ((connected: boolean) => void)[] = [];\n    protected connected = false;\n\n    abstract readonly name: string;\n    abstract connect(): Promise<void>;\n    abstract send(message: object): void;\n    abstract disconnect(): void;\n\n    onMessage(handler: MessageHandler): void {\n        this.messageHandlers.push(handler);\n    }\n\n    onStatusChange(handler: (connected: boolean) => void): void {\n        this.statusHandlers.push(handler);\n    }\n\n    isConnected(): boolean {\n        return this.connected;\n    }\n\n    protected notifyHandlers(message: ServerMessage): void {\n        for (const handler of this.messageHandlers) {\n            try {\n                handler(message);\n            } catch (e) {\n                console.error('PyHTML: Error in message handler', e);\n            }\n        }\n    }\n\n    protected notifyStatus(connected: boolean): void {\n        if (this.connected === connected) return;\n        this.connected = connected;\n        for (const handler of this.statusHandlers) {\n            try {\n                handler(connected);\n            } catch (e) {\n                console.error('PyHTML: Error in status handler', e);\n            }\n        }\n    }\n}\n", "import { BaseTransport, ServerMessage } from './base';\n\n/**\n * WebTransport implementation using the browser's native WebTransport API.\n * WebTransport provides lower latency than WebSocket via HTTP/3 and QUIC.\n */\nexport class WebTransportTransport extends BaseTransport {\n    readonly name = 'WebTransport';\n\n    private transport: WebTransport | null = null;\n    private writer: WritableStreamDefaultWriter<Uint8Array> | null = null;\n    private readonly url: string;\n    private encoder = new TextEncoder();\n    private decoder = new TextDecoder();\n\n    constructor(url?: string) {\n        super();\n        this.url = url || this.getDefaultUrl();\n    }\n\n    private getDefaultUrl(): string {\n        // WebTransport requires HTTPS\n        return `https://${window.location.host}/_pyhtml/webtransport`;\n    }\n\n    /**\n     * Check if WebTransport is available in this browser.\n     */\n    static isSupported(): boolean {\n        return typeof WebTransport !== 'undefined';\n    }\n\n    async connect(): Promise<void> {\n        if (!WebTransportTransport.isSupported()) {\n            throw new Error('WebTransport not supported in this browser');\n        }\n\n        try {\n            // Check for self-signed cert hash (Dev Mode)\n            const options: any = {};\n            const certHash = (window as any).PYHTML_CERT_HASH;\n            if (certHash && Array.isArray(certHash)) {\n                options.serverCertificateHashes = [{\n                    algorithm: 'sha-256',\n                    value: new Uint8Array(certHash)\n                }];\n                console.log(\"PyHTML: Using explicit certificate hash for WebTransport\");\n            }\n\n            this.transport = new WebTransport(this.url, options);\n\n            // Wait for the connection to be ready\n            await this.transport.ready;\n\n            console.log('PyHTML: WebTransport ready');\n            this.connected = true;\n\n            // Start reading incoming streams\n            this.startReading();\n\n        } catch (e) {\n            this.handleDisconnect();\n            throw e;\n        }\n    }\n\n    private async startReading(): Promise<void> {\n        if (!this.transport) return;\n\n        // Read from bidirectional streams\n        const reader = this.transport.incomingBidirectionalStreams.getReader();\n\n        try {\n            while (true) {\n                const { value: stream, done } = await reader.read();\n                if (done) break;\n\n                // Handle each incoming stream\n                this.handleStream(stream);\n            }\n        } catch (e) {\n            if (this.connected) {\n                console.error('PyHTML: WebTransport read error', e);\n                this.handleDisconnect();\n            }\n        }\n    }\n\n    private async handleStream(stream: WebTransportBidirectionalStream): Promise<void> {\n        const reader = stream.readable.getReader();\n\n        try {\n            while (true) {\n                const { value, done } = await reader.read();\n                if (done) break;\n\n                if (value) {\n                    const text = this.decoder.decode(value);\n                    try {\n                        const msg = JSON.parse(text) as ServerMessage;\n                        this.notifyHandlers(msg);\n                    } catch (e) {\n                        console.error('PyHTML: Error parsing WebTransport message', e);\n                    }\n                }\n            }\n        } catch (e) {\n            console.error('PyHTML: Stream read error', e);\n        }\n    }\n\n    async send(message: object): Promise<void> {\n        if (!this.transport || !this.connected) {\n            console.warn('PyHTML: Cannot send message, WebTransport not connected');\n            return;\n        }\n\n        try {\n            // Create a new bidirectional stream for each message\n            const stream = await this.transport.createBidirectionalStream();\n            const writer = stream.writable.getWriter();\n\n            const data = this.encoder.encode(JSON.stringify(message));\n            await writer.write(data);\n            await writer.close();\n\n            // Read the response from this stream\n            this.handleStream(stream);\n\n        } catch (e) {\n            console.error('PyHTML: WebTransport send error', e);\n        }\n    }\n\n    disconnect(): void {\n        if (this.transport) {\n            this.transport.close();\n            this.transport = null;\n        }\n        this.writer = null;\n        this.connected = false;\n    }\n\n    private handleDisconnect(): void {\n        this.connected = false;\n        this.transport = null;\n        this.writer = null;\n    }\n}\n", "export function utf8Count(str: string): number {\n  const strLength = str.length;\n\n  let byteLength = 0;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      byteLength++;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      byteLength += 2;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        byteLength += 3;\n      } else {\n        // 4-byte\n        byteLength += 4;\n      }\n    }\n  }\n  return byteLength;\n}\n\nexport function utf8EncodeJs(str: string, output: Uint8Array, outputOffset: number): void {\n  const strLength = str.length;\n  let offset = outputOffset;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      output[offset++] = value;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      output[offset++] = ((value >> 6) & 0x1f) | 0xc0;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        output[offset++] = ((value >> 12) & 0x0f) | 0xe0;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      } else {\n        // 4-byte\n        output[offset++] = ((value >> 18) & 0x07) | 0xf0;\n        output[offset++] = ((value >> 12) & 0x3f) | 0x80;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      }\n    }\n\n    output[offset++] = (value & 0x3f) | 0x80;\n  }\n}\n\n// TextEncoder and TextDecoder are standardized in whatwg encoding:\n// https://encoding.spec.whatwg.org/\n// and available in all the modern browsers:\n// https://caniuse.com/textencoder\n// They are available in Node.js since v12 LTS as well:\n// https://nodejs.org/api/globals.html#textencoder\n\nconst sharedTextEncoder = new TextEncoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/encode-string.ts` for details.\nconst TEXT_ENCODER_THRESHOLD = 50;\n\nexport function utf8EncodeTE(str: string, output: Uint8Array, outputOffset: number): void {\n  sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));\n}\n\nexport function utf8Encode(str: string, output: Uint8Array, outputOffset: number): void {\n  if (str.length > TEXT_ENCODER_THRESHOLD) {\n    utf8EncodeTE(str, output, outputOffset);\n  } else {\n    utf8EncodeJs(str, output, outputOffset);\n  }\n}\n\nconst CHUNK_SIZE = 0x1_000;\n\nexport function utf8DecodeJs(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  let offset = inputOffset;\n  const end = offset + byteLength;\n\n  const units: Array<number> = [];\n  let result = \"\";\n  while (offset < end) {\n    const byte1 = bytes[offset++]!;\n    if ((byte1 & 0x80) === 0) {\n      // 1 byte\n      units.push(byte1);\n    } else if ((byte1 & 0xe0) === 0xc0) {\n      // 2 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 6) | byte2);\n    } else if ((byte1 & 0xf0) === 0xe0) {\n      // 3 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3);\n    } else if ((byte1 & 0xf8) === 0xf0) {\n      // 4 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      const byte4 = bytes[offset++]! & 0x3f;\n      let unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4;\n      if (unit > 0xffff) {\n        unit -= 0x10000;\n        units.push(((unit >>> 10) & 0x3ff) | 0xd800);\n        unit = 0xdc00 | (unit & 0x3ff);\n      }\n      units.push(unit);\n    } else {\n      units.push(byte1);\n    }\n\n    if (units.length >= CHUNK_SIZE) {\n      result += String.fromCharCode(...units);\n      units.length = 0;\n    }\n  }\n\n  if (units.length > 0) {\n    result += String.fromCharCode(...units);\n  }\n\n  return result;\n}\n\nconst sharedTextDecoder = new TextDecoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/decode-string.ts` for details.\nconst TEXT_DECODER_THRESHOLD = 200;\n\nexport function utf8DecodeTD(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  const stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);\n  return sharedTextDecoder.decode(stringBytes);\n}\n\nexport function utf8Decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  if (byteLength > TEXT_DECODER_THRESHOLD) {\n    return utf8DecodeTD(bytes, inputOffset, byteLength);\n  } else {\n    return utf8DecodeJs(bytes, inputOffset, byteLength);\n  }\n}\n", "/**\n * ExtData is used to handle Extension Types that are not registered to ExtensionCodec.\n */\nexport class ExtData {\n  readonly type: number;\n  readonly data: Uint8Array | ((pos: number) => Uint8Array);\n\n  constructor(type: number, data: Uint8Array | ((pos: number) => Uint8Array)) {\n    this.type = type;\n    this.data = data;\n  }\n}\n", "export class DecodeError extends Error {\n  constructor(message: string) {\n    super(message);\n\n    // fix the prototype chain in a cross-platform way\n    const proto: typeof DecodeError.prototype = Object.create(DecodeError.prototype);\n    Object.setPrototypeOf(this, proto);\n\n    Object.defineProperty(this, \"name\", {\n      configurable: true,\n      enumerable: false,\n      value: DecodeError.name,\n    });\n  }\n}\n", "// Integer Utility\n\nexport const UINT32_MAX = 0xffff_ffff;\n\n// DataView extension to handle int64 / uint64,\n// where the actual range is 53-bits integer (a.k.a. safe integer)\n\nexport function setUint64(view: DataView, offset: number, value: number): void {\n  const high = value / 0x1_0000_0000;\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function setInt64(view: DataView, offset: number, value: number): void {\n  const high = Math.floor(value / 0x1_0000_0000);\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function getInt64(view: DataView, offset: number): number {\n  const high = view.getInt32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n\nexport function getUint64(view: DataView, offset: number): number {\n  const high = view.getUint32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n", "// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.ts\";\nimport { getInt64, setInt64 } from \"./utils/int.ts\";\n\nexport const EXT_TIMESTAMP = -1;\n\nexport type TimeSpec = {\n  sec: number;\n  nsec: number;\n};\n\nconst TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nconst TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\n\nexport function encodeTimeSpecToTimestamp({ sec, nsec }: TimeSpec): Uint8Array {\n  if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n    // Here sec >= 0 && nsec >= 0\n    if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n      // timestamp 32 = { sec32 (unsigned) }\n      const rv = new Uint8Array(4);\n      const view = new DataView(rv.buffer);\n      view.setUint32(0, sec);\n      return rv;\n    } else {\n      // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n      const secHigh = sec / 0x100000000;\n      const secLow = sec & 0xffffffff;\n      const rv = new Uint8Array(8);\n      const view = new DataView(rv.buffer);\n      // nsec30 | secHigh2\n      view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n      // secLow32\n      view.setUint32(4, secLow);\n      return rv;\n    }\n  } else {\n    // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n    const rv = new Uint8Array(12);\n    const view = new DataView(rv.buffer);\n    view.setUint32(0, nsec);\n    setInt64(view, 4, sec);\n    return rv;\n  }\n}\n\nexport function encodeDateToTimeSpec(date: Date): TimeSpec {\n  const msec = date.getTime();\n  const sec = Math.floor(msec / 1e3);\n  const nsec = (msec - sec * 1e3) * 1e6;\n\n  // Normalizes { sec, nsec } to ensure nsec is unsigned.\n  const nsecInSec = Math.floor(nsec / 1e9);\n  return {\n    sec: sec + nsecInSec,\n    nsec: nsec - nsecInSec * 1e9,\n  };\n}\n\nexport function encodeTimestampExtension(object: unknown): Uint8Array | null {\n  if (object instanceof Date) {\n    const timeSpec = encodeDateToTimeSpec(object);\n    return encodeTimeSpecToTimestamp(timeSpec);\n  } else {\n    return null;\n  }\n}\n\nexport function decodeTimestampToTimeSpec(data: Uint8Array): TimeSpec {\n  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  // data may be 32, 64, or 96 bits\n  switch (data.byteLength) {\n    case 4: {\n      // timestamp 32 = { sec32 }\n      const sec = view.getUint32(0);\n      const nsec = 0;\n      return { sec, nsec };\n    }\n    case 8: {\n      // timestamp 64 = { nsec30, sec34 }\n      const nsec30AndSecHigh2 = view.getUint32(0);\n      const secLow32 = view.getUint32(4);\n      const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n      const nsec = nsec30AndSecHigh2 >>> 2;\n      return { sec, nsec };\n    }\n    case 12: {\n      // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n\n      const sec = getInt64(view, 4);\n      const nsec = view.getUint32(0);\n      return { sec, nsec };\n    }\n    default:\n      throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`);\n  }\n}\n\nexport function decodeTimestampExtension(data: Uint8Array): Date {\n  const timeSpec = decodeTimestampToTimeSpec(data);\n  return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\n\nexport const timestampExtension = {\n  type: EXT_TIMESTAMP,\n  encode: encodeTimestampExtension,\n  decode: decodeTimestampExtension,\n};\n", "// ExtensionCodec to handle MessagePack extensions\n\nimport { ExtData } from \"./ExtData.ts\";\nimport { timestampExtension } from \"./timestamp.ts\";\n\nexport type ExtensionDecoderType<ContextType> = (\n  data: Uint8Array,\n  extensionType: number,\n  context: ContextType,\n) => unknown;\n\nexport type ExtensionEncoderType<ContextType> = (\n  input: unknown,\n  context: ContextType,\n) => Uint8Array | ((dataPos: number) => Uint8Array) | null;\n\n// immutable interface to ExtensionCodec\nexport type ExtensionCodecType<ContextType> = {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n  tryToEncode(object: unknown, context: ContextType): ExtData | null;\n  decode(data: Uint8Array, extType: number, context: ContextType): unknown;\n};\n\nexport class ExtensionCodec<ContextType = undefined> implements ExtensionCodecType<ContextType> {\n  public static readonly defaultCodec: ExtensionCodecType<undefined> = new ExtensionCodec();\n\n  // ensures ExtensionCodecType<X> matches ExtensionCodec<X>\n  // this will make type errors a lot more clear\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n\n  // built-in extensions\n  private readonly builtInEncoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly builtInDecoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  // custom extensions\n  private readonly encoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly decoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  public constructor() {\n    this.register(timestampExtension);\n  }\n\n  public register({\n    type,\n    encode,\n    decode,\n  }: {\n    type: number;\n    encode: ExtensionEncoderType<ContextType>;\n    decode: ExtensionDecoderType<ContextType>;\n  }): void {\n    if (type >= 0) {\n      // custom extensions\n      this.encoders[type] = encode;\n      this.decoders[type] = decode;\n    } else {\n      // built-in extensions\n      const index = -1 - type;\n      this.builtInEncoders[index] = encode;\n      this.builtInDecoders[index] = decode;\n    }\n  }\n\n  public tryToEncode(object: unknown, context: ContextType): ExtData | null {\n    // built-in extensions\n    for (let i = 0; i < this.builtInEncoders.length; i++) {\n      const encodeExt = this.builtInEncoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = -1 - i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    // custom extensions\n    for (let i = 0; i < this.encoders.length; i++) {\n      const encodeExt = this.encoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    if (object instanceof ExtData) {\n      // to keep ExtData as is\n      return object;\n    }\n    return null;\n  }\n\n  public decode(data: Uint8Array, type: number, context: ContextType): unknown {\n    const decodeExt = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];\n    if (decodeExt) {\n      return decodeExt(data, type, context);\n    } else {\n      // decode() does not fail, returns ExtData instead.\n      return new ExtData(type, data);\n    }\n  }\n}\n", "function isArrayBufferLike(buffer: unknown): buffer is ArrayBufferLike {\n  return (\n    buffer instanceof ArrayBuffer || (typeof SharedArrayBuffer !== \"undefined\" && buffer instanceof SharedArrayBuffer)\n  );\n}\n\nexport function ensureUint8Array(\n  buffer: ArrayLike<number> | Uint8Array<ArrayBufferLike> | ArrayBufferView | ArrayBufferLike,\n): Uint8Array<ArrayBufferLike> {\n  if (buffer instanceof Uint8Array) {\n    return buffer;\n  } else if (ArrayBuffer.isView(buffer)) {\n    return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n  } else if (isArrayBufferLike(buffer)) {\n    return new Uint8Array(buffer);\n  } else {\n    // ArrayLike<number>\n    return Uint8Array.from(buffer);\n  }\n}\n", "import { utf8Count, utf8Encode } from \"./utils/utf8.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { setInt64, setUint64 } from \"./utils/int.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport type { ExtData } from \"./ExtData.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\n\nexport const DEFAULT_MAX_DEPTH = 100;\nexport const DEFAULT_INITIAL_BUFFER_SIZE = 2048;\n\nexport type EncoderOptions<ContextType = undefined> = Partial<\n  Readonly<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Encodes bigint as Int64 or Uint64 if it's set to true.\n     * {@link forceIntegerToFloat} does not affect bigint.\n     * Depends on ES2020's {@link DataView#setBigInt64} and\n     * {@link DataView#setBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * The maximum depth in nested objects and arrays.\n     *\n     * Defaults to 100.\n     */\n    maxDepth: number;\n\n    /**\n     * The initial size of the internal buffer.\n     *\n     * Defaults to 2048.\n     */\n    initialBufferSize: number;\n\n    /**\n     * If `true`, the keys of an object is sorted. In other words, the encoded\n     * binary is canonical and thus comparable to another encoded binary.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    sortKeys: boolean;\n    /**\n     * If `true`, non-integer numbers are encoded in float32, not in float64 (the default).\n     *\n     * Only use it if precisions don't matter.\n     *\n     * Defaults to `false`.\n     */\n    forceFloat32: boolean;\n\n    /**\n     * If `true`, an object property with `undefined` value are ignored.\n     * e.g. `{ foo: undefined }` will be encoded as `{}`, as `JSON.stringify()` does.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    ignoreUndefined: boolean;\n\n    /**\n     * If `true`, integer numbers are encoded as floating point numbers,\n     * with the `forceFloat32` option taken into account.\n     *\n     * Defaults to `false`.\n     */\n    forceIntegerToFloat: boolean;\n  }>\n> &\n  ContextOf<ContextType>;\n\nexport class Encoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly maxDepth: number;\n  private readonly initialBufferSize: number;\n  private readonly sortKeys: boolean;\n  private readonly forceFloat32: boolean;\n  private readonly ignoreUndefined: boolean;\n  private readonly forceIntegerToFloat: boolean;\n\n  private pos: number;\n  private view: DataView<ArrayBuffer>;\n  private bytes: Uint8Array<ArrayBuffer>;\n\n  private entered = false;\n\n  public constructor(options?: EncoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.maxDepth = options?.maxDepth ?? DEFAULT_MAX_DEPTH;\n    this.initialBufferSize = options?.initialBufferSize ?? DEFAULT_INITIAL_BUFFER_SIZE;\n    this.sortKeys = options?.sortKeys ?? false;\n    this.forceFloat32 = options?.forceFloat32 ?? false;\n    this.ignoreUndefined = options?.ignoreUndefined ?? false;\n    this.forceIntegerToFloat = options?.forceIntegerToFloat ?? false;\n\n    this.pos = 0;\n    this.view = new DataView(new ArrayBuffer(this.initialBufferSize));\n    this.bytes = new Uint8Array(this.view.buffer);\n  }\n\n  private clone() {\n    // Because of slightly special argument `context`,\n    // type assertion is needed.\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Encoder<ContextType>({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      maxDepth: this.maxDepth,\n      initialBufferSize: this.initialBufferSize,\n      sortKeys: this.sortKeys,\n      forceFloat32: this.forceFloat32,\n      ignoreUndefined: this.ignoreUndefined,\n      forceIntegerToFloat: this.forceIntegerToFloat,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.pos = 0;\n  }\n\n  /**\n   * This is almost equivalent to {@link Encoder#encode}, but it returns an reference of the encoder's internal buffer and thus much faster than {@link Encoder#encode}.\n   *\n   * @returns Encodes the object and returns a shared reference the encoder's internal buffer.\n   */\n  public encodeSharedRef(object: unknown): Uint8Array<ArrayBuffer> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encodeSharedRef(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.subarray(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  /**\n   * @returns Encodes the object and returns a copy of the encoder's internal buffer.\n   */\n  public encode(object: unknown): Uint8Array<ArrayBuffer> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encode(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.slice(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doEncode(object: unknown, depth: number): void {\n    if (depth > this.maxDepth) {\n      throw new Error(`Too deep objects in depth ${depth}`);\n    }\n\n    if (object == null) {\n      this.encodeNil();\n    } else if (typeof object === \"boolean\") {\n      this.encodeBoolean(object);\n    } else if (typeof object === \"number\") {\n      if (!this.forceIntegerToFloat) {\n        this.encodeNumber(object);\n      } else {\n        this.encodeNumberAsFloat(object);\n      }\n    } else if (typeof object === \"string\") {\n      this.encodeString(object);\n    } else if (this.useBigInt64 && typeof object === \"bigint\") {\n      this.encodeBigInt64(object);\n    } else {\n      this.encodeObject(object, depth);\n    }\n  }\n\n  private ensureBufferSizeToWrite(sizeToWrite: number) {\n    const requiredSize = this.pos + sizeToWrite;\n\n    if (this.view.byteLength < requiredSize) {\n      this.resizeBuffer(requiredSize * 2);\n    }\n  }\n\n  private resizeBuffer(newSize: number) {\n    const newBuffer = new ArrayBuffer(newSize);\n    const newBytes = new Uint8Array(newBuffer);\n    const newView = new DataView(newBuffer);\n\n    newBytes.set(this.bytes);\n\n    this.view = newView;\n    this.bytes = newBytes;\n  }\n\n  private encodeNil() {\n    this.writeU8(0xc0);\n  }\n\n  private encodeBoolean(object: boolean) {\n    if (object === false) {\n      this.writeU8(0xc2);\n    } else {\n      this.writeU8(0xc3);\n    }\n  }\n\n  private encodeNumber(object: number): void {\n    if (!this.forceIntegerToFloat && Number.isSafeInteger(object)) {\n      if (object >= 0) {\n        if (object < 0x80) {\n          // positive fixint\n          this.writeU8(object);\n        } else if (object < 0x100) {\n          // uint 8\n          this.writeU8(0xcc);\n          this.writeU8(object);\n        } else if (object < 0x10000) {\n          // uint 16\n          this.writeU8(0xcd);\n          this.writeU16(object);\n        } else if (object < 0x100000000) {\n          // uint 32\n          this.writeU8(0xce);\n          this.writeU32(object);\n        } else if (!this.useBigInt64) {\n          // uint 64\n          this.writeU8(0xcf);\n          this.writeU64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      } else {\n        if (object >= -0x20) {\n          // negative fixint\n          this.writeU8(0xe0 | (object + 0x20));\n        } else if (object >= -0x80) {\n          // int 8\n          this.writeU8(0xd0);\n          this.writeI8(object);\n        } else if (object >= -0x8000) {\n          // int 16\n          this.writeU8(0xd1);\n          this.writeI16(object);\n        } else if (object >= -0x80000000) {\n          // int 32\n          this.writeU8(0xd2);\n          this.writeI32(object);\n        } else if (!this.useBigInt64) {\n          // int 64\n          this.writeU8(0xd3);\n          this.writeI64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      }\n    } else {\n      this.encodeNumberAsFloat(object);\n    }\n  }\n\n  private encodeNumberAsFloat(object: number): void {\n    if (this.forceFloat32) {\n      // float 32\n      this.writeU8(0xca);\n      this.writeF32(object);\n    } else {\n      // float 64\n      this.writeU8(0xcb);\n      this.writeF64(object);\n    }\n  }\n\n  private encodeBigInt64(object: bigint): void {\n    if (object >= BigInt(0)) {\n      // uint 64\n      this.writeU8(0xcf);\n      this.writeBigUint64(object);\n    } else {\n      // int 64\n      this.writeU8(0xd3);\n      this.writeBigInt64(object);\n    }\n  }\n\n  private writeStringHeader(byteLength: number) {\n    if (byteLength < 32) {\n      // fixstr\n      this.writeU8(0xa0 + byteLength);\n    } else if (byteLength < 0x100) {\n      // str 8\n      this.writeU8(0xd9);\n      this.writeU8(byteLength);\n    } else if (byteLength < 0x10000) {\n      // str 16\n      this.writeU8(0xda);\n      this.writeU16(byteLength);\n    } else if (byteLength < 0x100000000) {\n      // str 32\n      this.writeU8(0xdb);\n      this.writeU32(byteLength);\n    } else {\n      throw new Error(`Too long string: ${byteLength} bytes in UTF-8`);\n    }\n  }\n\n  private encodeString(object: string) {\n    const maxHeaderSize = 1 + 4;\n\n    const byteLength = utf8Count(object);\n    this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);\n    this.writeStringHeader(byteLength);\n    utf8Encode(object, this.bytes, this.pos);\n    this.pos += byteLength;\n  }\n\n  private encodeObject(object: unknown, depth: number) {\n    // try to encode objects with custom codec first of non-primitives\n    const ext = this.extensionCodec.tryToEncode(object, this.context);\n    if (ext != null) {\n      this.encodeExtension(ext);\n    } else if (Array.isArray(object)) {\n      this.encodeArray(object, depth);\n    } else if (ArrayBuffer.isView(object)) {\n      this.encodeBinary(object);\n    } else if (typeof object === \"object\") {\n      this.encodeMap(object as Record<string, unknown>, depth);\n    } else {\n      // symbol, function and other special object come here unless extensionCodec handles them.\n      throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(object)}`);\n    }\n  }\n\n  private encodeBinary(object: ArrayBufferView) {\n    const size = object.byteLength;\n    if (size < 0x100) {\n      // bin 8\n      this.writeU8(0xc4);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // bin 16\n      this.writeU8(0xc5);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // bin 32\n      this.writeU8(0xc6);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large binary: ${size}`);\n    }\n    const bytes = ensureUint8Array(object);\n    this.writeU8a(bytes);\n  }\n\n  private encodeArray(object: Array<unknown>, depth: number) {\n    const size = object.length;\n    if (size < 16) {\n      // fixarray\n      this.writeU8(0x90 + size);\n    } else if (size < 0x10000) {\n      // array 16\n      this.writeU8(0xdc);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // array 32\n      this.writeU8(0xdd);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large array: ${size}`);\n    }\n    for (const item of object) {\n      this.doEncode(item, depth + 1);\n    }\n  }\n\n  private countWithoutUndefined(object: Record<string, unknown>, keys: ReadonlyArray<string>): number {\n    let count = 0;\n\n    for (const key of keys) {\n      if (object[key] !== undefined) {\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  private encodeMap(object: Record<string, unknown>, depth: number) {\n    const keys = Object.keys(object);\n    if (this.sortKeys) {\n      keys.sort();\n    }\n\n    const size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;\n\n    if (size < 16) {\n      // fixmap\n      this.writeU8(0x80 + size);\n    } else if (size < 0x10000) {\n      // map 16\n      this.writeU8(0xde);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // map 32\n      this.writeU8(0xdf);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large map object: ${size}`);\n    }\n\n    for (const key of keys) {\n      const value = object[key];\n\n      if (!(this.ignoreUndefined && value === undefined)) {\n        this.encodeString(key);\n        this.doEncode(value, depth + 1);\n      }\n    }\n  }\n\n  private encodeExtension(ext: ExtData) {\n    if (typeof ext.data === \"function\") {\n      const data = ext.data(this.pos + 6);\n      const size = data.length;\n\n      if (size >= 0x100000000) {\n        throw new Error(`Too large extension object: ${size}`);\n      }\n\n      this.writeU8(0xc9);\n      this.writeU32(size);\n      this.writeI8(ext.type);\n      this.writeU8a(data);\n      return;\n    }\n\n    const size = ext.data.length;\n    if (size === 1) {\n      // fixext 1\n      this.writeU8(0xd4);\n    } else if (size === 2) {\n      // fixext 2\n      this.writeU8(0xd5);\n    } else if (size === 4) {\n      // fixext 4\n      this.writeU8(0xd6);\n    } else if (size === 8) {\n      // fixext 8\n      this.writeU8(0xd7);\n    } else if (size === 16) {\n      // fixext 16\n      this.writeU8(0xd8);\n    } else if (size < 0x100) {\n      // ext 8\n      this.writeU8(0xc7);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // ext 16\n      this.writeU8(0xc8);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // ext 32\n      this.writeU8(0xc9);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large extension object: ${size}`);\n    }\n    this.writeI8(ext.type);\n    this.writeU8a(ext.data);\n  }\n\n  private writeU8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setUint8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU8a(values: ArrayLike<number>) {\n    const size = values.length;\n    this.ensureBufferSizeToWrite(size);\n\n    this.bytes.set(values, this.pos);\n    this.pos += size;\n  }\n\n  private writeI8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setInt8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setUint16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeI16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setInt16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeU32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setUint32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeI32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setInt32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setFloat32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setFloat64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeU64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setUint64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeI64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setInt64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigUint64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigUint64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigInt64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigInt64(this.pos, value);\n    this.pos += 8;\n  }\n}\n", "import { Encoder } from \"./Encoder.ts\";\nimport type { EncoderOptions } from \"./Encoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It encodes `value` in the MessagePack format and\n * returns a byte buffer.\n *\n * The returned buffer is a slice of a larger `ArrayBuffer`, so you have to use its `#byteOffset` and `#byteLength` in order to convert it to another typed arrays including NodeJS `Buffer`.\n */\nexport function encode<ContextType = undefined>(\n  value: unknown,\n  options?: EncoderOptions<SplitUndefined<ContextType>>,\n): Uint8Array<ArrayBuffer> {\n  const encoder = new Encoder(options);\n  return encoder.encodeSharedRef(value);\n}\n", "export function prettyByte(byte: number): string {\n  return `${byte < 0 ? \"-\" : \"\"}0x${Math.abs(byte).toString(16).padStart(2, \"0\")}`;\n}\n", "import { utf8DecodeJs } from \"./utils/utf8.ts\";\n\nconst DEFAULT_MAX_KEY_LENGTH = 16;\nconst DEFAULT_MAX_LENGTH_PER_KEY = 16;\n\nexport interface KeyDecoder {\n  canBeCached(byteLength: number): boolean;\n  decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string;\n}\ninterface KeyCacheRecord {\n  readonly bytes: Uint8Array;\n  readonly str: string;\n}\n\nexport class CachedKeyDecoder implements KeyDecoder {\n  hit = 0;\n  miss = 0;\n  private readonly caches: Array<Array<KeyCacheRecord>>;\n  readonly maxKeyLength: number;\n  readonly maxLengthPerKey: number;\n\n  constructor(maxKeyLength = DEFAULT_MAX_KEY_LENGTH, maxLengthPerKey = DEFAULT_MAX_LENGTH_PER_KEY) {\n    this.maxKeyLength = maxKeyLength;\n    this.maxLengthPerKey = maxLengthPerKey;\n\n    // avoid `new Array(N)`, which makes a sparse array,\n    // because a sparse array is typically slower than a non-sparse array.\n    this.caches = [];\n    for (let i = 0; i < this.maxKeyLength; i++) {\n      this.caches.push([]);\n    }\n  }\n\n  public canBeCached(byteLength: number): boolean {\n    return byteLength > 0 && byteLength <= this.maxKeyLength;\n  }\n\n  private find(bytes: Uint8Array, inputOffset: number, byteLength: number): string | null {\n    const records = this.caches[byteLength - 1]!;\n\n    FIND_CHUNK: for (const record of records) {\n      const recordBytes = record.bytes;\n\n      for (let j = 0; j < byteLength; j++) {\n        if (recordBytes[j] !== bytes[inputOffset + j]) {\n          continue FIND_CHUNK;\n        }\n      }\n      return record.str;\n    }\n    return null;\n  }\n\n  private store(bytes: Uint8Array, value: string) {\n    const records = this.caches[bytes.length - 1]!;\n    const record: KeyCacheRecord = { bytes, str: value };\n\n    if (records.length >= this.maxLengthPerKey) {\n      // `records` are full!\n      // Set `record` to an arbitrary position.\n      records[(Math.random() * records.length) | 0] = record;\n    } else {\n      records.push(record);\n    }\n  }\n\n  public decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n    const cachedValue = this.find(bytes, inputOffset, byteLength);\n    if (cachedValue != null) {\n      this.hit++;\n      return cachedValue;\n    }\n    this.miss++;\n\n    const str = utf8DecodeJs(bytes, inputOffset, byteLength);\n    // Ensure to copy a slice of bytes because the bytes may be a NodeJS Buffer and Buffer#slice() returns a reference to its internal ArrayBuffer.\n    const slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);\n    this.store(slicedCopyOfBytes, str);\n    return str;\n  }\n}\n", "import { prettyByte } from \"./utils/prettyByte.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { getInt64, getUint64, UINT32_MAX } from \"./utils/int.ts\";\nimport { utf8Decode } from \"./utils/utf8.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport { CachedKeyDecoder } from \"./CachedKeyDecoder.ts\";\nimport { DecodeError } from \"./DecodeError.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\nimport type { KeyDecoder } from \"./CachedKeyDecoder.ts\";\n\nexport type DecoderOptions<ContextType = undefined> = Readonly<\n  Partial<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Decodes Int64 and Uint64 as bigint if it's set to true.\n     * Depends on ES2020's {@link DataView#getBigInt64} and\n     * {@link DataView#getBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * By default, string values will be decoded as UTF-8 strings. However, if this option is true,\n     * string values will be returned as Uint8Arrays without additional decoding.\n     *\n     * This is useful if the strings may contain invalid UTF-8 sequences.\n     *\n     * Note that this option only applies to string values, not map keys. Additionally, when\n     * enabled, raw string length is limited by the maxBinLength option.\n     */\n    rawStrings: boolean;\n\n    /**\n     * Maximum string length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxStrLength: number;\n    /**\n     * Maximum binary length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxBinLength: number;\n    /**\n     * Maximum array length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxArrayLength: number;\n    /**\n     * Maximum map length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxMapLength: number;\n    /**\n     * Maximum extension length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxExtLength: number;\n\n    /**\n     * An object key decoder. Defaults to the shared instance of {@link CachedKeyDecoder}.\n     * `null` is a special value to disable the use of the key decoder at all.\n     */\n    keyDecoder: KeyDecoder | null;\n\n    /**\n     * A function to convert decoded map key to a valid JS key type.\n     *\n     * Defaults to a function that throws an error if the key is not a string or a number.\n     */\n    mapKeyConverter: (key: unknown) => MapKeyType;\n  }>\n> &\n  ContextOf<ContextType>;\n\nconst STATE_ARRAY = \"array\";\nconst STATE_MAP_KEY = \"map_key\";\nconst STATE_MAP_VALUE = \"map_value\";\n\ntype MapKeyType = string | number;\n\nconst mapKeyConverter = (key: unknown): MapKeyType => {\n  if (typeof key === \"string\" || typeof key === \"number\") {\n    return key;\n  }\n  throw new DecodeError(\"The type of key must be string or number but \" + typeof key);\n};\n\ntype StackMapState = {\n  type: typeof STATE_MAP_KEY | typeof STATE_MAP_VALUE;\n  size: number;\n  key: MapKeyType | null;\n  readCount: number;\n  map: Record<string, unknown>;\n};\n\ntype StackArrayState = {\n  type: typeof STATE_ARRAY;\n  size: number;\n  array: Array<unknown>;\n  position: number;\n};\n\nclass StackPool {\n  private readonly stack: Array<StackState> = [];\n  private stackHeadPosition = -1;\n\n  public get length(): number {\n    return this.stackHeadPosition + 1;\n  }\n\n  public top(): StackState | undefined {\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public pushArrayState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackArrayState;\n\n    state.type = STATE_ARRAY;\n    state.position = 0;\n    state.size = size;\n    state.array = new Array(size);\n  }\n\n  public pushMapState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackMapState;\n\n    state.type = STATE_MAP_KEY;\n    state.readCount = 0;\n    state.size = size;\n    state.map = {};\n  }\n\n  private getUninitializedStateFromPool() {\n    this.stackHeadPosition++;\n\n    if (this.stackHeadPosition === this.stack.length) {\n      const partialState: Partial<StackState> = {\n        type: undefined,\n        size: 0,\n        array: undefined,\n        position: 0,\n        readCount: 0,\n        map: undefined,\n        key: null,\n      };\n\n      this.stack.push(partialState as StackState);\n    }\n\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public release(state: StackState): void {\n    const topStackState = this.stack[this.stackHeadPosition];\n\n    if (topStackState !== state) {\n      throw new Error(\"Invalid stack state. Released state is not on top of the stack.\");\n    }\n\n    if (state.type === STATE_ARRAY) {\n      const partialState = state as Partial<StackArrayState>;\n      partialState.size = 0;\n      partialState.array = undefined;\n      partialState.position = 0;\n      partialState.type = undefined;\n    }\n\n    if (state.type === STATE_MAP_KEY || state.type === STATE_MAP_VALUE) {\n      const partialState = state as Partial<StackMapState>;\n      partialState.size = 0;\n      partialState.map = undefined;\n      partialState.readCount = 0;\n      partialState.type = undefined;\n    }\n\n    this.stackHeadPosition--;\n  }\n\n  public reset(): void {\n    this.stack.length = 0;\n    this.stackHeadPosition = -1;\n  }\n}\n\ntype StackState = StackArrayState | StackMapState;\n\nconst HEAD_BYTE_REQUIRED = -1;\n\nconst EMPTY_VIEW = new DataView<ArrayBufferLike>(new ArrayBuffer(0));\nconst EMPTY_BYTES = new Uint8Array<ArrayBufferLike>(EMPTY_VIEW.buffer);\n\ntry {\n  // IE11: The spec says it should throw RangeError,\n  // IE11: but in IE11 it throws TypeError.\n  EMPTY_VIEW.getInt8(0);\n} catch (e) {\n  if (!(e instanceof RangeError)) {\n    throw new Error(\n      \"This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access\",\n    );\n  }\n}\n\nconst MORE_DATA = new RangeError(\"Insufficient data\");\n\nconst sharedCachedKeyDecoder = new CachedKeyDecoder();\n\nexport class Decoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly rawStrings: boolean;\n  private readonly maxStrLength: number;\n  private readonly maxBinLength: number;\n  private readonly maxArrayLength: number;\n  private readonly maxMapLength: number;\n  private readonly maxExtLength: number;\n  private readonly keyDecoder: KeyDecoder | null;\n  private readonly mapKeyConverter: (key: unknown) => MapKeyType;\n\n  private totalPos = 0;\n  private pos = 0;\n\n  private view = EMPTY_VIEW;\n  private bytes = EMPTY_BYTES;\n  private headByte = HEAD_BYTE_REQUIRED;\n  private readonly stack = new StackPool();\n\n  private entered = false;\n\n  public constructor(options?: DecoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.rawStrings = options?.rawStrings ?? false;\n    this.maxStrLength = options?.maxStrLength ?? UINT32_MAX;\n    this.maxBinLength = options?.maxBinLength ?? UINT32_MAX;\n    this.maxArrayLength = options?.maxArrayLength ?? UINT32_MAX;\n    this.maxMapLength = options?.maxMapLength ?? UINT32_MAX;\n    this.maxExtLength = options?.maxExtLength ?? UINT32_MAX;\n    this.keyDecoder = options?.keyDecoder !== undefined ? options.keyDecoder : sharedCachedKeyDecoder;\n    this.mapKeyConverter = options?.mapKeyConverter ?? mapKeyConverter;\n  }\n\n  private clone(): Decoder<ContextType> {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Decoder({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      rawStrings: this.rawStrings,\n      maxStrLength: this.maxStrLength,\n      maxBinLength: this.maxBinLength,\n      maxArrayLength: this.maxArrayLength,\n      maxMapLength: this.maxMapLength,\n      maxExtLength: this.maxExtLength,\n      keyDecoder: this.keyDecoder,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.totalPos = 0;\n    this.headByte = HEAD_BYTE_REQUIRED;\n    this.stack.reset();\n\n    // view, bytes, and pos will be re-initialized in setBuffer()\n  }\n\n  private setBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    const bytes = ensureUint8Array(buffer);\n    this.bytes = bytes;\n    this.view = new DataView(bytes.buffer, bytes.byteOffset, bytes.byteLength);\n    this.pos = 0;\n  }\n\n  private appendBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining(1)) {\n      this.setBuffer(buffer);\n    } else {\n      const remainingData = this.bytes.subarray(this.pos);\n      const newData = ensureUint8Array(buffer);\n\n      // concat remainingData + newData\n      const newBuffer = new Uint8Array(remainingData.length + newData.length);\n      newBuffer.set(remainingData);\n      newBuffer.set(newData, remainingData.length);\n      this.setBuffer(newBuffer);\n    }\n  }\n\n  private hasRemaining(size: number) {\n    return this.view.byteLength - this.pos >= size;\n  }\n\n  private createExtraByteError(posToShow: number): Error {\n    const { view, pos } = this;\n    return new RangeError(`Extra ${view.byteLength - pos} of ${view.byteLength} byte(s) found at buffer[${posToShow}]`);\n  }\n\n  /**\n   * @throws {@link DecodeError}\n   * @throws {@link RangeError}\n   */\n  public decode(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): unknown {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decode(buffer);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      const object = this.doDecodeSync();\n      if (this.hasRemaining(1)) {\n        throw this.createExtraByteError(this.pos);\n      }\n      return object;\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public *decodeMulti(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): Generator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMulti(buffer);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      while (this.hasRemaining(1)) {\n        yield this.doDecodeSync();\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public async decodeAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): Promise<unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decodeAsync(stream);\n    }\n\n    try {\n      this.entered = true;\n\n      let decoded = false;\n      let object: unknown;\n      for await (const buffer of stream) {\n        if (decoded) {\n          this.entered = false;\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        try {\n          object = this.doDecodeSync();\n          decoded = true;\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n\n      if (decoded) {\n        if (this.hasRemaining(1)) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n        return object;\n      }\n\n      const { headByte, pos, totalPos } = this;\n      throw new RangeError(\n        `Insufficient data in parsing ${prettyByte(headByte)} at ${totalPos} (${pos} in the current buffer)`,\n      );\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public decodeArrayStream(\n    stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>,\n  ): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, true);\n  }\n\n  public decodeStream(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, false);\n  }\n\n  private async *decodeMultiAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>, isArray: boolean): AsyncGenerator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMultiAsync(stream, isArray);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      let isArrayHeaderRequired = isArray;\n      let arrayItemsLeft = -1;\n\n      for await (const buffer of stream) {\n        if (isArray && arrayItemsLeft === 0) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        if (isArrayHeaderRequired) {\n          arrayItemsLeft = this.readArraySize();\n          isArrayHeaderRequired = false;\n          this.complete();\n        }\n\n        try {\n          while (true) {\n            yield this.doDecodeSync();\n            if (--arrayItemsLeft === 0) {\n              break;\n            }\n          }\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doDecodeSync(): unknown {\n    DECODE: while (true) {\n      const headByte = this.readHeadByte();\n      let object: unknown;\n\n      if (headByte >= 0xe0) {\n        // negative fixint (111x xxxx) 0xe0 - 0xff\n        object = headByte - 0x100;\n      } else if (headByte < 0xc0) {\n        if (headByte < 0x80) {\n          // positive fixint (0xxx xxxx) 0x00 - 0x7f\n          object = headByte;\n        } else if (headByte < 0x90) {\n          // fixmap (1000 xxxx) 0x80 - 0x8f\n          const size = headByte - 0x80;\n          if (size !== 0) {\n            this.pushMapState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = {};\n          }\n        } else if (headByte < 0xa0) {\n          // fixarray (1001 xxxx) 0x90 - 0x9f\n          const size = headByte - 0x90;\n          if (size !== 0) {\n            this.pushArrayState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = [];\n          }\n        } else {\n          // fixstr (101x xxxx) 0xa0 - 0xbf\n          const byteLength = headByte - 0xa0;\n          object = this.decodeString(byteLength, 0);\n        }\n      } else if (headByte === 0xc0) {\n        // nil\n        object = null;\n      } else if (headByte === 0xc2) {\n        // false\n        object = false;\n      } else if (headByte === 0xc3) {\n        // true\n        object = true;\n      } else if (headByte === 0xca) {\n        // float 32\n        object = this.readF32();\n      } else if (headByte === 0xcb) {\n        // float 64\n        object = this.readF64();\n      } else if (headByte === 0xcc) {\n        // uint 8\n        object = this.readU8();\n      } else if (headByte === 0xcd) {\n        // uint 16\n        object = this.readU16();\n      } else if (headByte === 0xce) {\n        // uint 32\n        object = this.readU32();\n      } else if (headByte === 0xcf) {\n        // uint 64\n        if (this.useBigInt64) {\n          object = this.readU64AsBigInt();\n        } else {\n          object = this.readU64();\n        }\n      } else if (headByte === 0xd0) {\n        // int 8\n        object = this.readI8();\n      } else if (headByte === 0xd1) {\n        // int 16\n        object = this.readI16();\n      } else if (headByte === 0xd2) {\n        // int 32\n        object = this.readI32();\n      } else if (headByte === 0xd3) {\n        // int 64\n        if (this.useBigInt64) {\n          object = this.readI64AsBigInt();\n        } else {\n          object = this.readI64();\n        }\n      } else if (headByte === 0xd9) {\n        // str 8\n        const byteLength = this.lookU8();\n        object = this.decodeString(byteLength, 1);\n      } else if (headByte === 0xda) {\n        // str 16\n        const byteLength = this.lookU16();\n        object = this.decodeString(byteLength, 2);\n      } else if (headByte === 0xdb) {\n        // str 32\n        const byteLength = this.lookU32();\n        object = this.decodeString(byteLength, 4);\n      } else if (headByte === 0xdc) {\n        // array 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xdd) {\n        // array 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xde) {\n        // map 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xdf) {\n        // map 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xc4) {\n        // bin 8\n        const size = this.lookU8();\n        object = this.decodeBinary(size, 1);\n      } else if (headByte === 0xc5) {\n        // bin 16\n        const size = this.lookU16();\n        object = this.decodeBinary(size, 2);\n      } else if (headByte === 0xc6) {\n        // bin 32\n        const size = this.lookU32();\n        object = this.decodeBinary(size, 4);\n      } else if (headByte === 0xd4) {\n        // fixext 1\n        object = this.decodeExtension(1, 0);\n      } else if (headByte === 0xd5) {\n        // fixext 2\n        object = this.decodeExtension(2, 0);\n      } else if (headByte === 0xd6) {\n        // fixext 4\n        object = this.decodeExtension(4, 0);\n      } else if (headByte === 0xd7) {\n        // fixext 8\n        object = this.decodeExtension(8, 0);\n      } else if (headByte === 0xd8) {\n        // fixext 16\n        object = this.decodeExtension(16, 0);\n      } else if (headByte === 0xc7) {\n        // ext 8\n        const size = this.lookU8();\n        object = this.decodeExtension(size, 1);\n      } else if (headByte === 0xc8) {\n        // ext 16\n        const size = this.lookU16();\n        object = this.decodeExtension(size, 2);\n      } else if (headByte === 0xc9) {\n        // ext 32\n        const size = this.lookU32();\n        object = this.decodeExtension(size, 4);\n      } else {\n        throw new DecodeError(`Unrecognized type byte: ${prettyByte(headByte)}`);\n      }\n\n      this.complete();\n\n      const stack = this.stack;\n      while (stack.length > 0) {\n        // arrays and maps\n        const state = stack.top()!;\n        if (state.type === STATE_ARRAY) {\n          state.array[state.position] = object;\n          state.position++;\n          if (state.position === state.size) {\n            object = state.array;\n            stack.release(state);\n          } else {\n            continue DECODE;\n          }\n        } else if (state.type === STATE_MAP_KEY) {\n          if (object === \"__proto__\") {\n            throw new DecodeError(\"The key __proto__ is not allowed\");\n          }\n\n          state.key = this.mapKeyConverter(object);\n          state.type = STATE_MAP_VALUE;\n          continue DECODE;\n        } else {\n          // it must be `state.type === State.MAP_VALUE` here\n\n          state.map[state.key!] = object;\n          state.readCount++;\n\n          if (state.readCount === state.size) {\n            object = state.map;\n            stack.release(state);\n          } else {\n            state.key = null;\n            state.type = STATE_MAP_KEY;\n            continue DECODE;\n          }\n        }\n      }\n\n      return object;\n    }\n  }\n\n  private readHeadByte(): number {\n    if (this.headByte === HEAD_BYTE_REQUIRED) {\n      this.headByte = this.readU8();\n      // console.log(\"headByte\", prettyByte(this.headByte));\n    }\n\n    return this.headByte;\n  }\n\n  private complete(): void {\n    this.headByte = HEAD_BYTE_REQUIRED;\n  }\n\n  private readArraySize(): number {\n    const headByte = this.readHeadByte();\n\n    switch (headByte) {\n      case 0xdc:\n        return this.readU16();\n      case 0xdd:\n        return this.readU32();\n      default: {\n        if (headByte < 0xa0) {\n          return headByte - 0x90;\n        } else {\n          throw new DecodeError(`Unrecognized array type byte: ${prettyByte(headByte)}`);\n        }\n      }\n    }\n  }\n\n  private pushMapState(size: number) {\n    if (size > this.maxMapLength) {\n      throw new DecodeError(`Max length exceeded: map length (${size}) > maxMapLengthLength (${this.maxMapLength})`);\n    }\n\n    this.stack.pushMapState(size);\n  }\n\n  private pushArrayState(size: number) {\n    if (size > this.maxArrayLength) {\n      throw new DecodeError(`Max length exceeded: array length (${size}) > maxArrayLength (${this.maxArrayLength})`);\n    }\n\n    this.stack.pushArrayState(size);\n  }\n\n  private decodeString(byteLength: number, headerOffset: number): string | Uint8Array {\n    if (!this.rawStrings || this.stateIsMapKey()) {\n      return this.decodeUtf8String(byteLength, headerOffset);\n    }\n    return this.decodeBinary(byteLength, headerOffset);\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeUtf8String(byteLength: number, headerOffset: number): string {\n    if (byteLength > this.maxStrLength) {\n      throw new DecodeError(\n        `Max length exceeded: UTF-8 byte length (${byteLength}) > maxStrLength (${this.maxStrLength})`,\n      );\n    }\n\n    if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headerOffset;\n    let object: string;\n    if (this.stateIsMapKey() && this.keyDecoder?.canBeCached(byteLength)) {\n      object = this.keyDecoder.decode(this.bytes, offset, byteLength);\n    } else {\n      object = utf8Decode(this.bytes, offset, byteLength);\n    }\n    this.pos += headerOffset + byteLength;\n    return object;\n  }\n\n  private stateIsMapKey(): boolean {\n    if (this.stack.length > 0) {\n      const state = this.stack.top()!;\n      return state.type === STATE_MAP_KEY;\n    }\n    return false;\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeBinary(byteLength: number, headOffset: number): Uint8Array {\n    if (byteLength > this.maxBinLength) {\n      throw new DecodeError(`Max length exceeded: bin length (${byteLength}) > maxBinLength (${this.maxBinLength})`);\n    }\n\n    if (!this.hasRemaining(byteLength + headOffset)) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headOffset;\n    const object = this.bytes.subarray(offset, offset + byteLength);\n    this.pos += headOffset + byteLength;\n    return object;\n  }\n\n  private decodeExtension(size: number, headOffset: number): unknown {\n    if (size > this.maxExtLength) {\n      throw new DecodeError(`Max length exceeded: ext length (${size}) > maxExtLength (${this.maxExtLength})`);\n    }\n\n    const extType = this.view.getInt8(this.pos + headOffset);\n    const data = this.decodeBinary(size, headOffset + 1 /* extType */);\n    return this.extensionCodec.decode(data, extType, this.context);\n  }\n\n  private lookU8() {\n    return this.view.getUint8(this.pos);\n  }\n\n  private lookU16() {\n    return this.view.getUint16(this.pos);\n  }\n\n  private lookU32() {\n    return this.view.getUint32(this.pos);\n  }\n\n  private readU8(): number {\n    const value = this.view.getUint8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readI8(): number {\n    const value = this.view.getInt8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readU16(): number {\n    const value = this.view.getUint16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readI16(): number {\n    const value = this.view.getInt16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readU32(): number {\n    const value = this.view.getUint32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readI32(): number {\n    const value = this.view.getInt32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readU64(): number {\n    const value = getUint64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64(): number {\n    const value = getInt64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readU64AsBigInt(): bigint {\n    const value = this.view.getBigUint64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64AsBigInt(): bigint {\n    const value = this.view.getBigInt64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readF32() {\n    const value = this.view.getFloat32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readF64() {\n    const value = this.view.getFloat64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n}\n", "import { Decoder } from \"./Decoder.ts\";\nimport type { DecoderOptions } from \"./Decoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It decodes a single MessagePack object in a buffer.\n *\n * This is a synchronous decoding function.\n * See other variants for asynchronous decoding: {@link decodeAsync}, {@link decodeMultiStream}, or {@link decodeArrayStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decode<ContextType = undefined>(\n  buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): unknown {\n  const decoder = new Decoder(options);\n  return decoder.decode(buffer);\n}\n\n/**\n * It decodes multiple MessagePack objects in a buffer.\n * This is corresponding to {@link decodeMultiStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decodeMulti<ContextType = undefined>(\n  buffer: ArrayLike<number> | BufferSource,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): Generator<unknown, void, unknown> {\n  const decoder = new Decoder(options);\n  return decoder.decodeMulti(buffer);\n}\n", "import { BaseTransport, ServerMessage } from './base';\nimport { encode, decode } from '@msgpack/msgpack';\n\n/**\n * WebSocket transport implementation.\n */\nexport class WebSocketTransport extends BaseTransport {\n    readonly name = 'WebSocket';\n\n    private socket: WebSocket | null = null;\n    private reconnectAttempts = 0;\n    private maxReconnectDelay = 5000;\n    private shouldReconnect = true;\n    private readonly url: string;\n\n    constructor(url?: string) {\n        super();\n        this.url = url || this.getDefaultUrl();\n    }\n\n    private getDefaultUrl(): string {\n        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n        return `${protocol}//${window.location.host}/_pyhtml/ws`;\n    }\n\n    connect(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            try {\n                this.socket = new WebSocket(this.url);\n                this.socket.binaryType = 'arraybuffer';\n\n                this.socket.onopen = () => {\n                    console.log('PyHTML: WebSocket connected');\n                    this.notifyStatus(true);\n                    this.reconnectAttempts = 0;\n                    resolve();\n                };\n\n                this.socket.onmessage = (event: MessageEvent) => {\n                    try {\n                        const msg = decode(event.data) as ServerMessage;\n                        this.notifyHandlers(msg);\n                    } catch (e) {\n                        console.error('PyHTML: Error parsing WebSocket message', e);\n                    }\n                };\n\n                this.socket.onclose = () => {\n                    console.log('PyHTML: WebSocket disconnected');\n                    this.notifyStatus(false);\n                    if (this.shouldReconnect) {\n                        this.scheduleReconnect();\n                    }\n                };\n\n                this.socket.onerror = (error) => {\n                    console.error('PyHTML: WebSocket error', error);\n                    if (!this.connected) {\n                        reject(new Error('WebSocket connection failed'));\n                    }\n                };\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    send(message: object): void {\n        if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n            this.socket.send(encode(message));\n        } else {\n            console.warn('PyHTML: Cannot send message, WebSocket not open');\n        }\n    }\n\n    disconnect(): void {\n        this.shouldReconnect = false;\n        if (this.socket) {\n            this.socket.close();\n            this.socket = null;\n        }\n        this.notifyStatus(false);\n    }\n\n    private scheduleReconnect(): void {\n        const delay = Math.min(\n            1000 * Math.pow(2, this.reconnectAttempts),\n            this.maxReconnectDelay\n        );\n\n        console.log(`PyHTML: Reconnecting in ${delay}ms...`);\n\n        setTimeout(() => {\n            this.reconnectAttempts++;\n            this.connect().catch(() => {\n                // Reconnect will be scheduled again on close\n            });\n        }, delay);\n    }\n}\n", "import { BaseTransport, ServerMessage } from './base';\nimport { encode, decode } from '@msgpack/msgpack';\n\n/**\n * HTTP polling transport as a fallback when WebTransport and WebSocket are unavailable.\n * Uses long-polling for receiving updates and POST for sending events.\n */\nexport class HTTPTransport extends BaseTransport {\n    readonly name = 'HTTP';\n\n    private polling = false;\n    private pollAbortController: AbortController | null = null;\n    private readonly baseUrl: string;\n    private sessionId: string | null = null;\n\n    constructor(baseUrl?: string) {\n        super();\n        this.baseUrl = baseUrl || `${window.location.origin}/_pyhtml`;\n    }\n\n    async connect(): Promise<void> {\n        try {\n            // Initialize session with the server\n            const response = await fetch(`${this.baseUrl}/session`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-msgpack',\n                    'Accept': 'application/x-msgpack'\n                },\n                body: encode({ path: window.location.pathname + window.location.search })\n            });\n\n            if (!response.ok) {\n                throw new Error(`HTTP session init failed: ${response.status}`);\n            }\n\n            const buffer = await response.arrayBuffer();\n            const data = decode(buffer) as { sessionId: string };\n            this.sessionId = data.sessionId;\n\n            console.log('PyHTML: HTTP transport connected');\n            this.notifyStatus(true);\n\n            // Start polling for updates\n            this.startPolling();\n\n        } catch (e) {\n            console.error('PyHTML: HTTP transport connection failed', e);\n            throw e;\n        }\n    }\n\n    private async startPolling(): Promise<void> {\n        if (this.polling) return;\n        this.polling = true;\n\n        while (this.polling && this.connected) {\n            try {\n                this.pollAbortController = new AbortController();\n\n                const response = await fetch(`${this.baseUrl}/poll?session=${this.sessionId}`, {\n                    method: 'GET',\n                    signal: this.pollAbortController.signal,\n                    headers: {\n                        'Accept': 'application/x-msgpack'\n                    }\n                });\n\n                if (!response.ok) {\n                    if (response.status === 404) {\n                        // Session expired, try to reconnect\n                        console.warn('PyHTML: HTTP session expired, reconnecting...');\n                        this.notifyStatus(false);\n                        await this.connect();\n                        return;\n                    }\n                    throw new Error(`Poll failed: ${response.status}`);\n                }\n\n                const buffer = await response.arrayBuffer();\n                const messages = decode(buffer) as ServerMessage[];\n\n                for (const msg of messages) {\n                    this.notifyHandlers(msg);\n                }\n\n            } catch (e) {\n                if (e instanceof Error && e.name === 'AbortError') {\n                    // Polling was aborted intentionally\n                    break;\n                }\n                console.error('PyHTML: HTTP poll error', e);\n                // Wait a bit before retrying\n                await this.sleep(1000);\n            }\n        }\n    }\n\n    async send(message: object): Promise<void> {\n        if (!this.connected || !this.sessionId) {\n            console.warn('PyHTML: Cannot send message, HTTP transport not connected');\n            return;\n        }\n\n        try {\n            const response = await fetch(`${this.baseUrl}/event`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/x-msgpack',\n                    'Accept': 'application/x-msgpack',\n                    'X-PyHTML-Session': this.sessionId\n                },\n                body: encode(message)\n            });\n\n            if (!response.ok) {\n                throw new Error(`Event send failed: ${response.status}`);\n            }\n\n            // The response contains the updated HTML\n            const buffer = await response.arrayBuffer();\n            const result = decode(buffer) as ServerMessage;\n            this.notifyHandlers(result);\n\n        } catch (e) {\n            console.error('PyHTML: HTTP send error', e);\n        }\n    }\n\n    disconnect(): void {\n        this.polling = false;\n        this.notifyStatus(false);\n\n        if (this.pollAbortController) {\n            this.pollAbortController.abort();\n            this.pollAbortController = null;\n        }\n\n        this.sessionId = null;\n    }\n\n    private sleep(ms: number): Promise<void> {\n        return new Promise(resolve => setTimeout(resolve, ms));\n    }\n}\n", "import { Transport, ServerMessage } from './transports';\nimport { WebTransportTransport } from './transports/webtransport';\nimport { WebSocketTransport } from './transports/websocket';\nimport { HTTPTransport } from './transports/http';\n\nexport interface TransportConfig {\n    /** Enable WebTransport (requires HTTPS and HTTP/3 server) */\n    enableWebTransport?: boolean;\n    /** Enable WebSocket */\n    enableWebSocket?: boolean;\n    /** Enable HTTP polling fallback */\n    enableHTTP?: boolean;\n    /** Custom WebTransport URL */\n    webTransportUrl?: string;\n    /** Custom WebSocket URL */\n    webSocketUrl?: string;\n    /** Custom HTTP base URL */\n    httpUrl?: string;\n}\n\nconst DEFAULT_CONFIG: TransportConfig = {\n    enableWebTransport: true,\n    enableWebSocket: true,\n    enableHTTP: true\n};\n\n/**\n * Manages transport selection with automatic fallback.\n * Tries transports in order: WebTransport \u2192 WebSocket \u2192 HTTP\n */\nexport class TransportManager {\n    private transport: Transport | null = null;\n    private config: TransportConfig;\n    private messageHandlers: ((msg: ServerMessage) => void)[] = [];\n    private statusHandlers: ((connected: boolean) => void)[] = [];\n\n    constructor(config: Partial<TransportConfig> = {}) {\n        this.config = { ...DEFAULT_CONFIG, ...config };\n    }\n\n    /**\n     * Connect using the best available transport with fallback.\n     */\n    async connect(): Promise<void> {\n        const transports = this.getTransportPriority();\n\n        for (const TransportClass of transports) {\n            try {\n                console.log(`PyHTML: Trying ${TransportClass.name}...`);\n                this.transport = new TransportClass();\n\n                // Forward message handlers\n                for (const handler of this.messageHandlers) {\n                    this.transport.onMessage(handler);\n                }\n\n                // Forward status changes\n                this.transport.onStatusChange((connected) => {\n                    this.notifyStatusHandlers(connected);\n                });\n\n                await this.transport.connect();\n                console.log(`PyHTML: Connected via ${this.transport.name}`);\n                return;\n\n            } catch (e) {\n                console.warn(`PyHTML: ${TransportClass.name} failed, trying next...`, e);\n                this.transport = null;\n            }\n        }\n\n        throw new Error('PyHTML: All transports failed');\n    }\n\n    /**\n     * Get transport classes in priority order based on config and browser support.\n     */\n    private getTransportPriority(): (new (...args: unknown[]) => Transport)[] {\n        const transports: (new (...args: unknown[]) => Transport)[] = [];\n\n        // WebTransport - only if supported and enabled\n        if (this.config.enableWebTransport && WebTransportTransport.isSupported()) {\n            // Also check if we're on HTTPS (required for WebTransport)\n            if (window.location.protocol === 'https:') {\n                transports.push(WebTransportTransport as unknown as new (...args: unknown[]) => Transport);\n            }\n        }\n\n        // WebSocket\n        if (this.config.enableWebSocket && typeof WebSocket !== 'undefined') {\n            transports.push(WebSocketTransport as unknown as new (...args: unknown[]) => Transport);\n        }\n\n        // HTTP (always available as final fallback)\n        if (this.config.enableHTTP) {\n            transports.push(HTTPTransport as unknown as new (...args: unknown[]) => Transport);\n        }\n\n        return transports;\n    }\n\n    /**\n     * Send a message through the active transport.\n     */\n    send(message: object): void {\n        if (this.transport) {\n            this.transport.send(message);\n        } else {\n            console.warn('PyHTML: No active transport');\n        }\n    }\n\n    /**\n     * Register a message handler.\n     */\n    onMessage(handler: (msg: ServerMessage) => void): void {\n        this.messageHandlers.push(handler);\n        if (this.transport) {\n            this.transport.onMessage(handler);\n        }\n    }\n\n    /**\n     * Register a connection status change handler.\n     */\n    onStatusChange(handler: (connected: boolean) => void): void {\n        this.statusHandlers.push(handler);\n    }\n\n    private notifyStatusHandlers(connected: boolean): void {\n        for (const handler of this.statusHandlers) {\n            handler(connected);\n        }\n    }\n\n    /**\n     * Disconnect the active transport.\n     */\n    disconnect(): void {\n        if (this.transport) {\n            this.transport.disconnect();\n            this.transport = null;\n            this.notifyStatusHandlers(false);\n        }\n    }\n\n    /**\n     * Get the name of the active transport.\n     */\n    getActiveTransport(): string | null {\n        return this.transport?.name || null;\n    }\n\n    /**\n     * Check if connected.\n     */\n    isConnected(): boolean {\n        return this.transport?.isConnected() || false;\n    }\n}\n", "var DOCUMENT_FRAGMENT_NODE = 11;\n\nfunction morphAttrs(fromNode, toNode) {\n    var toNodeAttrs = toNode.attributes;\n    var attr;\n    var attrName;\n    var attrNamespaceURI;\n    var attrValue;\n    var fromValue;\n\n    // document-fragments dont have attributes so lets not do anything\n    if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE || fromNode.nodeType === DOCUMENT_FRAGMENT_NODE) {\n      return;\n    }\n\n    // update attributes on original DOM element\n    for (var i = toNodeAttrs.length - 1; i >= 0; i--) {\n        attr = toNodeAttrs[i];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n        attrValue = attr.value;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n            fromValue = fromNode.getAttributeNS(attrNamespaceURI, attrName);\n\n            if (fromValue !== attrValue) {\n                if (attr.prefix === 'xmlns'){\n                    attrName = attr.name; // It's not allowed to set an attribute with the XMLNS namespace without specifying the `xmlns` prefix\n                }\n                fromNode.setAttributeNS(attrNamespaceURI, attrName, attrValue);\n            }\n        } else {\n            fromValue = fromNode.getAttribute(attrName);\n\n            if (fromValue !== attrValue) {\n                fromNode.setAttribute(attrName, attrValue);\n            }\n        }\n    }\n\n    // Remove any extra attributes found on the original DOM element that\n    // weren't found on the target element.\n    var fromNodeAttrs = fromNode.attributes;\n\n    for (var d = fromNodeAttrs.length - 1; d >= 0; d--) {\n        attr = fromNodeAttrs[d];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n\n            if (!toNode.hasAttributeNS(attrNamespaceURI, attrName)) {\n                fromNode.removeAttributeNS(attrNamespaceURI, attrName);\n            }\n        } else {\n            if (!toNode.hasAttribute(attrName)) {\n                fromNode.removeAttribute(attrName);\n            }\n        }\n    }\n}\n\nvar range; // Create a range object for efficently rendering strings to elements.\nvar NS_XHTML = 'http://www.w3.org/1999/xhtml';\n\nvar doc = typeof document === 'undefined' ? undefined : document;\nvar HAS_TEMPLATE_SUPPORT = !!doc && 'content' in doc.createElement('template');\nvar HAS_RANGE_SUPPORT = !!doc && doc.createRange && 'createContextualFragment' in doc.createRange();\n\nfunction createFragmentFromTemplate(str) {\n    var template = doc.createElement('template');\n    template.innerHTML = str;\n    return template.content.childNodes[0];\n}\n\nfunction createFragmentFromRange(str) {\n    if (!range) {\n        range = doc.createRange();\n        range.selectNode(doc.body);\n    }\n\n    var fragment = range.createContextualFragment(str);\n    return fragment.childNodes[0];\n}\n\nfunction createFragmentFromWrap(str) {\n    var fragment = doc.createElement('body');\n    fragment.innerHTML = str;\n    return fragment.childNodes[0];\n}\n\n/**\n * This is about the same\n * var html = new DOMParser().parseFromString(str, 'text/html');\n * return html.body.firstChild;\n *\n * @method toElement\n * @param {String} str\n */\nfunction toElement(str) {\n    str = str.trim();\n    if (HAS_TEMPLATE_SUPPORT) {\n      // avoid restrictions on content for things like `<tr><th>Hi</th></tr>` which\n      // createContextualFragment doesn't support\n      // <template> support not available in IE\n      return createFragmentFromTemplate(str);\n    } else if (HAS_RANGE_SUPPORT) {\n      return createFragmentFromRange(str);\n    }\n\n    return createFragmentFromWrap(str);\n}\n\n/**\n * Returns true if two node's names are the same.\n *\n * NOTE: We don't bother checking `namespaceURI` because you will never find two HTML elements with the same\n *       nodeName and different namespace URIs.\n *\n * @param {Element} a\n * @param {Element} b The target element\n * @return {boolean}\n */\nfunction compareNodeNames(fromEl, toEl) {\n    var fromNodeName = fromEl.nodeName;\n    var toNodeName = toEl.nodeName;\n    var fromCodeStart, toCodeStart;\n\n    if (fromNodeName === toNodeName) {\n        return true;\n    }\n\n    fromCodeStart = fromNodeName.charCodeAt(0);\n    toCodeStart = toNodeName.charCodeAt(0);\n\n    // If the target element is a virtual DOM node or SVG node then we may\n    // need to normalize the tag name before comparing. Normal HTML elements that are\n    // in the \"http://www.w3.org/1999/xhtml\"\n    // are converted to upper case\n    if (fromCodeStart <= 90 && toCodeStart >= 97) { // from is upper and to is lower\n        return fromNodeName === toNodeName.toUpperCase();\n    } else if (toCodeStart <= 90 && fromCodeStart >= 97) { // to is upper and from is lower\n        return toNodeName === fromNodeName.toUpperCase();\n    } else {\n        return false;\n    }\n}\n\n/**\n * Create an element, optionally with a known namespace URI.\n *\n * @param {string} name the element name, e.g. 'div' or 'svg'\n * @param {string} [namespaceURI] the element's namespace URI, i.e. the value of\n * its `xmlns` attribute or its inferred namespace.\n *\n * @return {Element}\n */\nfunction createElementNS(name, namespaceURI) {\n    return !namespaceURI || namespaceURI === NS_XHTML ?\n        doc.createElement(name) :\n        doc.createElementNS(namespaceURI, name);\n}\n\n/**\n * Copies the children of one DOM element to another DOM element\n */\nfunction moveChildren(fromEl, toEl) {\n    var curChild = fromEl.firstChild;\n    while (curChild) {\n        var nextChild = curChild.nextSibling;\n        toEl.appendChild(curChild);\n        curChild = nextChild;\n    }\n    return toEl;\n}\n\nfunction syncBooleanAttrProp(fromEl, toEl, name) {\n    if (fromEl[name] !== toEl[name]) {\n        fromEl[name] = toEl[name];\n        if (fromEl[name]) {\n            fromEl.setAttribute(name, '');\n        } else {\n            fromEl.removeAttribute(name);\n        }\n    }\n}\n\nvar specialElHandlers = {\n    OPTION: function(fromEl, toEl) {\n        var parentNode = fromEl.parentNode;\n        if (parentNode) {\n            var parentName = parentNode.nodeName.toUpperCase();\n            if (parentName === 'OPTGROUP') {\n                parentNode = parentNode.parentNode;\n                parentName = parentNode && parentNode.nodeName.toUpperCase();\n            }\n            if (parentName === 'SELECT' && !parentNode.hasAttribute('multiple')) {\n                if (fromEl.hasAttribute('selected') && !toEl.selected) {\n                    // Workaround for MS Edge bug where the 'selected' attribute can only be\n                    // removed if set to a non-empty value:\n                    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/12087679/\n                    fromEl.setAttribute('selected', 'selected');\n                    fromEl.removeAttribute('selected');\n                }\n                // We have to reset select element's selectedIndex to -1, otherwise setting\n                // fromEl.selected using the syncBooleanAttrProp below has no effect.\n                // The correct selectedIndex will be set in the SELECT special handler below.\n                parentNode.selectedIndex = -1;\n            }\n        }\n        syncBooleanAttrProp(fromEl, toEl, 'selected');\n    },\n    /**\n     * The \"value\" attribute is special for the <input> element since it sets\n     * the initial value. Changing the \"value\" attribute without changing the\n     * \"value\" property will have no effect since it is only used to the set the\n     * initial value.  Similar for the \"checked\" attribute, and \"disabled\".\n     */\n    INPUT: function(fromEl, toEl) {\n        syncBooleanAttrProp(fromEl, toEl, 'checked');\n        syncBooleanAttrProp(fromEl, toEl, 'disabled');\n\n        if (fromEl.value !== toEl.value) {\n            fromEl.value = toEl.value;\n        }\n\n        if (!toEl.hasAttribute('value')) {\n            fromEl.removeAttribute('value');\n        }\n    },\n\n    TEXTAREA: function(fromEl, toEl) {\n        var newValue = toEl.value;\n        if (fromEl.value !== newValue) {\n            fromEl.value = newValue;\n        }\n\n        var firstChild = fromEl.firstChild;\n        if (firstChild) {\n            // Needed for IE. Apparently IE sets the placeholder as the\n            // node value and vise versa. This ignores an empty update.\n            var oldValue = firstChild.nodeValue;\n\n            if (oldValue == newValue || (!newValue && oldValue == fromEl.placeholder)) {\n                return;\n            }\n\n            firstChild.nodeValue = newValue;\n        }\n    },\n    SELECT: function(fromEl, toEl) {\n        if (!toEl.hasAttribute('multiple')) {\n            var selectedIndex = -1;\n            var i = 0;\n            // We have to loop through children of fromEl, not toEl since nodes can be moved\n            // from toEl to fromEl directly when morphing.\n            // At the time this special handler is invoked, all children have already been morphed\n            // and appended to / removed from fromEl, so using fromEl here is safe and correct.\n            var curChild = fromEl.firstChild;\n            var optgroup;\n            var nodeName;\n            while(curChild) {\n                nodeName = curChild.nodeName && curChild.nodeName.toUpperCase();\n                if (nodeName === 'OPTGROUP') {\n                    optgroup = curChild;\n                    curChild = optgroup.firstChild;\n                    // handle empty optgroups\n                    if (!curChild) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                } else {\n                    if (nodeName === 'OPTION') {\n                        if (curChild.hasAttribute('selected')) {\n                            selectedIndex = i;\n                            break;\n                        }\n                        i++;\n                    }\n                    curChild = curChild.nextSibling;\n                    if (!curChild && optgroup) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                }\n            }\n\n            fromEl.selectedIndex = selectedIndex;\n        }\n    }\n};\n\nvar ELEMENT_NODE = 1;\nvar DOCUMENT_FRAGMENT_NODE$1 = 11;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\n\nfunction noop() {}\n\nfunction defaultGetNodeKey(node) {\n  if (node) {\n    return (node.getAttribute && node.getAttribute('id')) || node.id;\n  }\n}\n\nfunction morphdomFactory(morphAttrs) {\n\n  return function morphdom(fromNode, toNode, options) {\n    if (!options) {\n      options = {};\n    }\n\n    if (typeof toNode === 'string') {\n      if (fromNode.nodeName === '#document' || fromNode.nodeName === 'HTML' || fromNode.nodeName === 'BODY') {\n        var toNodeHtml = toNode;\n        toNode = doc.createElement('html');\n        toNode.innerHTML = toNodeHtml;\n      } else {\n        toNode = toElement(toNode);\n      }\n    } else if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n      toNode = toNode.firstElementChild;\n    }\n\n    var getNodeKey = options.getNodeKey || defaultGetNodeKey;\n    var onBeforeNodeAdded = options.onBeforeNodeAdded || noop;\n    var onNodeAdded = options.onNodeAdded || noop;\n    var onBeforeElUpdated = options.onBeforeElUpdated || noop;\n    var onElUpdated = options.onElUpdated || noop;\n    var onBeforeNodeDiscarded = options.onBeforeNodeDiscarded || noop;\n    var onNodeDiscarded = options.onNodeDiscarded || noop;\n    var onBeforeElChildrenUpdated = options.onBeforeElChildrenUpdated || noop;\n    var skipFromChildren = options.skipFromChildren || noop;\n    var addChild = options.addChild || function(parent, child){ return parent.appendChild(child); };\n    var childrenOnly = options.childrenOnly === true;\n\n    // This object is used as a lookup to quickly find all keyed elements in the original DOM tree.\n    var fromNodesLookup = Object.create(null);\n    var keyedRemovalList = [];\n\n    function addKeyedRemoval(key) {\n      keyedRemovalList.push(key);\n    }\n\n    function walkDiscardedChildNodes(node, skipKeyedNodes) {\n      if (node.nodeType === ELEMENT_NODE) {\n        var curChild = node.firstChild;\n        while (curChild) {\n\n          var key = undefined;\n\n          if (skipKeyedNodes && (key = getNodeKey(curChild))) {\n            // If we are skipping keyed nodes then we add the key\n            // to a list so that it can be handled at the very end.\n            addKeyedRemoval(key);\n          } else {\n            // Only report the node as discarded if it is not keyed. We do this because\n            // at the end we loop through all keyed elements that were unmatched\n            // and then discard them in one final pass.\n            onNodeDiscarded(curChild);\n            if (curChild.firstChild) {\n              walkDiscardedChildNodes(curChild, skipKeyedNodes);\n            }\n          }\n\n          curChild = curChild.nextSibling;\n        }\n      }\n    }\n\n    /**\n    * Removes a DOM node out of the original DOM\n    *\n    * @param  {Node} node The node to remove\n    * @param  {Node} parentNode The nodes parent\n    * @param  {Boolean} skipKeyedNodes If true then elements with keys will be skipped and not discarded.\n    * @return {undefined}\n    */\n    function removeNode(node, parentNode, skipKeyedNodes) {\n      if (onBeforeNodeDiscarded(node) === false) {\n        return;\n      }\n\n      if (parentNode) {\n        parentNode.removeChild(node);\n      }\n\n      onNodeDiscarded(node);\n      walkDiscardedChildNodes(node, skipKeyedNodes);\n    }\n\n    // // TreeWalker implementation is no faster, but keeping this around in case this changes in the future\n    // function indexTree(root) {\n    //     var treeWalker = document.createTreeWalker(\n    //         root,\n    //         NodeFilter.SHOW_ELEMENT);\n    //\n    //     var el;\n    //     while((el = treeWalker.nextNode())) {\n    //         var key = getNodeKey(el);\n    //         if (key) {\n    //             fromNodesLookup[key] = el;\n    //         }\n    //     }\n    // }\n\n    // // NodeIterator implementation is no faster, but keeping this around in case this changes in the future\n    //\n    // function indexTree(node) {\n    //     var nodeIterator = document.createNodeIterator(node, NodeFilter.SHOW_ELEMENT);\n    //     var el;\n    //     while((el = nodeIterator.nextNode())) {\n    //         var key = getNodeKey(el);\n    //         if (key) {\n    //             fromNodesLookup[key] = el;\n    //         }\n    //     }\n    // }\n\n    function indexTree(node) {\n      if (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n        var curChild = node.firstChild;\n        while (curChild) {\n          var key = getNodeKey(curChild);\n          if (key) {\n            fromNodesLookup[key] = curChild;\n          }\n\n          // Walk recursively\n          indexTree(curChild);\n\n          curChild = curChild.nextSibling;\n        }\n      }\n    }\n\n    indexTree(fromNode);\n\n    function handleNodeAdded(el) {\n      onNodeAdded(el);\n\n      var curChild = el.firstChild;\n      while (curChild) {\n        var nextSibling = curChild.nextSibling;\n\n        var key = getNodeKey(curChild);\n        if (key) {\n          var unmatchedFromEl = fromNodesLookup[key];\n          // if we find a duplicate #id node in cache, replace `el` with cache value\n          // and morph it to the child node.\n          if (unmatchedFromEl && compareNodeNames(curChild, unmatchedFromEl)) {\n            curChild.parentNode.replaceChild(unmatchedFromEl, curChild);\n            morphEl(unmatchedFromEl, curChild);\n          } else {\n            handleNodeAdded(curChild);\n          }\n        } else {\n          // recursively call for curChild and it's children to see if we find something in\n          // fromNodesLookup\n          handleNodeAdded(curChild);\n        }\n\n        curChild = nextSibling;\n      }\n    }\n\n    function cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey) {\n      // We have processed all of the \"to nodes\". If curFromNodeChild is\n      // non-null then we still have some from nodes left over that need\n      // to be removed\n      while (curFromNodeChild) {\n        var fromNextSibling = curFromNodeChild.nextSibling;\n        if ((curFromNodeKey = getNodeKey(curFromNodeChild))) {\n          // Since the node is keyed it might be matched up later so we defer\n          // the actual removal to later\n          addKeyedRemoval(curFromNodeKey);\n        } else {\n          // NOTE: we skip nested keyed nodes from being removed since there is\n          //       still a chance they will be matched up later\n          removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n        }\n        curFromNodeChild = fromNextSibling;\n      }\n    }\n\n    function morphEl(fromEl, toEl, childrenOnly) {\n      var toElKey = getNodeKey(toEl);\n\n      if (toElKey) {\n        // If an element with an ID is being morphed then it will be in the final\n        // DOM so clear it out of the saved elements collection\n        delete fromNodesLookup[toElKey];\n      }\n\n      if (!childrenOnly) {\n        // optional\n        var beforeUpdateResult = onBeforeElUpdated(fromEl, toEl);\n        if (beforeUpdateResult === false) {\n          return;\n        } else if (beforeUpdateResult instanceof HTMLElement) {\n          fromEl = beforeUpdateResult;\n          // reindex the new fromEl in case it's not in the same\n          // tree as the original fromEl\n          // (Phoenix LiveView sometimes returns a cloned tree,\n          //  but keyed lookups would still point to the original tree)\n          indexTree(fromEl);\n        }\n\n        // update attributes on original DOM element first\n        morphAttrs(fromEl, toEl);\n        // optional\n        onElUpdated(fromEl);\n\n        if (onBeforeElChildrenUpdated(fromEl, toEl) === false) {\n          return;\n        }\n      }\n\n      if (fromEl.nodeName !== 'TEXTAREA') {\n        morphChildren(fromEl, toEl);\n      } else {\n        specialElHandlers.TEXTAREA(fromEl, toEl);\n      }\n    }\n\n    function morphChildren(fromEl, toEl) {\n      var skipFrom = skipFromChildren(fromEl, toEl);\n      var curToNodeChild = toEl.firstChild;\n      var curFromNodeChild = fromEl.firstChild;\n      var curToNodeKey;\n      var curFromNodeKey;\n\n      var fromNextSibling;\n      var toNextSibling;\n      var matchingFromEl;\n\n      // walk the children\n      outer: while (curToNodeChild) {\n        toNextSibling = curToNodeChild.nextSibling;\n        curToNodeKey = getNodeKey(curToNodeChild);\n\n        // walk the fromNode children all the way through\n        while (!skipFrom && curFromNodeChild) {\n          fromNextSibling = curFromNodeChild.nextSibling;\n\n          if (curToNodeChild.isSameNode && curToNodeChild.isSameNode(curFromNodeChild)) {\n            curToNodeChild = toNextSibling;\n            curFromNodeChild = fromNextSibling;\n            continue outer;\n          }\n\n          curFromNodeKey = getNodeKey(curFromNodeChild);\n\n          var curFromNodeType = curFromNodeChild.nodeType;\n\n          // this means if the curFromNodeChild doesnt have a match with the curToNodeChild\n          var isCompatible = undefined;\n\n          if (curFromNodeType === curToNodeChild.nodeType) {\n            if (curFromNodeType === ELEMENT_NODE) {\n              // Both nodes being compared are Element nodes\n\n              if (curToNodeKey) {\n                // The target node has a key so we want to match it up with the correct element\n                // in the original DOM tree\n                if (curToNodeKey !== curFromNodeKey) {\n                  // The current element in the original DOM tree does not have a matching key so\n                  // let's check our lookup to see if there is a matching element in the original\n                  // DOM tree\n                  if ((matchingFromEl = fromNodesLookup[curToNodeKey])) {\n                    if (fromNextSibling === matchingFromEl) {\n                      // Special case for single element removals. To avoid removing the original\n                      // DOM node out of the tree (since that can break CSS transitions, etc.),\n                      // we will instead discard the current node and wait until the next\n                      // iteration to properly match up the keyed target element with its matching\n                      // element in the original tree\n                      isCompatible = false;\n                    } else {\n                      // We found a matching keyed element somewhere in the original DOM tree.\n                      // Let's move the original DOM node into the current position and morph\n                      // it.\n\n                      // NOTE: We use insertBefore instead of replaceChild because we want to go through\n                      // the `removeNode()` function for the node that is being discarded so that\n                      // all lifecycle hooks are correctly invoked\n                      fromEl.insertBefore(matchingFromEl, curFromNodeChild);\n\n                      // fromNextSibling = curFromNodeChild.nextSibling;\n\n                      if (curFromNodeKey) {\n                        // Since the node is keyed it might be matched up later so we defer\n                        // the actual removal to later\n                        addKeyedRemoval(curFromNodeKey);\n                      } else {\n                        // NOTE: we skip nested keyed nodes from being removed since there is\n                        //       still a chance they will be matched up later\n                        removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                      }\n\n                      curFromNodeChild = matchingFromEl;\n                      curFromNodeKey = getNodeKey(curFromNodeChild);\n                    }\n                  } else {\n                    // The nodes are not compatible since the \"to\" node has a key and there\n                    // is no matching keyed node in the source tree\n                    isCompatible = false;\n                  }\n                }\n              } else if (curFromNodeKey) {\n                // The original has a key\n                isCompatible = false;\n              }\n\n              isCompatible = isCompatible !== false && compareNodeNames(curFromNodeChild, curToNodeChild);\n              if (isCompatible) {\n                // We found compatible DOM elements so transform\n                // the current \"from\" node to match the current\n                // target DOM node.\n                // MORPH\n                morphEl(curFromNodeChild, curToNodeChild);\n              }\n\n            } else if (curFromNodeType === TEXT_NODE || curFromNodeType == COMMENT_NODE) {\n              // Both nodes being compared are Text or Comment nodes\n              isCompatible = true;\n              // Simply update nodeValue on the original node to\n              // change the text value\n              if (curFromNodeChild.nodeValue !== curToNodeChild.nodeValue) {\n                curFromNodeChild.nodeValue = curToNodeChild.nodeValue;\n              }\n\n            }\n          }\n\n          if (isCompatible) {\n            // Advance both the \"to\" child and the \"from\" child since we found a match\n            // Nothing else to do as we already recursively called morphChildren above\n            curToNodeChild = toNextSibling;\n            curFromNodeChild = fromNextSibling;\n            continue outer;\n          }\n\n          // No compatible match so remove the old node from the DOM and continue trying to find a\n          // match in the original DOM. However, we only do this if the from node is not keyed\n          // since it is possible that a keyed node might match up with a node somewhere else in the\n          // target tree and we don't want to discard it just yet since it still might find a\n          // home in the final DOM tree. After everything is done we will remove any keyed nodes\n          // that didn't find a home\n          if (curFromNodeKey) {\n            // Since the node is keyed it might be matched up later so we defer\n            // the actual removal to later\n            addKeyedRemoval(curFromNodeKey);\n          } else {\n            // NOTE: we skip nested keyed nodes from being removed since there is\n            //       still a chance they will be matched up later\n            removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n          }\n\n          curFromNodeChild = fromNextSibling;\n        } // END: while(curFromNodeChild) {}\n\n        // If we got this far then we did not find a candidate match for\n        // our \"to node\" and we exhausted all of the children \"from\"\n        // nodes. Therefore, we will just append the current \"to\" node\n        // to the end\n        if (curToNodeKey && (matchingFromEl = fromNodesLookup[curToNodeKey]) && compareNodeNames(matchingFromEl, curToNodeChild)) {\n          // MORPH\n          if(!skipFrom){ addChild(fromEl, matchingFromEl); }\n          morphEl(matchingFromEl, curToNodeChild);\n        } else {\n          var onBeforeNodeAddedResult = onBeforeNodeAdded(curToNodeChild);\n          if (onBeforeNodeAddedResult !== false) {\n            if (onBeforeNodeAddedResult) {\n              curToNodeChild = onBeforeNodeAddedResult;\n            }\n\n            if (curToNodeChild.actualize) {\n              curToNodeChild = curToNodeChild.actualize(fromEl.ownerDocument || doc);\n            }\n            addChild(fromEl, curToNodeChild);\n            handleNodeAdded(curToNodeChild);\n          }\n        }\n\n        curToNodeChild = toNextSibling;\n        curFromNodeChild = fromNextSibling;\n      }\n\n      cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey);\n\n      var specialElHandler = specialElHandlers[fromEl.nodeName];\n      if (specialElHandler) {\n        specialElHandler(fromEl, toEl);\n      }\n    } // END: morphChildren(...)\n\n    var morphedNode = fromNode;\n    var morphedNodeType = morphedNode.nodeType;\n    var toNodeType = toNode.nodeType;\n\n    if (!childrenOnly) {\n      // Handle the case where we are given two DOM nodes that are not\n      // compatible (e.g. <div> --> <span> or <div> --> TEXT)\n      if (morphedNodeType === ELEMENT_NODE) {\n        if (toNodeType === ELEMENT_NODE) {\n          if (!compareNodeNames(fromNode, toNode)) {\n            onNodeDiscarded(fromNode);\n            morphedNode = moveChildren(fromNode, createElementNS(toNode.nodeName, toNode.namespaceURI));\n          }\n        } else {\n          // Going from an element node to a text node\n          morphedNode = toNode;\n        }\n      } else if (morphedNodeType === TEXT_NODE || morphedNodeType === COMMENT_NODE) { // Text or comment node\n        if (toNodeType === morphedNodeType) {\n          if (morphedNode.nodeValue !== toNode.nodeValue) {\n            morphedNode.nodeValue = toNode.nodeValue;\n          }\n\n          return morphedNode;\n        } else {\n          // Text node to something else\n          morphedNode = toNode;\n        }\n      }\n    }\n\n    if (morphedNode === toNode) {\n      // The \"to node\" was not compatible with the \"from node\" so we had to\n      // toss out the \"from node\" and use the \"to node\"\n      onNodeDiscarded(fromNode);\n    } else {\n      if (toNode.isSameNode && toNode.isSameNode(morphedNode)) {\n        return;\n      }\n\n      morphEl(morphedNode, toNode, childrenOnly);\n\n      // We now need to loop over any keyed nodes that might need to be\n      // removed. We only do the removal if we know that the keyed node\n      // never found a match. When a keyed node is matched up we remove\n      // it out of fromNodesLookup and we use fromNodesLookup to determine\n      // if a keyed node has been matched up or not\n      if (keyedRemovalList) {\n        for (var i=0, len=keyedRemovalList.length; i<len; i++) {\n          var elToRemove = fromNodesLookup[keyedRemovalList[i]];\n          if (elToRemove) {\n            removeNode(elToRemove, elToRemove.parentNode, false);\n          }\n        }\n      }\n    }\n\n    if (!childrenOnly && morphedNode !== fromNode && fromNode.parentNode) {\n      if (morphedNode.actualize) {\n        morphedNode = morphedNode.actualize(fromNode.ownerDocument || doc);\n      }\n      // If we had to swap out the from node with a new node because the old\n      // node was not compatible with the target node then we need to\n      // replace the old DOM node in the original DOM tree. This is only\n      // possible if the original DOM node was part of a DOM tree which\n      // we know is the case if it has a parent node.\n      fromNode.parentNode.replaceChild(morphedNode, fromNode);\n    }\n\n    return morphedNode;\n  };\n}\n\nvar morphdom = morphdomFactory(morphAttrs);\n\nexport default morphdom;\n", "/**\n * DOM Updater using morphdom for efficient DOM diffing.\n */\nimport morphdom from 'morphdom';\n\ninterface FocusState {\n    /** CSS selector to find the element */\n    selector: string;\n    /** Element ID if available */\n    id: string | null;\n    tagName: string;\n    selectionStart: number | null;\n    selectionEnd: number | null;\n    scrollTop: number;\n    scrollLeft: number;\n    value: string;\n}\n\nexport class DOMUpdater {\n    /**\n     * Flag to indicate DOM is being updated.\n     * Event handlers should check this to avoid triggering events during updates.\n     */\n    static isUpdating = false;\n\n    private debug: boolean;\n\n    constructor(debug: boolean = false) {\n        this.debug = debug;\n    }\n\n    /**\n     * Generate a stable key for an element.\n     * Used by morphdom to match elements between old and new DOM.\n     */\n    private getNodeKey(node: Node): string | undefined {\n        if (!(node instanceof HTMLElement)) return undefined;\n\n        // 1. Use data-on-* handler as key FIRST (stable across renders)\n        for (const attr of node.attributes) {\n            if (attr.name.startsWith('data-on-')) {\n                const key = `${node.tagName}-${attr.name}-${attr.value}`;\n                return key;\n            }\n        }\n\n        // 2. Use explicit ID (but skip client-generated pyhtml-uid-* IDs)\n        if (node.id && !node.id.startsWith('pyhtml-uid-')) {\n            return node.id;\n        }\n\n        // 3. Use name attribute for form elements\n        if (node instanceof HTMLInputElement ||\n            node instanceof HTMLSelectElement ||\n            node instanceof HTMLTextAreaElement) {\n            if (node.name) {\n                return `${node.tagName}-name-${node.name}`;\n            }\n        }\n\n        // 4. For other elements, no key (morphdom will use position-based matching)\n        return undefined;\n    }\n\n    /**\n     * Generate a selector to find an element\n     */\n    private getElementSelector(el: Element): string {\n        if (el.id) return `#${el.id}`;\n\n        // Build a path-based selector\n        const path: string[] = [];\n        let current: Element | null = el;\n\n        while (current && current !== document.body && path.length < 5) {\n            let selector = current.tagName.toLowerCase();\n\n            // Add distinguishing attributes\n            if (current.id) {\n                selector = `#${current.id}`;\n                path.unshift(selector);\n                break; // ID is unique enough\n            }\n\n            // Use name for form elements\n            if (current instanceof HTMLInputElement ||\n                current instanceof HTMLSelectElement ||\n                current instanceof HTMLTextAreaElement) {\n                if (current.name) {\n                    selector += `[name=\"${current.name}\"]`;\n                }\n            }\n\n            // Use data-on-* for event elements\n            for (const attr of current.attributes) {\n                if (attr.name.startsWith('data-on-')) {\n                    selector += `[${attr.name}=\"${attr.value}\"]`;\n                    break;\n                }\n            }\n\n            // Add nth-child for disambiguation\n            if (current.parentElement) {\n                const sibs = Array.from(current.parentElement.children);\n                const sameTags = sibs.filter(s => s.tagName === current!.tagName);\n                if (sameTags.length > 1) {\n                    const idx = sameTags.indexOf(current) + 1;\n                    selector += `:nth-of-type(${idx})`;\n                }\n            }\n\n            path.unshift(selector);\n            current = current.parentElement;\n        }\n\n        return path.join(' > ');\n    }\n\n    /**\n     * Capture the current focus state before updating.\n     */\n    private captureFocusState(): FocusState | null {\n        const active = document.activeElement;\n        if (!active || active === document.body || active === document.documentElement) return null;\n\n        const state: FocusState = {\n            selector: this.getElementSelector(active),\n            id: active.id || null,\n            tagName: active.tagName,\n            selectionStart: null,\n            selectionEnd: null,\n            scrollTop: 0,\n            scrollLeft: 0,\n            value: ''\n        };\n\n        if (active instanceof HTMLInputElement || active instanceof HTMLTextAreaElement) {\n            state.selectionStart = active.selectionStart;\n            state.selectionEnd = active.selectionEnd;\n            state.scrollTop = active.scrollTop;\n            state.scrollLeft = active.scrollLeft;\n            state.value = active.value;\n        }\n\n        return state;\n    }\n\n    /**\n     * Restore focus state after updating.\n     */\n    private restoreFocusState(state: FocusState | null): void {\n        if (!state) return;\n\n        // Try to find by ID first, then by selector\n        let el: Element | null = null;\n        if (state.id) {\n            el = document.getElementById(state.id);\n        }\n        if (!el && state.selector) {\n            try {\n                el = document.querySelector(state.selector);\n            } catch (e) {\n                // Invalid selector, skip\n            }\n        }\n\n        if (!el) return;\n\n        // Restore focus\n        (el as HTMLElement).focus();\n\n        // Restore selection/caret position\n        if (el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement) {\n            // Restore value if it matches what we captured\n            if (state.value && el.value !== state.value) {\n                el.value = state.value;\n            }\n\n            if (state.selectionStart !== null && state.selectionEnd !== null) {\n                try {\n                    el.setSelectionRange(state.selectionStart, state.selectionEnd);\n                } catch (e) {\n                    // Some input types (date, number) don't support setSelectionRange\n                }\n            }\n            el.scrollTop = state.scrollTop;\n            el.scrollLeft = state.scrollLeft;\n        }\n    }\n\n    /**\n     * Update the DOM with new HTML content.\n     */\n    update(newHtml: string): void {\n        // Set flag to suppress focus/blur events during update\n        DOMUpdater.isUpdating = true;\n        if (this.debug) {\n            console.log('[DOMUpdater] Starting update, isUpdating =', DOMUpdater.isUpdating);\n        }\n\n        try {\n            // Capture focus before morphdom runs\n            const focusState = this.captureFocusState();\n\n            // Capture all form element states\n            const formStates = new Map<string, { value: string; checked?: boolean; selectedIndex?: number }>();\n            document.querySelectorAll('input, select, textarea').forEach((el, idx) => {\n                const key = this.getNodeKey(el) || `form-el-${idx}`;\n                if (el instanceof HTMLInputElement) {\n                    formStates.set(key, {\n                        value: el.value,\n                        checked: el.type === 'checkbox' || el.type === 'radio' ? el.checked : undefined\n                    });\n                } else if (el instanceof HTMLSelectElement) {\n                    formStates.set(key, { value: el.value, selectedIndex: el.selectedIndex });\n                } else if (el instanceof HTMLTextAreaElement) {\n                    formStates.set(key, { value: el.value });\n                }\n            });\n\n            if (morphdom) {\n                try {\n                    morphdom(document.documentElement, newHtml, {\n                        // Custom key function for stable element matching\n                        getNodeKey: (node: Node) => this.getNodeKey(node),\n\n                        onBeforeElUpdated: (fromEl, toEl) => {\n                            // Transfer ALL relevant state from old element to new element\n\n                            // Input/Textarea: preserve value ONLY if they are broadly similar\n                            // (e.g. user is still typing or deleted a few chars).\n                            // If the server sends a completely different value, let it win.\n                            if (fromEl instanceof HTMLInputElement && toEl instanceof HTMLInputElement) {\n                                if (fromEl.type === 'checkbox' || fromEl.type === 'radio') {\n                                    toEl.checked = fromEl.checked;\n                                } else {\n                                    const s = toEl.value || '';\n                                    const c = fromEl.value || '';\n                                    if (c.startsWith(s) || s.startsWith(c)) {\n                                        toEl.value = c;\n                                    }\n                                }\n                            }\n\n                            if (fromEl instanceof HTMLTextAreaElement && toEl instanceof HTMLTextAreaElement) {\n                                const s = toEl.value || '';\n                                const c = fromEl.value || '';\n                                if (c.startsWith(s) || s.startsWith(c)) {\n                                    toEl.value = c;\n                                }\n                            }\n\n                            // Select: preserve selected option\n                            if (fromEl instanceof HTMLSelectElement && toEl instanceof HTMLSelectElement) {\n                                // Preserve by value (more robust than index)\n                                if (fromEl.value && Array.from(toEl.options).some(o => o.value === fromEl.value)) {\n                                    toEl.value = fromEl.value;\n                                } else if (fromEl.selectedIndex >= 0 && fromEl.selectedIndex < toEl.options.length) {\n                                    toEl.selectedIndex = fromEl.selectedIndex;\n                                }\n                            }\n\n                            // Preserve client-generated IDs (vital for debouncers/throttlers that key off ID)\n                            if (fromEl.id && fromEl.id.startsWith('pyhtml-uid-') && !toEl.id) {\n                                toEl.id = fromEl.id;\n                            }\n\n                            return true;\n                        },\n\n                        onBeforeNodeDiscarded: () => true\n                    });\n                } catch (e) {\n                    console.error('Morphdom failed:', e);\n                    document.open();\n                    document.write(newHtml);\n                    document.close();\n                }\n\n                // Restore focus after morphdom completes\n                this.restoreFocusState(focusState);\n            } else {\n                document.open();\n                document.write(newHtml);\n                document.close();\n            }\n        } finally {\n            // Clear flag after a microtask to ensure all focus events are suppressed\n            setTimeout(() => {\n                DOMUpdater.isUpdating = false;\n            }, 0);\n        }\n    }\n}\n\n", "import { PyHTMLApp } from '../core/app';\nimport { DOMUpdater } from '../core/dom-updater';\nimport { EventData } from '../core/transports';\n\n// Type alias for backward compatibility\ntype Application = PyHTMLApp;\n\nexport class UnifiedEventHandler {\n    private app: Application;\n    private debouncers = new Map<string, number>();\n    private throttlers = new Map<string, number>();\n\n    private supportedEvents = [\n        'click', 'submit', 'input', 'change',\n        'keydown', 'keyup', 'focus', 'blur',\n        'mouseenter', 'mouseleave', 'scroll', 'contextmenu'\n    ];\n\n    // Events that should be suppressed during DOM updates to prevent loops\n    private suppressDuringUpdate = ['focus', 'blur', 'mouseenter', 'mouseleave'];\n\n    constructor(app: Application) {\n        this.app = app;\n    }\n\n    private debugLog(...args: any[]): void {\n        if (this.app.getConfig().debug) {\n            console.log(...args);\n        }\n    }\n\n    /**\n     * Initialize global event listeners.\n     * Uses event delegation on document body.\n     */\n    init(): void {\n        this.supportedEvents.forEach(eventType => {\n            const options = (eventType === 'mouseenter' || eventType === 'mouseleave' || eventType === 'focus' || eventType === 'blur' || eventType === 'scroll')\n                ? { capture: true } // These don't bubble nicely or at all in some cases\n                : undefined;\n\n            document.addEventListener(eventType, (e) => this.handleEvent(e), options);\n        });\n    }\n\n    /**\n     * Helper to parse handlers from element (legacy or multiple/JSON).\n     */\n    private getHandlers(element: HTMLElement, eventType: string): Array<{ name: string, modifiers: string[], args?: any[] }> {\n        const handlerAttr = `data-on-${eventType}`;\n        const attrValue = element.getAttribute(handlerAttr);\n        if (!attrValue) return [];\n\n        if (attrValue.trim().startsWith('[')) {\n            try {\n                const handlers = JSON.parse(attrValue);\n                if (Array.isArray(handlers)) {\n                    return handlers.map((h: any) => ({\n                        name: h.handler,\n                        modifiers: h.modifiers || [],\n                        args: h.args\n                    }));\n                }\n            } catch (e) {\n                console.error('Error parsing event handlers:', e);\n            }\n        } else {\n            // Legacy single handler\n            const modifiersAttr = element.getAttribute(`data-modifiers-${eventType}`);\n            const modifiers = modifiersAttr ? modifiersAttr.split(' ').filter(m => m) : [];\n            return [{ name: attrValue, modifiers, args: undefined }];\n        }\n        return [];\n    }\n\n    /**\n     * Main event handler.\n     */\n    private async handleEvent(e: Event): Promise<void> {\n        const eventType = e.type;\n\n        // Skip focus/blur/mouseenter/mouseleave events during DOM updates to prevent loops\n        if (DOMUpdater.isUpdating && this.suppressDuringUpdate.includes(eventType)) {\n            this.debugLog('[Handler] SUPPRESSING event during update:', eventType, 'isUpdating=', DOMUpdater.isUpdating);\n            return;\n        }\n\n        this.debugLog('[Handler] Processing event:', eventType, 'isUpdating=', DOMUpdater.isUpdating);\n\n        // 1. Delegated handlers (standard path walk with bubbling)\n        const path = e.composedPath ? e.composedPath() : [];\n        let propagationStopped = false;\n\n        for (const node of path) {\n            if (propagationStopped) break;\n\n            if (node instanceof HTMLElement) {\n                const element = node;\n                const handlers = this.getHandlers(element, eventType);\n\n                if (handlers.length > 0) {\n                    this.debugLog('[handleEvent] Found handlers on', element.tagName, handlers);\n\n                    for (const h of handlers) {\n                        // Skip if it's a .window or .outside handler - those are handled globally\n                        if (!h.modifiers.includes('window') && !h.modifiers.includes('outside')) {\n                            this.processEvent(element, eventType, h.name, h.modifiers, e, h.args);\n                            if (e.cancelBubble) propagationStopped = true;\n                        }\n                    }\n                }\n            }\n        }\n\n        // 2. Global handlers (.window, .outside)\n        this.handleGlobalEvent(e);\n    }\n\n    /**\n     * Handle modifiers that listen outside the normal delegation path.\n     */\n    private handleGlobalEvent(e: Event): void {\n        const eventType = e.type;\n        const windowSelector = `[data-modifiers-${eventType}*=\"window\"]`;\n        const outsideSelector = `[data-modifiers-${eventType}*=\"outside\"]`;\n\n        const candidates = document.querySelectorAll(`${windowSelector}, ${outsideSelector}`);\n\n        candidates.forEach(el => {\n            if (!(el instanceof HTMLElement)) return;\n\n            const handlers = this.getHandlers(el, eventType);\n            for (const h of handlers) {\n                // .window: trigger regardless of where the event happened\n                if (h.modifiers.includes('window')) {\n                    this.processEvent(el, eventType, h.name, h.modifiers, e, h.args);\n                }\n\n                // .outside: trigger if target is NOT inside this element\n                if (h.modifiers.includes('outside')) {\n                    const target = e.target as Node | null;\n                    if (target && !el.contains(target)) {\n                        this.processEvent(el, eventType, h.name, h.modifiers, e, h.args);\n                    }\n                }\n            }\n        });\n    }\n\n    /**\n     * Process an event for a specific element after it has been matched.\n     */\n    private processEvent(element: HTMLElement, eventType: string, handlerName: string, modifiers: string[], e: Event, explicitArgs?: any[]): void {\n        this.debugLog('[processEvent]', eventType, 'handler:', handlerName, 'modifiers:', modifiers);\n\n        // --- 1. Logic Modifers ---\n\n        // .prevent\n        if (modifiers.includes('prevent') || eventType === 'submit') {\n            this.debugLog('[processEvent] Calling preventDefault');\n            e.preventDefault();\n        }\n\n        // .stop\n        if (modifiers.includes('stop')) {\n            e.stopPropagation();\n        }\n\n        // .self\n        if (modifiers.includes('self')) {\n            if (e.target !== element) return;\n        }\n\n        // --- 2. Filter Modifiers ---\n\n        // System modifiers (Shift, Ctrl, Alt, Meta) - supported on Keyboard and Mouse events\n        if (modifiers.includes('shift') && !(e as any).shiftKey) return;\n        if (modifiers.includes('ctrl') && !(e as any).ctrlKey) return;\n        if (modifiers.includes('alt') && !(e as any).altKey) return;\n        if (modifiers.includes('meta') && !(e as any).metaKey) return;\n        if (modifiers.includes('cmd') && !(e as any).metaKey) return;\n\n        if (e instanceof KeyboardEvent) {\n            // Known key modifiers\n            const knownKeys = ['enter', 'escape', 'space', 'tab', 'up', 'down', 'left', 'right'];\n            // System modifiers that should NOT be treated as key constraints\n            const systemMods = ['shift', 'ctrl', 'alt', 'meta', 'cmd', 'window', 'outside', 'prevent', 'stop', 'self', 'debounce', 'throttle'];\n\n            // Key modifiers are anything that's not a system mod and is either a known key or a single character\n            const keyModifiers = modifiers.filter(m => {\n                if (systemMods.includes(m)) return false;\n                if (m.startsWith('debounce') || m.startsWith('throttle')) return false;\n                if (m.endsWith('ms')) return false; // Duration like 500ms\n                return knownKeys.includes(m) || m.length === 1;\n            });\n\n            if (keyModifiers.length > 0) {\n                const pressedKey = e.key.toLowerCase();\n                this.debugLog('[processEvent] Key check. Pressed:', pressedKey, 'Modifiers:', keyModifiers);\n\n                // Map for special keys\n                const keyMap: Record<string, string> = {\n                    'escape': 'escape',\n                    'esc': 'escape',\n                    'enter': 'enter',\n                    'space': ' ',\n                    'spacebar': ' ',\n                    ' ': ' ',\n                    'tab': 'tab',\n                    'up': 'arrowup',\n                    'arrowup': 'arrowup',\n                    'down': 'arrowdown',\n                    'arrowdown': 'arrowdown',\n                    'left': 'arrowleft',\n                    'arrowleft': 'arrowleft',\n                    'right': 'arrowright',\n                    'arrowright': 'arrowright'\n                };\n\n                // Normalize the pressed key\n                const normalizedPressedKey = keyMap[pressedKey] || pressedKey;\n\n                // Check if any key constraint matches\n                let match = false;\n                for (const constraint of keyModifiers) {\n                    const targetKey = keyMap[constraint] || constraint;\n                    this.debugLog('[processEvent] Comparing constraint:', constraint, '->', targetKey, 'vs', normalizedPressedKey, 'code:', e.code);\n\n                    // Match against key (normalized)\n                    if (targetKey === normalizedPressedKey) {\n                        match = true;\n                        break;\n                    }\n\n                    // Fallback: match against code (e.g. 'h' matches 'KeyH')\n                    // This handles cases where modifiers change the key value (e.g. Alt+H -> \u02D9)\n                    if (e.code && e.code.toLowerCase() === `key${targetKey}`) {\n                        match = true;\n                        break;\n                    }\n                }\n                if (!match) {\n                    this.debugLog('[processEvent] No key match found.');\n                    return;\n                }\n            }\n        }\n\n        // --- 3. Performance Modifiers ---\n        const debounceMod = modifiers.find(m => m.startsWith('debounce'));\n        const throttleMod = modifiers.find(m => m.startsWith('throttle'));\n\n        const elementId = element.id || this.getUniqueId(element);\n        const eventKey = `${elementId}-${eventType}-${handlerName}`;\n\n        if (debounceMod) {\n            const duration = this.parseDuration(modifiers, 250);\n\n            if (this.debouncers.has(eventKey)) {\n                window.clearTimeout(this.debouncers.get(eventKey));\n            }\n\n            const timer = window.setTimeout(() => {\n                this.debouncers.delete(eventKey);\n                this.dispatchEvent(element, eventType, handlerName, e, explicitArgs);\n            }, duration);\n\n            this.debouncers.set(eventKey, timer);\n            return;\n        }\n\n        if (throttleMod) {\n            const duration = this.parseDuration(modifiers, 250);\n            if (this.throttlers.has(eventKey)) return;\n\n            this.throttlers.set(eventKey, Date.now());\n            // Execute immediately\n            this.dispatchEvent(element, eventType, handlerName, e, explicitArgs);\n\n            window.setTimeout(() => {\n                this.throttlers.delete(eventKey);\n            }, duration);\n            return;\n        }\n\n        // Direct dispatch\n        this.dispatchEvent(element, eventType, handlerName, e, explicitArgs);\n    }\n\n    /**\n     * Extract data and send event.\n     */\n    private dispatchEvent(element: HTMLElement, eventType: string, handler: string, e: Event, explicitArgs?: any[]): void {\n        // Merge explicit args (from JSON) into args payload\n        let args: Record<string, any> = {};\n        if (explicitArgs && explicitArgs.length > 0) {\n            explicitArgs.forEach((val: any, i: number) => {\n                args[`arg${i}`] = val;\n            });\n        } else {\n            args = this.getArgs(element);\n        }\n\n        const eventData: EventData = {\n            type: eventType,\n            id: element.id,\n            args: args\n        };\n\n        // Extract specific data based on element type\n        if (element instanceof HTMLInputElement) {\n            eventData.value = element.value;\n            if (element.type === 'checkbox' || element.type === 'radio') {\n                eventData.checked = element.checked;\n            }\n        } else if (element instanceof HTMLTextAreaElement || element instanceof HTMLSelectElement) {\n            eventData.value = element.value;\n        }\n\n        // Extract Key data\n        if (e instanceof KeyboardEvent) {\n            eventData.key = e.key;\n            eventData.keyCode = e.keyCode;\n        }\n\n        // Extract Form Data for submit\n        if (eventType === 'submit' && element instanceof HTMLFormElement) {\n            const formData = new FormData(element);\n            const data: Record<string, any> = {};\n            formData.forEach((value, key) => {\n                if (!(value instanceof File)) {\n                    data[key] = value.toString();\n                }\n            });\n            eventData.formData = data;\n        }\n\n        this.app.sendEvent(handler, eventData);\n    }\n\n    private parseDuration(modifiers: string[], defaultDuration: number): number {\n        const debounceIdx = modifiers.findIndex(m => m.startsWith('debounce'));\n        const throttleIdx = modifiers.findIndex(m => m.startsWith('throttle'));\n        const idx = debounceIdx !== -1 ? debounceIdx : throttleIdx;\n\n        if (idx !== -1 && modifiers[idx + 1]) {\n            const next = modifiers[idx + 1];\n            if (next.endsWith('ms')) {\n                const val = parseInt(next);\n                if (!isNaN(val)) return val;\n            }\n        }\n\n        // Support hyphenated: debounce-500ms\n        const mod = modifiers[idx];\n        if (mod && mod.includes('-')) {\n            const parts = mod.split('-');\n            const val = parseInt(parts[1]);\n            if (!isNaN(val)) return val;\n        }\n\n        return defaultDuration;\n    }\n\n    private getUniqueId(element: HTMLElement): string {\n        if (!element.id) {\n            element.id = 'pyhtml-uid-' + Math.random().toString(36).substr(2, 9);\n        }\n        return element.id;\n    }\n\n    private getArgs(element: Element): Record<string, unknown> {\n        const args: Record<string, unknown> = {};\n        if (element instanceof HTMLElement) {\n            for (const key in element.dataset) {\n                if (key.startsWith('arg')) {\n                    try {\n                        args[key] = JSON.parse(element.dataset[key] || 'null');\n                    } catch (e) {\n                        args[key] = element.dataset[key];\n                    }\n                }\n            }\n        }\n        return args;\n    }\n}\n", "import { TransportManager, TransportConfig } from './transport-manager';\nimport { DOMUpdater } from './dom-updater';\nimport { ServerMessage, ClientMessage, EventData, RelocateMessage } from './transports';\nimport { UnifiedEventHandler } from '../events/handler';\n\nexport interface PyHTMLConfig extends TransportConfig {\n    /** Auto-initialize on DOMContentLoaded */\n    autoInit?: boolean;\n    /** Enable verbose debug logging */\n    debug?: boolean;\n}\n\nconst DEFAULT_CONFIG: PyHTMLConfig = {\n    autoInit: true,\n    enableWebTransport: true,\n    enableWebSocket: true,\n    enableHTTP: true,\n    debug: false\n};\n\n/**\n * Core PyHTML Application class.\n * Provides transport, DOM updates, SPA navigation, and event handling.\n * Dev-only features (status overlay, error traces) are in the dev bundle.\n */\nexport class PyHTMLApp {\n    protected transport: TransportManager;\n    protected updater: DOMUpdater;\n    protected eventHandler: UnifiedEventHandler;\n    protected initialized = false;\n    protected config: PyHTMLConfig;\n    protected siblingPaths: string[] = [];\n    protected pathRegexes: RegExp[] = [];\n    protected pjaxEnabled = false;\n    protected isConnected = false;\n\n    constructor(config: Partial<PyHTMLConfig> = {}) {\n        this.config = { ...DEFAULT_CONFIG, ...config };\n        this.transport = new TransportManager(this.config);\n        this.updater = new DOMUpdater(this.config.debug);\n        this.eventHandler = new UnifiedEventHandler(this);\n    }\n\n    getConfig(): PyHTMLConfig {\n        return this.config;\n    }\n\n    /**\n     * Initialize the PyHTML application.\n     */\n    async init(): Promise<void> {\n        if (this.initialized) return;\n        this.initialized = true;\n\n        // Setup message handling\n        this.transport.onMessage((msg) => this.handleMessage(msg));\n        this.transport.onStatusChange((connected) => this.handleStatusChange(connected));\n\n        // Connect transport with fallback\n        try {\n            await this.transport.connect();\n        } catch (e) {\n            console.error('PyHTML: Failed to connect:', e);\n        }\n\n        // Load SPA metadata and setup navigation\n        this.loadSPAMetadata();\n        this.setupSPANavigation();\n\n        // Setup event interception via UnifiedEventHandler\n        this.eventHandler.init();\n\n        console.log(`PyHTML: Initialized (transport: ${this.transport.getActiveTransport()}, spa_paths: ${this.siblingPaths.length}, pjax: ${this.pjaxEnabled})`);\n    }\n\n    /**\n     * Handle connection status changes. Override in dev bundle for UI.\n     */\n    protected handleStatusChange(connected: boolean): void {\n        this.isConnected = connected;\n        // Base implementation: no UI, just track state\n    }\n\n    /**\n     * Load SPA navigation metadata from injected script tag.\n     */\n    protected loadSPAMetadata(): void {\n        const metaScript = document.getElementById('_pyhtml_spa_meta');\n        if (metaScript) {\n            try {\n                const meta = JSON.parse(metaScript.textContent || '{}');\n                this.siblingPaths = meta.sibling_paths || [];\n                this.pjaxEnabled = !!meta.enable_pjax;\n                if (meta.debug !== undefined) {\n                    this.config.debug = !!meta.debug;\n                }\n                // Convert path patterns to regexes for matching\n                this.pathRegexes = this.siblingPaths.map(p => this.patternToRegex(p));\n            } catch (e) {\n                console.warn('PyHTML: Failed to parse SPA metadata', e);\n            }\n        }\n    }\n\n    /**\n     * Convert route pattern like '/a/:id' to regex.\n     */\n    protected patternToRegex(pattern: string): RegExp {\n        // Escape special regex chars except for our placeholders\n        let regex = pattern.replace(/[.+?^${}()|[\\]\\\\]/g, '\\\\$&');\n        // Replace :param:type or :param with capture groups\n        regex = regex.replace(/:(\\\\w+)(:\\\\w+)?/g, '([^/]+)');\n        // Replace {param:type} or {param} with capture groups\n        regex = regex.replace(/\\\\{(\\\\w+)(:\\\\w+)?\\\\}/g, '([^/]+)');\n        return new RegExp(`^${regex}$`);\n    }\n\n    /**\n     * Check if a path matches any sibling path pattern.\n     */\n    protected isSiblingPath(path: string): boolean {\n        return this.pathRegexes.some(regex => regex.test(path));\n    }\n\n    /**\n     * Setup SPA navigation for sibling paths.\n     */\n    protected setupSPANavigation(): void {\n        // Handle browser back/forward\n        window.addEventListener('popstate', () => {\n            this.sendRelocate(window.location.pathname + window.location.search);\n        });\n\n        if (this.siblingPaths.length === 0 && !this.pjaxEnabled) return;\n\n        // Intercept link clicks\n        document.addEventListener('click', (e) => {\n            const link = (e.target as Element).closest('a[href]') as HTMLAnchorElement | null;\n            if (!link) return;\n\n            // Only intercept same-origin links\n            if (link.origin !== window.location.origin) return;\n\n            // Ignore special links\n            if (link.hasAttribute('download') || link.target === '_blank') return;\n\n            // Check if matches criteria\n            let shouldIntercept = false;\n\n            if (this.pjaxEnabled) {\n                shouldIntercept = true;\n            } else if (this.isSiblingPath(link.pathname)) {\n                shouldIntercept = true;\n            }\n\n            if (shouldIntercept) {\n                e.preventDefault();\n                this.navigateTo(link.pathname + link.search);\n            }\n        });\n    }\n\n    /**\n     * Navigate to a path using SPA navigation.\n     */\n    navigateTo(path: string): void {\n        if (!this.isConnected) {\n            console.warn('PyHTML: Navigation blocked - Offline');\n            return;\n        }\n\n        history.pushState({}, '', path);\n        this.sendRelocate(path);\n    }\n\n    /**\n     * Send relocate message to server.\n     */\n    protected sendRelocate(path: string): void {\n        const message: RelocateMessage = {\n            type: 'relocate',\n            path\n        };\n        this.transport.send(message);\n    }\n\n    /**\n     * Send an event to the server.\n     */\n    sendEvent(handler: string, data: EventData): void {\n        const message: ClientMessage = {\n            type: 'event',\n            handler,\n            path: window.location.pathname + window.location.search,\n            data\n        };\n        this.transport.send(message);\n    }\n\n    /**\n     * Handle incoming server message. Override in dev bundle for error_trace.\n     */\n    protected async handleMessage(msg: ServerMessage): Promise<void> {\n        switch (msg.type) {\n            case 'update':\n                if (msg.html) {\n                    this.updater.update(msg.html);\n                }\n                break;\n\n            case 'reload':\n                console.log('PyHTML: Reloading...');\n                window.location.reload();\n                break;\n\n            case 'error':\n                console.error('PyHTML: Server error:', msg.error);\n                break;\n\n            case 'error_trace':\n                // In core bundle, just log the error (no source loading)\n                console.error('PyHTML: Error:', msg.error);\n                break;\n\n            case 'console':\n                if (msg.lines && msg.lines.length > 0) {\n                    const prefix = 'PyHTML Server:';\n                    const joined = msg.lines.join('\\n');\n                    if (msg.level === 'error') {\n                        console.error(prefix, joined);\n                    } else if (msg.level === 'warn') {\n                        console.warn(prefix, joined);\n                    } else {\n                        console.log(prefix, joined);\n                    }\n                }\n                break;\n\n            default:\n                console.warn('PyHTML: Unknown message type', msg);\n        }\n    }\n\n    /**\n     * Get the current transport name.\n     */\n    getTransport(): string | null {\n        return this.transport.getActiveTransport();\n    }\n\n    /**\n     * Disconnect from the server.\n     */\n    disconnect(): void {\n        this.transport.disconnect();\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AC8EO,MAAe,gBAAf,MAAkD;AAAA,IAAlD;AACH,WAAU,kBAAoC,CAAC;AAC/C,WAAU,iBAAmD,CAAC;AAC9D,WAAU,YAAY;AAAA;AAAA,IAOtB,UAAU,SAA+B;AACrC,WAAK,gBAAgB,KAAK,OAAO;AAAA,IACrC;AAAA,IAEA,eAAe,SAA6C;AACxD,WAAK,eAAe,KAAK,OAAO;AAAA,IACpC;AAAA,IAEA,cAAuB;AACnB,aAAO,KAAK;AAAA,IAChB;AAAA,IAEU,eAAe,SAA8B;AACnD,iBAAW,WAAW,KAAK,iBAAiB;AACxC,YAAI;AACA,kBAAQ,OAAO;AAAA,QACnB,SAAS,GAAG;AACR,kBAAQ,MAAM,oCAAoC,CAAC;AAAA,QACvD;AAAA,MACJ;AAAA,IACJ;AAAA,IAEU,aAAa,WAA0B;AAC7C,UAAI,KAAK,cAAc;AAAW;AAClC,WAAK,YAAY;AACjB,iBAAW,WAAW,KAAK,gBAAgB;AACvC,YAAI;AACA,kBAAQ,SAAS;AAAA,QACrB,SAAS,GAAG;AACR,kBAAQ,MAAM,mCAAmC,CAAC;AAAA,QACtD;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;;;ACnHO,MAAM,wBAAN,MAAM,+BAA8B,cAAc;AAAA,IASrD,YAAY,KAAc;AACtB,YAAM;AATV,WAAS,OAAO;AAEhB,WAAQ,YAAiC;AACzC,WAAQ,SAAyD;AAEjE,WAAQ,UAAU,IAAI,YAAY;AAClC,WAAQ,UAAU,IAAI,YAAY;AAI9B,WAAK,MAAM,OAAO,KAAK,cAAc;AAAA,IACzC;AAAA,IAEQ,gBAAwB;AAE5B,aAAO,WAAW,OAAO,SAAS,IAAI;AAAA,IAC1C;AAAA;AAAA;AAAA;AAAA,IAKA,OAAO,cAAuB;AAC1B,aAAO,OAAO,iBAAiB;AAAA,IACnC;AAAA,IAEA,MAAM,UAAyB;AAC3B,UAAI,CAAC,uBAAsB,YAAY,GAAG;AACtC,cAAM,IAAI,MAAM,4CAA4C;AAAA,MAChE;AAEA,UAAI;AAEA,cAAM,UAAe,CAAC;AACtB,cAAM,WAAY,OAAe;AACjC,YAAI,YAAY,MAAM,QAAQ,QAAQ,GAAG;AACrC,kBAAQ,0BAA0B,CAAC;AAAA,YAC/B,WAAW;AAAA,YACX,OAAO,IAAI,WAAW,QAAQ;AAAA,UAClC,CAAC;AACD,kBAAQ,IAAI,0DAA0D;AAAA,QAC1E;AAEA,aAAK,YAAY,IAAI,aAAa,KAAK,KAAK,OAAO;AAGnD,cAAM,KAAK,UAAU;AAErB,gBAAQ,IAAI,4BAA4B;AACxC,aAAK,YAAY;AAGjB,aAAK,aAAa;AAAA,MAEtB,SAAS,GAAG;AACR,aAAK,iBAAiB;AACtB,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,IAEA,MAAc,eAA8B;AACxC,UAAI,CAAC,KAAK;AAAW;AAGrB,YAAM,SAAS,KAAK,UAAU,6BAA6B,UAAU;AAErE,UAAI;AACA,eAAO,MAAM;AACT,gBAAM,EAAE,OAAO,QAAQ,KAAK,IAAI,MAAM,OAAO,KAAK;AAClD,cAAI;AAAM;AAGV,eAAK,aAAa,MAAM;AAAA,QAC5B;AAAA,MACJ,SAAS,GAAG;AACR,YAAI,KAAK,WAAW;AAChB,kBAAQ,MAAM,mCAAmC,CAAC;AAClD,eAAK,iBAAiB;AAAA,QAC1B;AAAA,MACJ;AAAA,IACJ;AAAA,IAEA,MAAc,aAAa,QAAwD;AAC/E,YAAM,SAAS,OAAO,SAAS,UAAU;AAEzC,UAAI;AACA,eAAO,MAAM;AACT,gBAAM,EAAE,OAAO,KAAK,IAAI,MAAM,OAAO,KAAK;AAC1C,cAAI;AAAM;AAEV,cAAI,OAAO;AACP,kBAAM,OAAO,KAAK,QAAQ,OAAO,KAAK;AACtC,gBAAI;AACA,oBAAM,MAAM,KAAK,MAAM,IAAI;AAC3B,mBAAK,eAAe,GAAG;AAAA,YAC3B,SAAS,GAAG;AACR,sBAAQ,MAAM,8CAA8C,CAAC;AAAA,YACjE;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,SAAS,GAAG;AACR,gBAAQ,MAAM,6BAA6B,CAAC;AAAA,MAChD;AAAA,IACJ;AAAA,IAEA,MAAM,KAAK,SAAgC;AACvC,UAAI,CAAC,KAAK,aAAa,CAAC,KAAK,WAAW;AACpC,gBAAQ,KAAK,yDAAyD;AACtE;AAAA,MACJ;AAEA,UAAI;AAEA,cAAM,SAAS,MAAM,KAAK,UAAU,0BAA0B;AAC9D,cAAM,SAAS,OAAO,SAAS,UAAU;AAEzC,cAAM,OAAO,KAAK,QAAQ,OAAO,KAAK,UAAU,OAAO,CAAC;AACxD,cAAM,OAAO,MAAM,IAAI;AACvB,cAAM,OAAO,MAAM;AAGnB,aAAK,aAAa,MAAM;AAAA,MAE5B,SAAS,GAAG;AACR,gBAAQ,MAAM,mCAAmC,CAAC;AAAA,MACtD;AAAA,IACJ;AAAA,IAEA,aAAmB;AACf,UAAI,KAAK,WAAW;AAChB,aAAK,UAAU,MAAM;AACrB,aAAK,YAAY;AAAA,MACrB;AACA,WAAK,SAAS;AACd,WAAK,YAAY;AAAA,IACrB;AAAA,IAEQ,mBAAyB;AAC7B,WAAK,YAAY;AACjB,WAAK,YAAY;AACjB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;;;ACpJM,WAAU,UAAU,KAAqB;AAC7C,UAAM,YAAY,IAAI;AAEtB,QAAI,aAAa;AACjB,QAAI,MAAM;AACV,WAAO,MAAM,WAAW;AACtB,UAAI,QAAQ,IAAI,WAAW,KAAK;AAEhC,WAAK,QAAQ,gBAAgB,GAAG;AAE9B;AACA;MACF,YAAY,QAAQ,gBAAgB,GAAG;AAErC,sBAAc;MAChB,OAAO;AAEL,YAAI,SAAS,SAAU,SAAS,OAAQ;AAEtC,cAAI,MAAM,WAAW;AACnB,kBAAM,QAAQ,IAAI,WAAW,GAAG;AAChC,iBAAK,QAAQ,WAAY,OAAQ;AAC/B,gBAAE;AACF,wBAAU,QAAQ,SAAU,OAAO,QAAQ,QAAS;YACtD;UACF;QACF;AAEA,aAAK,QAAQ,gBAAgB,GAAG;AAE9B,wBAAc;QAChB,OAAO;AAEL,wBAAc;QAChB;MACF;IACF;AACA,WAAO;EAAW;AAGd,WAAU,aAAa,KAAa,QAAoB,cAA4B;AACxF,UAAM,YAAY,IAAI;AACtB,QAAI,SAAS;AACb,QAAI,MAAM;AACV,WAAO,MAAM,WAAW;AACtB,UAAI,QAAQ,IAAI,WAAW,KAAK;AAEhC,WAAK,QAAQ,gBAAgB,GAAG;AAE9B,eAAO,QAAQ,IAAI;AACnB;MACF,YAAY,QAAQ,gBAAgB,GAAG;AAErC,eAAO,QAAQ,IAAM,SAAS,IAAK,KAAQ;MAC7C,OAAO;AAEL,YAAI,SAAS,SAAU,SAAS,OAAQ;AAEtC,cAAI,MAAM,WAAW;AACnB,kBAAM,QAAQ,IAAI,WAAW,GAAG;AAChC,iBAAK,QAAQ,WAAY,OAAQ;AAC/B,gBAAE;AACF,wBAAU,QAAQ,SAAU,OAAO,QAAQ,QAAS;YACtD;UACF;QACF;AAEA,aAAK,QAAQ,gBAAgB,GAAG;AAE9B,iBAAO,QAAQ,IAAM,SAAS,KAAM,KAAQ;AAC5C,iBAAO,QAAQ,IAAM,SAAS,IAAK,KAAQ;QAC7C,OAAO;AAEL,iBAAO,QAAQ,IAAM,SAAS,KAAM,IAAQ;AAC5C,iBAAO,QAAQ,IAAM,SAAS,KAAM,KAAQ;AAC5C,iBAAO,QAAQ,IAAM,SAAS,IAAK,KAAQ;QAC7C;MACF;AAEA,aAAO,QAAQ,IAAK,QAAQ,KAAQ;IACtC;EAAC;AAUH,MAAM,oBAAoB,IAAI,YAAW;AAIzC,MAAM,yBAAyB;AAEzB,WAAU,aAAa,KAAa,QAAoB,cAA4B;AACxF,sBAAkB,WAAW,KAAK,OAAO,SAAS,YAAY,CAAC;EAAE;AAG7D,WAAU,WAAW,KAAa,QAAoB,cAA4B;AACtF,QAAI,IAAI,SAAS,wBAAwB;AACvC,mBAAa,KAAK,QAAQ,YAAY;IACxC,OAAO;AACL,mBAAa,KAAK,QAAQ,YAAY;IACxC;EAAC;AAGH,MAAM,aAAa;AAEb,WAAU,aAAa,OAAmB,aAAqB,YAA4B;AAC/F,QAAI,SAAS;AACb,UAAM,MAAM,SAAS;AAErB,UAAM,QAAuB,CAAA;AAC7B,QAAI,SAAS;AACb,WAAO,SAAS,KAAK;AACnB,YAAM,QAAQ,MAAM,QAAQ;AAC5B,WAAK,QAAQ,SAAU,GAAG;AAExB,cAAM,KAAK,KAAK;MAClB,YAAY,QAAQ,SAAU,KAAM;AAElC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,cAAM,MAAO,QAAQ,OAAS,IAAK,KAAK;MAC1C,YAAY,QAAQ,SAAU,KAAM;AAElC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,cAAM,MAAO,QAAQ,OAAS,KAAO,SAAS,IAAK,KAAK;MAC1D,YAAY,QAAQ,SAAU,KAAM;AAElC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,cAAM,QAAQ,MAAM,QAAQ,IAAK;AACjC,YAAI,QAAS,QAAQ,MAAS,KAAS,SAAS,KAAS,SAAS,IAAQ;AAC1E,YAAI,OAAO,OAAQ;AACjB,kBAAQ;AACR,gBAAM,KAAO,SAAS,KAAM,OAAS,KAAM;AAC3C,iBAAO,QAAU,OAAO;QAC1B;AACA,cAAM,KAAK,IAAI;MACjB,OAAO;AACL,cAAM,KAAK,KAAK;MAClB;AAEA,UAAI,MAAM,UAAU,YAAY;AAC9B,kBAAU,OAAO,aAAa,GAAG,KAAK;AACtC,cAAM,SAAS;MACjB;IACF;AAEA,QAAI,MAAM,SAAS,GAAG;AACpB,gBAAU,OAAO,aAAa,GAAG,KAAK;IACxC;AAEA,WAAO;EAAO;AAGhB,MAAM,oBAAoB,IAAI,YAAW;AAIzC,MAAM,yBAAyB;AAEzB,WAAU,aAAa,OAAmB,aAAqB,YAA4B;AAC/F,UAAM,cAAc,MAAM,SAAS,aAAa,cAAc,UAAU;AACxE,WAAO,kBAAkB,OAAO,WAAW;EAAE;AAGzC,WAAU,WAAW,OAAmB,aAAqB,YAA4B;AAC7F,QAAI,aAAa,wBAAwB;AACvC,aAAO,aAAa,OAAO,aAAa,UAAU;IACpD,OAAO;AACL,aAAO,aAAa,OAAO,aAAa,UAAU;IACpD;EAAC;;;AC5KG,MAAO,UAAP,MAAc;IAIlB,YAAY,MAAc,MAAkD;AAHnE;AACA;AAGP,WAAK,OAAO;AACZ,WAAK,OAAO;IAAK;;;;ACTf,MAAO,cAAP,MAAO,qBAAoB,MAAK;IACpC,YAAY,SAAiB;AAC3B,YAAM,OAAO;AAGb,YAAM,QAAsC,OAAO,OAAO,aAAY,SAAS;AAC/E,aAAO,eAAe,MAAM,KAAK;AAEjC,aAAO,eAAe,MAAM,QAAQ;QAClC,cAAc;QACd,YAAY;QACZ,OAAO,aAAY;OACpB;IAAE;;;;ACVA,MAAM,aAAa;AAKpB,WAAU,UAAU,MAAgB,QAAgB,OAAqB;AAC7E,UAAM,OAAO,QAAQ;AACrB,UAAM,MAAM;AACZ,SAAK,UAAU,QAAQ,IAAI;AAC3B,SAAK,UAAU,SAAS,GAAG,GAAG;EAAE;AAG5B,WAAU,SAAS,MAAgB,QAAgB,OAAqB;AAC5E,UAAM,OAAO,KAAK,MAAM,QAAQ,UAAa;AAC7C,UAAM,MAAM;AACZ,SAAK,UAAU,QAAQ,IAAI;AAC3B,SAAK,UAAU,SAAS,GAAG,GAAG;EAAE;AAG5B,WAAU,SAAS,MAAgB,QAAwB;AAC/D,UAAM,OAAO,KAAK,SAAS,MAAM;AACjC,UAAM,MAAM,KAAK,UAAU,SAAS,CAAC;AACrC,WAAO,OAAO,aAAgB;EAAI;AAG9B,WAAU,UAAU,MAAgB,QAAwB;AAChE,UAAM,OAAO,KAAK,UAAU,MAAM;AAClC,UAAM,MAAM,KAAK,UAAU,SAAS,CAAC;AACrC,WAAO,OAAO,aAAgB;EAAI;;;AC1B7B,MAAM,gBAAgB;AAO7B,MAAM,sBAAsB,aAAc;AAC1C,MAAM,sBAAsB,cAAc;AAEpC,WAAU,0BAA0B,EAAE,KAAK,KAAI,GAA0B;AAC7E,QAAI,OAAO,KAAK,QAAQ,KAAK,OAAO,qBAAqB;AAEvD,UAAI,SAAS,KAAK,OAAO,qBAAqB;AAE5C,cAAM,KAAK,IAAI,WAAW,CAAC;AAC3B,cAAM,OAAO,IAAI,SAAS,GAAG,MAAM;AACnC,aAAK,UAAU,GAAG,GAAG;AACrB,eAAO;MACT,OAAO;AAEL,cAAM,UAAU,MAAM;AACtB,cAAM,SAAS,MAAM;AACrB,cAAM,KAAK,IAAI,WAAW,CAAC;AAC3B,cAAM,OAAO,IAAI,SAAS,GAAG,MAAM;AAEnC,aAAK,UAAU,GAAI,QAAQ,IAAM,UAAU,CAAI;AAE/C,aAAK,UAAU,GAAG,MAAM;AACxB,eAAO;MACT;IACF,OAAO;AAEL,YAAM,KAAK,IAAI,WAAW,EAAE;AAC5B,YAAM,OAAO,IAAI,SAAS,GAAG,MAAM;AACnC,WAAK,UAAU,GAAG,IAAI;AACtB,eAAS,MAAM,GAAG,GAAG;AACrB,aAAO;IACT;EAAC;AAGG,WAAU,qBAAqB,MAAsB;AACzD,UAAM,OAAO,KAAK,QAAO;AACzB,UAAM,MAAM,KAAK,MAAM,OAAO,GAAG;AACjC,UAAM,QAAQ,OAAO,MAAM,OAAO;AAGlC,UAAM,YAAY,KAAK,MAAM,OAAO,GAAG;AACvC,WAAO;MACL,KAAK,MAAM;MACX,MAAM,OAAO,YAAY;;EACzB;AAGE,WAAU,yBAAyB,QAAoC;AAC3E,QAAI,kBAAkB,MAAM;AAC1B,YAAM,WAAW,qBAAqB,MAAM;AAC5C,aAAO,0BAA0B,QAAQ;IAC3C,OAAO;AACL,aAAO;IACT;EAAC;AAGG,WAAU,0BAA0B,MAA4B;AACpE,UAAM,OAAO,IAAI,SAAS,KAAK,QAAQ,KAAK,YAAY,KAAK,UAAU;AAGvE,YAAQ,KAAK,YAAY;MACvB,KAAK,GAAG;AAEN,cAAM,MAAM,KAAK,UAAU,CAAC;AAC5B,cAAM,OAAO;AACb,eAAO,EAAE,KAAK,KAAI;MACpB;MACA,KAAK,GAAG;AAEN,cAAM,oBAAoB,KAAK,UAAU,CAAC;AAC1C,cAAM,WAAW,KAAK,UAAU,CAAC;AACjC,cAAM,OAAO,oBAAoB,KAAO,aAAc;AACtD,cAAM,OAAO,sBAAsB;AACnC,eAAO,EAAE,KAAK,KAAI;MACpB;MACA,KAAK,IAAI;AAGP,cAAM,MAAM,SAAS,MAAM,CAAC;AAC5B,cAAM,OAAO,KAAK,UAAU,CAAC;AAC7B,eAAO,EAAE,KAAK,KAAI;MACpB;MACA;AACE,cAAM,IAAI,YAAY,gEAAgE,KAAK,MAAM,EAAE;IACvG;EAAC;AAGG,WAAU,yBAAyB,MAAwB;AAC/D,UAAM,WAAW,0BAA0B,IAAI;AAC/C,WAAO,IAAI,KAAK,SAAS,MAAM,MAAM,SAAS,OAAO,GAAG;EAAE;AAGrD,MAAM,qBAAqB;IAChC,MAAM;IACN,QAAQ;IACR,QAAQ;;;;AClFJ,MAAO,kBAAP,MAAO,gBAAc;IAgBzB,cAAqB;AAVrB;;;;AAGiB;6CAA+E,CAAA;AAC/E,6CAA+E,CAAA;AAG/E;sCAAwE,CAAA;AACxE,sCAAwE,CAAA;AAGvF,WAAK,SAAS,kBAAkB;IAAE;IAG7B,SAAS,EACd,MACA,QAAAA,SACA,QAAAC,QAAM,GAKC;AACP,UAAI,QAAQ,GAAG;AAEb,aAAK,SAAS,IAAI,IAAID;AACtB,aAAK,SAAS,IAAI,IAAIC;MACxB,OAAO;AAEL,cAAM,QAAQ,KAAK;AACnB,aAAK,gBAAgB,KAAK,IAAID;AAC9B,aAAK,gBAAgB,KAAK,IAAIC;MAChC;IAAC;IAGI,YAAY,QAAiB,SAAsC;AAExE,eAAS,IAAI,GAAG,IAAI,KAAK,gBAAgB,QAAQ,KAAK;AACpD,cAAM,YAAY,KAAK,gBAAgB,CAAC;AACxC,YAAI,aAAa,MAAM;AACrB,gBAAM,OAAO,UAAU,QAAQ,OAAO;AACtC,cAAI,QAAQ,MAAM;AAChB,kBAAM,OAAO,KAAK;AAClB,mBAAO,IAAI,QAAQ,MAAM,IAAI;UAC/B;QACF;MACF;AAGA,eAAS,IAAI,GAAG,IAAI,KAAK,SAAS,QAAQ,KAAK;AAC7C,cAAM,YAAY,KAAK,SAAS,CAAC;AACjC,YAAI,aAAa,MAAM;AACrB,gBAAM,OAAO,UAAU,QAAQ,OAAO;AACtC,cAAI,QAAQ,MAAM;AAChB,kBAAM,OAAO;AACb,mBAAO,IAAI,QAAQ,MAAM,IAAI;UAC/B;QACF;MACF;AAEA,UAAI,kBAAkB,SAAS;AAE7B,eAAO;MACT;AACA,aAAO;IAAK;IAGP,OAAO,MAAkB,MAAc,SAA+B;AAC3E,YAAM,YAAY,OAAO,IAAI,KAAK,gBAAgB,KAAK,IAAI,IAAI,KAAK,SAAS,IAAI;AACjF,UAAI,WAAW;AACb,eAAO,UAAU,MAAM,MAAM,OAAO;MACtC,OAAO;AAEL,eAAO,IAAI,QAAQ,MAAM,IAAI;MAC/B;IAAC;;AA/EI,gBADI,iBACY,gBAA8C,IAAI,gBAAc;AADnF,MAAO,iBAAP;;;ACxBN,WAAS,kBAAkB,QAA4C;AACrE,WACE,kBAAkB,eAAgB,OAAO,sBAAsB,eAAe,kBAAkB;EAChG;AAGE,WAAU,iBACd,QAC6B;AAC7B,QAAI,kBAAkB,YAAY;AAChC,aAAO;IACT,WAAW,YAAY,OAAO,MAAM,GAAG;AACrC,aAAO,IAAI,WAAW,OAAO,QAAQ,OAAO,YAAY,OAAO,UAAU;IAC3E,WAAW,kBAAkB,MAAM,GAAG;AACpC,aAAO,IAAI,WAAW,MAAM;IAC9B,OAAO;AAEL,aAAO,WAAW,KAAK,MAAM;IAC/B;EAAC;;;ACVI,MAAM,oBAAoB;AAC1B,MAAM,8BAA8B;AAiErC,MAAO,UAAP,MAAO,SAAO;IAiBlB,YAAmB,SAAuC;AAhBzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAET;AACA;AACA;AAEA,qCAAU;AAGhB,WAAK,iBAAiB,SAAS,kBAAmB,eAAe;AACjE,WAAK,UAAW,SAAkD;AAElE,WAAK,cAAc,SAAS,eAAe;AAC3C,WAAK,WAAW,SAAS,YAAY;AACrC,WAAK,oBAAoB,SAAS,qBAAqB;AACvD,WAAK,WAAW,SAAS,YAAY;AACrC,WAAK,eAAe,SAAS,gBAAgB;AAC7C,WAAK,kBAAkB,SAAS,mBAAmB;AACnD,WAAK,sBAAsB,SAAS,uBAAuB;AAE3D,WAAK,MAAM;AACX,WAAK,OAAO,IAAI,SAAS,IAAI,YAAY,KAAK,iBAAiB,CAAC;AAChE,WAAK,QAAQ,IAAI,WAAW,KAAK,KAAK,MAAM;IAAE;IAGxC,QAAQ;AAId,aAAO,IAAI,SAAqB;QAC9B,gBAAgB,KAAK;QACrB,SAAS,KAAK;QACd,aAAa,KAAK;QAClB,UAAU,KAAK;QACf,mBAAmB,KAAK;QACxB,UAAU,KAAK;QACf,cAAc,KAAK;QACnB,iBAAiB,KAAK;QACtB,qBAAqB,KAAK;OACpB;IAAE;IAGJ,oBAAoB;AAC1B,WAAK,MAAM;IAAE;;;;;;IAQR,gBAAgB,QAA0C;AAC/D,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,gBAAgB,MAAM;MACxC;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,aAAK,kBAAiB;AACtB,aAAK,SAAS,QAAQ,CAAC;AACvB,eAAO,KAAK,MAAM,SAAS,GAAG,KAAK,GAAG;MACxC;AACE,aAAK,UAAU;MACjB;IAAC;;;;IAMI,OAAO,QAA0C;AACtD,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,OAAO,MAAM;MAC/B;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,aAAK,kBAAiB;AACtB,aAAK,SAAS,QAAQ,CAAC;AACvB,eAAO,KAAK,MAAM,MAAM,GAAG,KAAK,GAAG;MACrC;AACE,aAAK,UAAU;MACjB;IAAC;IAGK,SAAS,QAAiB,OAAqB;AACrD,UAAI,QAAQ,KAAK,UAAU;AACzB,cAAM,IAAI,MAAM,6BAA6B,KAAK,EAAE;MACtD;AAEA,UAAI,UAAU,MAAM;AAClB,aAAK,UAAS;MAChB,WAAW,OAAO,WAAW,WAAW;AACtC,aAAK,cAAc,MAAM;MAC3B,WAAW,OAAO,WAAW,UAAU;AACrC,YAAI,CAAC,KAAK,qBAAqB;AAC7B,eAAK,aAAa,MAAM;QAC1B,OAAO;AACL,eAAK,oBAAoB,MAAM;QACjC;MACF,WAAW,OAAO,WAAW,UAAU;AACrC,aAAK,aAAa,MAAM;MAC1B,WAAW,KAAK,eAAe,OAAO,WAAW,UAAU;AACzD,aAAK,eAAe,MAAM;MAC5B,OAAO;AACL,aAAK,aAAa,QAAQ,KAAK;MACjC;IAAC;IAGK,wBAAwB,aAAqB;AACnD,YAAM,eAAe,KAAK,MAAM;AAEhC,UAAI,KAAK,KAAK,aAAa,cAAc;AACvC,aAAK,aAAa,eAAe,CAAC;MACpC;IAAC;IAGK,aAAa,SAAiB;AACpC,YAAM,YAAY,IAAI,YAAY,OAAO;AACzC,YAAM,WAAW,IAAI,WAAW,SAAS;AACzC,YAAM,UAAU,IAAI,SAAS,SAAS;AAEtC,eAAS,IAAI,KAAK,KAAK;AAEvB,WAAK,OAAO;AACZ,WAAK,QAAQ;IAAS;IAGhB,YAAY;AAClB,WAAK,QAAQ,GAAI;IAAE;IAGb,cAAc,QAAiB;AACrC,UAAI,WAAW,OAAO;AACpB,aAAK,QAAQ,GAAI;MACnB,OAAO;AACL,aAAK,QAAQ,GAAI;MACnB;IAAC;IAGK,aAAa,QAAsB;AACzC,UAAI,CAAC,KAAK,uBAAuB,OAAO,cAAc,MAAM,GAAG;AAC7D,YAAI,UAAU,GAAG;AACf,cAAI,SAAS,KAAM;AAEjB,iBAAK,QAAQ,MAAM;UACrB,WAAW,SAAS,KAAO;AAEzB,iBAAK,QAAQ,GAAI;AACjB,iBAAK,QAAQ,MAAM;UACrB,WAAW,SAAS,OAAS;AAE3B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,WAAW,SAAS,YAAa;AAE/B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,WAAW,CAAC,KAAK,aAAa;AAE5B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,OAAO;AACL,iBAAK,oBAAoB,MAAM;UACjC;QACF,OAAO;AACL,cAAI,UAAU,KAAO;AAEnB,iBAAK,QAAQ,MAAQ,SAAS,EAAK;UACrC,WAAW,UAAU,MAAO;AAE1B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,QAAQ,MAAM;UACrB,WAAW,UAAU,QAAS;AAE5B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,WAAW,UAAU,aAAa;AAEhC,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,WAAW,CAAC,KAAK,aAAa;AAE5B,iBAAK,QAAQ,GAAI;AACjB,iBAAK,SAAS,MAAM;UACtB,OAAO;AACL,iBAAK,oBAAoB,MAAM;UACjC;QACF;MACF,OAAO;AACL,aAAK,oBAAoB,MAAM;MACjC;IAAC;IAGK,oBAAoB,QAAsB;AAChD,UAAI,KAAK,cAAc;AAErB,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,MAAM;MACtB,OAAO;AAEL,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,MAAM;MACtB;IAAC;IAGK,eAAe,QAAsB;AAC3C,UAAI,UAAU,OAAO,CAAC,GAAG;AAEvB,aAAK,QAAQ,GAAI;AACjB,aAAK,eAAe,MAAM;MAC5B,OAAO;AAEL,aAAK,QAAQ,GAAI;AACjB,aAAK,cAAc,MAAM;MAC3B;IAAC;IAGK,kBAAkB,YAAoB;AAC5C,UAAI,aAAa,IAAI;AAEnB,aAAK,QAAQ,MAAO,UAAU;MAChC,WAAW,aAAa,KAAO;AAE7B,aAAK,QAAQ,GAAI;AACjB,aAAK,QAAQ,UAAU;MACzB,WAAW,aAAa,OAAS;AAE/B,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,UAAU;MAC1B,WAAW,aAAa,YAAa;AAEnC,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,UAAU;MAC1B,OAAO;AACL,cAAM,IAAI,MAAM,oBAAoB,UAAU,iBAAiB;MACjE;IAAC;IAGK,aAAa,QAAgB;AACnC,YAAM,gBAAgB,IAAI;AAE1B,YAAM,aAAa,UAAU,MAAM;AACnC,WAAK,wBAAwB,gBAAgB,UAAU;AACvD,WAAK,kBAAkB,UAAU;AACjC,iBAAW,QAAQ,KAAK,OAAO,KAAK,GAAG;AACvC,WAAK,OAAO;IAAW;IAGjB,aAAa,QAAiB,OAAe;AAEnD,YAAM,MAAM,KAAK,eAAe,YAAY,QAAQ,KAAK,OAAO;AAChE,UAAI,OAAO,MAAM;AACf,aAAK,gBAAgB,GAAG;MAC1B,WAAW,MAAM,QAAQ,MAAM,GAAG;AAChC,aAAK,YAAY,QAAQ,KAAK;MAChC,WAAW,YAAY,OAAO,MAAM,GAAG;AACrC,aAAK,aAAa,MAAM;MAC1B,WAAW,OAAO,WAAW,UAAU;AACrC,aAAK,UAAU,QAAmC,KAAK;MACzD,OAAO;AAEL,cAAM,IAAI,MAAM,wBAAwB,OAAO,UAAU,SAAS,MAAM,MAAM,CAAC,EAAE;MACnF;IAAC;IAGK,aAAa,QAAyB;AAC5C,YAAM,OAAO,OAAO;AACpB,UAAI,OAAO,KAAO;AAEhB,aAAK,QAAQ,GAAI;AACjB,aAAK,QAAQ,IAAI;MACnB,WAAW,OAAO,OAAS;AAEzB,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,WAAW,OAAO,YAAa;AAE7B,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,OAAO;AACL,cAAM,IAAI,MAAM,qBAAqB,IAAI,EAAE;MAC7C;AACA,YAAM,QAAQ,iBAAiB,MAAM;AACrC,WAAK,SAAS,KAAK;IAAE;IAGf,YAAY,QAAwB,OAAe;AACzD,YAAM,OAAO,OAAO;AACpB,UAAI,OAAO,IAAI;AAEb,aAAK,QAAQ,MAAO,IAAI;MAC1B,WAAW,OAAO,OAAS;AAEzB,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,WAAW,OAAO,YAAa;AAE7B,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,OAAO;AACL,cAAM,IAAI,MAAM,oBAAoB,IAAI,EAAE;MAC5C;AACA,iBAAW,QAAQ,QAAQ;AACzB,aAAK,SAAS,MAAM,QAAQ,CAAC;MAC/B;IAAC;IAGK,sBAAsB,QAAiC,MAAqC;AAClG,UAAI,QAAQ;AAEZ,iBAAW,OAAO,MAAM;AACtB,YAAI,OAAO,GAAG,MAAM,QAAW;AAC7B;QACF;MACF;AAEA,aAAO;IAAM;IAGP,UAAU,QAAiC,OAAe;AAChE,YAAM,OAAO,OAAO,KAAK,MAAM;AAC/B,UAAI,KAAK,UAAU;AACjB,aAAK,KAAI;MACX;AAEA,YAAM,OAAO,KAAK,kBAAkB,KAAK,sBAAsB,QAAQ,IAAI,IAAI,KAAK;AAEpF,UAAI,OAAO,IAAI;AAEb,aAAK,QAAQ,MAAO,IAAI;MAC1B,WAAW,OAAO,OAAS;AAEzB,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,WAAW,OAAO,YAAa;AAE7B,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,OAAO;AACL,cAAM,IAAI,MAAM,yBAAyB,IAAI,EAAE;MACjD;AAEA,iBAAW,OAAO,MAAM;AACtB,cAAM,QAAQ,OAAO,GAAG;AAExB,YAAI,EAAE,KAAK,mBAAmB,UAAU,SAAY;AAClD,eAAK,aAAa,GAAG;AACrB,eAAK,SAAS,OAAO,QAAQ,CAAC;QAChC;MACF;IAAC;IAGK,gBAAgB,KAAc;AACpC,UAAI,OAAO,IAAI,SAAS,YAAY;AAClC,cAAM,OAAO,IAAI,KAAK,KAAK,MAAM,CAAC;AAClC,cAAMC,QAAO,KAAK;AAElB,YAAIA,SAAQ,YAAa;AACvB,gBAAM,IAAI,MAAM,+BAA+BA,KAAI,EAAE;QACvD;AAEA,aAAK,QAAQ,GAAI;AACjB,aAAK,SAASA,KAAI;AAClB,aAAK,QAAQ,IAAI,IAAI;AACrB,aAAK,SAAS,IAAI;AAClB;MACF;AAEA,YAAM,OAAO,IAAI,KAAK;AACtB,UAAI,SAAS,GAAG;AAEd,aAAK,QAAQ,GAAI;MACnB,WAAW,SAAS,GAAG;AAErB,aAAK,QAAQ,GAAI;MACnB,WAAW,SAAS,GAAG;AAErB,aAAK,QAAQ,GAAI;MACnB,WAAW,SAAS,GAAG;AAErB,aAAK,QAAQ,GAAI;MACnB,WAAW,SAAS,IAAI;AAEtB,aAAK,QAAQ,GAAI;MACnB,WAAW,OAAO,KAAO;AAEvB,aAAK,QAAQ,GAAI;AACjB,aAAK,QAAQ,IAAI;MACnB,WAAW,OAAO,OAAS;AAEzB,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,WAAW,OAAO,YAAa;AAE7B,aAAK,QAAQ,GAAI;AACjB,aAAK,SAAS,IAAI;MACpB,OAAO;AACL,cAAM,IAAI,MAAM,+BAA+B,IAAI,EAAE;MACvD;AACA,WAAK,QAAQ,IAAI,IAAI;AACrB,WAAK,SAAS,IAAI,IAAI;IAAE;IAGlB,QAAQ,OAAe;AAC7B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,SAAS,KAAK,KAAK,KAAK;AAClC,WAAK;IAAM;IAGL,SAAS,QAA2B;AAC1C,YAAM,OAAO,OAAO;AACpB,WAAK,wBAAwB,IAAI;AAEjC,WAAK,MAAM,IAAI,QAAQ,KAAK,GAAG;AAC/B,WAAK,OAAO;IAAK;IAGX,QAAQ,OAAe;AAC7B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,QAAQ,KAAK,KAAK,KAAK;AACjC,WAAK;IAAM;IAGL,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,UAAU,KAAK,KAAK,KAAK;AACnC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,SAAS,KAAK,KAAK,KAAK;AAClC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,UAAU,KAAK,KAAK,KAAK;AACnC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,SAAS,KAAK,KAAK,KAAK;AAClC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,WAAW,KAAK,KAAK,KAAK;AACpC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,WAAW,KAAK,KAAK,KAAK;AACpC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,gBAAU,KAAK,MAAM,KAAK,KAAK,KAAK;AACpC,WAAK,OAAO;IAAE;IAGR,SAAS,OAAe;AAC9B,WAAK,wBAAwB,CAAC;AAE9B,eAAS,KAAK,MAAM,KAAK,KAAK,KAAK;AACnC,WAAK,OAAO;IAAE;IAGR,eAAe,OAAe;AACpC,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,aAAa,KAAK,KAAK,KAAK;AACtC,WAAK,OAAO;IAAE;IAGR,cAAc,OAAe;AACnC,WAAK,wBAAwB,CAAC;AAE9B,WAAK,KAAK,YAAY,KAAK,KAAK,KAAK;AACrC,WAAK,OAAO;IAAE;;;;ACzjBZ,WAAU,OACd,OACA,SACyB;AACzB,UAAM,UAAU,IAAI,QAAQ,OAAO;AACnC,WAAO,QAAQ,gBAAgB,KAAK;EAAE;;;ACflC,WAAU,WAAW,MAAsB;AAC/C,WAAO,GAAG,OAAO,IAAI,MAAM,EAAE,KAAK,KAAK,IAAI,IAAI,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC;EAAG;;;ACCnF,MAAM,yBAAyB;AAC/B,MAAM,6BAA6B;AAW7B,MAAO,mBAAP,MAAuB;IAO3B,YAAY,eAAe,wBAAwB,kBAAkB,4BAA4B;AANjG,iCAAM;AACN,kCAAO;AACU;AACR;AACA;AAGP,WAAK,eAAe;AACpB,WAAK,kBAAkB;AAIvB,WAAK,SAAS,CAAA;AACd,eAAS,IAAI,GAAG,IAAI,KAAK,cAAc,KAAK;AAC1C,aAAK,OAAO,KAAK,CAAA,CAAE;MACrB;IAAC;IAGI,YAAY,YAA6B;AAC9C,aAAO,aAAa,KAAK,cAAc,KAAK;IAAa;IAGnD,KAAK,OAAmB,aAAqB,YAAmC;AACtF,YAAM,UAAU,KAAK,OAAO,aAAa,CAAC;AAE1C;AAAY,mBAAW,UAAU,SAAS;AACxC,gBAAM,cAAc,OAAO;AAE3B,mBAAS,IAAI,GAAG,IAAI,YAAY,KAAK;AACnC,gBAAI,YAAY,CAAC,MAAM,MAAM,cAAc,CAAC,GAAG;AAC7C,uBAAS;YACX;UACF;AACA,iBAAO,OAAO;QAChB;AACA,aAAO;IAAK;IAGN,MAAM,OAAmB,OAAe;AAC9C,YAAM,UAAU,KAAK,OAAO,MAAM,SAAS,CAAC;AAC5C,YAAM,SAAyB,EAAE,OAAO,KAAK,MAAK;AAElD,UAAI,QAAQ,UAAU,KAAK,iBAAiB;AAG1C,gBAAS,KAAK,OAAM,IAAK,QAAQ,SAAU,CAAC,IAAI;MAClD,OAAO;AACL,gBAAQ,KAAK,MAAM;MACrB;IAAC;IAGI,OAAO,OAAmB,aAAqB,YAA4B;AAChF,YAAM,cAAc,KAAK,KAAK,OAAO,aAAa,UAAU;AAC5D,UAAI,eAAe,MAAM;AACvB,aAAK;AACL,eAAO;MACT;AACA,WAAK;AAEL,YAAM,MAAM,aAAa,OAAO,aAAa,UAAU;AAEvD,YAAM,oBAAoB,WAAW,UAAU,MAAM,KAAK,OAAO,aAAa,cAAc,UAAU;AACtG,WAAK,MAAM,mBAAmB,GAAG;AACjC,aAAO;IAAI;;;;ACIf,MAAM,cAAc;AACpB,MAAM,gBAAgB;AACtB,MAAM,kBAAkB;AAIxB,MAAM,kBAAkB,CAAC,QAA6B;AACpD,QAAI,OAAO,QAAQ,YAAY,OAAO,QAAQ,UAAU;AACtD,aAAO;IACT;AACA,UAAM,IAAI,YAAY,kDAAkD,OAAO,GAAG;EAAE;AAkBtF,MAAM,YAAN,MAAe;IAAf;AACmB,mCAA2B,CAAA;AACpC,+CAAoB;;IAE5B,IAAW,SAAiB;AAC1B,aAAO,KAAK,oBAAoB;IAAE;IAG7B,MAA8B;AACnC,aAAO,KAAK,MAAM,KAAK,iBAAiB;IAAE;IAGrC,eAAe,MAAc;AAClC,YAAM,QAAQ,KAAK,8BAA6B;AAEhD,YAAM,OAAO;AACb,YAAM,WAAW;AACjB,YAAM,OAAO;AACb,YAAM,QAAQ,IAAI,MAAM,IAAI;IAAE;IAGzB,aAAa,MAAc;AAChC,YAAM,QAAQ,KAAK,8BAA6B;AAEhD,YAAM,OAAO;AACb,YAAM,YAAY;AAClB,YAAM,OAAO;AACb,YAAM,MAAM,CAAA;IAAG;IAGT,gCAAgC;AACtC,WAAK;AAEL,UAAI,KAAK,sBAAsB,KAAK,MAAM,QAAQ;AAChD,cAAM,eAAoC;UACxC,MAAM;UACN,MAAM;UACN,OAAO;UACP,UAAU;UACV,WAAW;UACX,KAAK;UACL,KAAK;;AAGP,aAAK,MAAM,KAAK,YAA0B;MAC5C;AAEA,aAAO,KAAK,MAAM,KAAK,iBAAiB;IAAE;IAGrC,QAAQ,OAAyB;AACtC,YAAM,gBAAgB,KAAK,MAAM,KAAK,iBAAiB;AAEvD,UAAI,kBAAkB,OAAO;AAC3B,cAAM,IAAI,MAAM,iEAAiE;MACnF;AAEA,UAAI,MAAM,SAAS,aAAa;AAC9B,cAAM,eAAe;AACrB,qBAAa,OAAO;AACpB,qBAAa,QAAQ;AACrB,qBAAa,WAAW;AACxB,qBAAa,OAAO;MACtB;AAEA,UAAI,MAAM,SAAS,iBAAiB,MAAM,SAAS,iBAAiB;AAClE,cAAM,eAAe;AACrB,qBAAa,OAAO;AACpB,qBAAa,MAAM;AACnB,qBAAa,YAAY;AACzB,qBAAa,OAAO;MACtB;AAEA,WAAK;IAAoB;IAGpB,QAAc;AACnB,WAAK,MAAM,SAAS;AACpB,WAAK,oBAAoB;IAAG;;AAMhC,MAAM,qBAAqB;AAE3B,MAAM,aAAa,IAAI,SAA0B,IAAI,YAAY,CAAC,CAAC;AACnE,MAAM,cAAc,IAAI,WAA4B,WAAW,MAAM;AAErE,MAAI;AAGF,eAAW,QAAQ,CAAC;EACtB,SAAS,GAAG;AACV,QAAI,EAAE,aAAa,aAAa;AAC9B,YAAM,IAAI,MACR,kIAAkI;IAEtI;EACF;AAEA,MAAM,YAAY,IAAI,WAAW,mBAAmB;AAEpD,MAAM,yBAAyB,IAAI,iBAAgB;AAE7C,MAAO,UAAP,MAAO,SAAO;IAuBlB,YAAmB,SAAuC;AAtBzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAET,sCAAW;AACX,iCAAM;AAEN,kCAAO;AACP,mCAAQ;AACR,sCAAW;AACF,mCAAQ,IAAI,UAAS;AAE9B,qCAAU;AAGhB,WAAK,iBAAiB,SAAS,kBAAmB,eAAe;AACjE,WAAK,UAAW,SAAkD;AAElE,WAAK,cAAc,SAAS,eAAe;AAC3C,WAAK,aAAa,SAAS,cAAc;AACzC,WAAK,eAAe,SAAS,gBAAgB;AAC7C,WAAK,eAAe,SAAS,gBAAgB;AAC7C,WAAK,iBAAiB,SAAS,kBAAkB;AACjD,WAAK,eAAe,SAAS,gBAAgB;AAC7C,WAAK,eAAe,SAAS,gBAAgB;AAC7C,WAAK,aAAa,SAAS,eAAe,SAAY,QAAQ,aAAa;AAC3E,WAAK,kBAAkB,SAAS,mBAAmB;IAAgB;IAG7D,QAA8B;AAEpC,aAAO,IAAI,SAAQ;QACjB,gBAAgB,KAAK;QACrB,SAAS,KAAK;QACd,aAAa,KAAK;QAClB,YAAY,KAAK;QACjB,cAAc,KAAK;QACnB,cAAc,KAAK;QACnB,gBAAgB,KAAK;QACrB,cAAc,KAAK;QACnB,cAAc,KAAK;QACnB,YAAY,KAAK;OACX;IAAE;IAGJ,oBAAoB;AAC1B,WAAK,WAAW;AAChB,WAAK,WAAW;AAChB,WAAK,MAAM,MAAK;IAAG;IAKb,UAAU,QAAqE;AACrF,YAAM,QAAQ,iBAAiB,MAAM;AACrC,WAAK,QAAQ;AACb,WAAK,OAAO,IAAI,SAAS,MAAM,QAAQ,MAAM,YAAY,MAAM,UAAU;AACzE,WAAK,MAAM;IAAE;IAGP,aAAa,QAAqE;AACxF,UAAI,KAAK,aAAa,sBAAsB,CAAC,KAAK,aAAa,CAAC,GAAG;AACjE,aAAK,UAAU,MAAM;MACvB,OAAO;AACL,cAAM,gBAAgB,KAAK,MAAM,SAAS,KAAK,GAAG;AAClD,cAAM,UAAU,iBAAiB,MAAM;AAGvC,cAAM,YAAY,IAAI,WAAW,cAAc,SAAS,QAAQ,MAAM;AACtE,kBAAU,IAAI,aAAa;AAC3B,kBAAU,IAAI,SAAS,cAAc,MAAM;AAC3C,aAAK,UAAU,SAAS;MAC1B;IAAC;IAGK,aAAa,MAAc;AACjC,aAAO,KAAK,KAAK,aAAa,KAAK,OAAO;IAAK;IAGzC,qBAAqB,WAA0B;AACrD,YAAM,EAAE,MAAM,IAAG,IAAK;AACtB,aAAO,IAAI,WAAW,SAAS,KAAK,aAAa,GAAG,OAAO,KAAK,UAAU,4BAA4B,SAAS,GAAG;IAAE;;;;;IAO/G,OAAO,QAAwE;AACpF,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,OAAO,MAAM;MAC/B;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,aAAK,kBAAiB;AACtB,aAAK,UAAU,MAAM;AAErB,cAAM,SAAS,KAAK,aAAY;AAChC,YAAI,KAAK,aAAa,CAAC,GAAG;AACxB,gBAAM,KAAK,qBAAqB,KAAK,GAAG;QAC1C;AACA,eAAO;MACT;AACE,aAAK,UAAU;MACjB;IAAC;IAGI,CAAC,YAAY,QAAkG;AACpH,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,YAAY,MAAM;AAClC;MACF;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,aAAK,kBAAiB;AACtB,aAAK,UAAU,MAAM;AAErB,eAAO,KAAK,aAAa,CAAC,GAAG;AAC3B,gBAAM,KAAK,aAAY;QACzB;MACF;AACE,aAAK,UAAU;MACjB;IAAC;IAGI,MAAM,YAAY,QAAgG;AACvH,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,YAAY,MAAM;MACpC;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,YAAI,UAAU;AACd,YAAI;AACJ,yBAAiB,UAAU,QAAQ;AACjC,cAAI,SAAS;AACX,iBAAK,UAAU;AACf,kBAAM,KAAK,qBAAqB,KAAK,QAAQ;UAC/C;AAEA,eAAK,aAAa,MAAM;AAExB,cAAI;AACF,qBAAS,KAAK,aAAY;AAC1B,sBAAU;UACZ,SAAS,GAAG;AACV,gBAAI,EAAE,aAAa,aAAa;AAC9B,oBAAM;YACR;UAEF;AACA,eAAK,YAAY,KAAK;QACxB;AAEA,YAAI,SAAS;AACX,cAAI,KAAK,aAAa,CAAC,GAAG;AACxB,kBAAM,KAAK,qBAAqB,KAAK,QAAQ;UAC/C;AACA,iBAAO;QACT;AAEA,cAAM,EAAE,UAAU,KAAK,SAAQ,IAAK;AACpC,cAAM,IAAI,WACR,gCAAgC,WAAW,QAAQ,CAAC,OAAO,QAAQ,KAAK,GAAG,yBAAyB;MAExG;AACE,aAAK,UAAU;MACjB;IAAC;IAGI,kBACL,QACwC;AACxC,aAAO,KAAK,iBAAiB,QAAQ,IAAI;IAAE;IAGtC,aAAa,QAAsH;AACxI,aAAO,KAAK,iBAAiB,QAAQ,KAAK;IAAE;IAGtC,OAAO,iBAAiB,QAA8E,SAA0D;AACtK,UAAI,KAAK,SAAS;AAChB,cAAM,WAAW,KAAK,MAAK;AAC3B,eAAO,SAAS,iBAAiB,QAAQ,OAAO;AAChD;MACF;AAEA,UAAI;AACF,aAAK,UAAU;AAEf,YAAI,wBAAwB;AAC5B,YAAI,iBAAiB;AAErB,yBAAiB,UAAU,QAAQ;AACjC,cAAI,WAAW,mBAAmB,GAAG;AACnC,kBAAM,KAAK,qBAAqB,KAAK,QAAQ;UAC/C;AAEA,eAAK,aAAa,MAAM;AAExB,cAAI,uBAAuB;AACzB,6BAAiB,KAAK,cAAa;AACnC,oCAAwB;AACxB,iBAAK,SAAQ;UACf;AAEA,cAAI;AACF,mBAAO,MAAM;AACX,oBAAM,KAAK,aAAY;AACvB,kBAAI,EAAE,mBAAmB,GAAG;AAC1B;cACF;YACF;UACF,SAAS,GAAG;AACV,gBAAI,EAAE,aAAa,aAAa;AAC9B,oBAAM;YACR;UAEF;AACA,eAAK,YAAY,KAAK;QACxB;MACF;AACE,aAAK,UAAU;MACjB;IAAC;IAGK,eAAwB;AAC9B;AAAQ,eAAO,MAAM;AACnB,gBAAM,WAAW,KAAK,aAAY;AAClC,cAAI;AAEJ,cAAI,YAAY,KAAM;AAEpB,qBAAS,WAAW;UACtB,WAAW,WAAW,KAAM;AAC1B,gBAAI,WAAW,KAAM;AAEnB,uBAAS;YACX,WAAW,WAAW,KAAM;AAE1B,oBAAM,OAAO,WAAW;AACxB,kBAAI,SAAS,GAAG;AACd,qBAAK,aAAa,IAAI;AACtB,qBAAK,SAAQ;AACb,yBAAS;cACX,OAAO;AACL,yBAAS,CAAA;cACX;YACF,WAAW,WAAW,KAAM;AAE1B,oBAAM,OAAO,WAAW;AACxB,kBAAI,SAAS,GAAG;AACd,qBAAK,eAAe,IAAI;AACxB,qBAAK,SAAQ;AACb,yBAAS;cACX,OAAO;AACL,yBAAS,CAAA;cACX;YACF,OAAO;AAEL,oBAAM,aAAa,WAAW;AAC9B,uBAAS,KAAK,aAAa,YAAY,CAAC;YAC1C;UACF,WAAW,aAAa,KAAM;AAE5B,qBAAS;UACX,WAAW,aAAa,KAAM;AAE5B,qBAAS;UACX,WAAW,aAAa,KAAM;AAE5B,qBAAS;UACX,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,OAAM;UACtB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,gBAAI,KAAK,aAAa;AACpB,uBAAS,KAAK,gBAAe;YAC/B,OAAO;AACL,uBAAS,KAAK,QAAO;YACvB;UACF,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,OAAM;UACtB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,QAAO;UACvB,WAAW,aAAa,KAAM;AAE5B,gBAAI,KAAK,aAAa;AACpB,uBAAS,KAAK,gBAAe;YAC/B,OAAO;AACL,uBAAS,KAAK,QAAO;YACvB;UACF,WAAW,aAAa,KAAM;AAE5B,kBAAM,aAAa,KAAK,OAAM;AAC9B,qBAAS,KAAK,aAAa,YAAY,CAAC;UAC1C,WAAW,aAAa,KAAM;AAE5B,kBAAM,aAAa,KAAK,QAAO;AAC/B,qBAAS,KAAK,aAAa,YAAY,CAAC;UAC1C,WAAW,aAAa,KAAM;AAE5B,kBAAM,aAAa,KAAK,QAAO;AAC/B,qBAAS,KAAK,aAAa,YAAY,CAAC;UAC1C,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,gBAAI,SAAS,GAAG;AACd,mBAAK,eAAe,IAAI;AACxB,mBAAK,SAAQ;AACb,uBAAS;YACX,OAAO;AACL,uBAAS,CAAA;YACX;UACF,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,gBAAI,SAAS,GAAG;AACd,mBAAK,eAAe,IAAI;AACxB,mBAAK,SAAQ;AACb,uBAAS;YACX,OAAO;AACL,uBAAS,CAAA;YACX;UACF,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,gBAAI,SAAS,GAAG;AACd,mBAAK,aAAa,IAAI;AACtB,mBAAK,SAAQ;AACb,uBAAS;YACX,OAAO;AACL,uBAAS,CAAA;YACX;UACF,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,gBAAI,SAAS,GAAG;AACd,mBAAK,aAAa,IAAI;AACtB,mBAAK,SAAQ;AACb,uBAAS;YACX,OAAO;AACL,uBAAS,CAAA;YACX;UACF,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,OAAM;AACxB,qBAAS,KAAK,aAAa,MAAM,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,qBAAS,KAAK,aAAa,MAAM,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,qBAAS,KAAK,aAAa,MAAM,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,gBAAgB,GAAG,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,gBAAgB,GAAG,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,gBAAgB,GAAG,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,gBAAgB,GAAG,CAAC;UACpC,WAAW,aAAa,KAAM;AAE5B,qBAAS,KAAK,gBAAgB,IAAI,CAAC;UACrC,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,OAAM;AACxB,qBAAS,KAAK,gBAAgB,MAAM,CAAC;UACvC,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,qBAAS,KAAK,gBAAgB,MAAM,CAAC;UACvC,WAAW,aAAa,KAAM;AAE5B,kBAAM,OAAO,KAAK,QAAO;AACzB,qBAAS,KAAK,gBAAgB,MAAM,CAAC;UACvC,OAAO;AACL,kBAAM,IAAI,YAAY,2BAA2B,WAAW,QAAQ,CAAC,EAAE;UACzE;AAEA,eAAK,SAAQ;AAEb,gBAAM,QAAQ,KAAK;AACnB,iBAAO,MAAM,SAAS,GAAG;AAEvB,kBAAM,QAAQ,MAAM,IAAG;AACvB,gBAAI,MAAM,SAAS,aAAa;AAC9B,oBAAM,MAAM,MAAM,QAAQ,IAAI;AAC9B,oBAAM;AACN,kBAAI,MAAM,aAAa,MAAM,MAAM;AACjC,yBAAS,MAAM;AACf,sBAAM,QAAQ,KAAK;cACrB,OAAO;AACL,yBAAS;cACX;YACF,WAAW,MAAM,SAAS,eAAe;AACvC,kBAAI,WAAW,aAAa;AAC1B,sBAAM,IAAI,YAAY,kCAAkC;cAC1D;AAEA,oBAAM,MAAM,KAAK,gBAAgB,MAAM;AACvC,oBAAM,OAAO;AACb,uBAAS;YACX,OAAO;AAGL,oBAAM,IAAI,MAAM,GAAI,IAAI;AACxB,oBAAM;AAEN,kBAAI,MAAM,cAAc,MAAM,MAAM;AAClC,yBAAS,MAAM;AACf,sBAAM,QAAQ,KAAK;cACrB,OAAO;AACL,sBAAM,MAAM;AACZ,sBAAM,OAAO;AACb,yBAAS;cACX;YACF;UACF;AAEA,iBAAO;QACT;IAAC;IAGK,eAAuB;AAC7B,UAAI,KAAK,aAAa,oBAAoB;AACxC,aAAK,WAAW,KAAK,OAAM;MAE7B;AAEA,aAAO,KAAK;IAAS;IAGf,WAAiB;AACvB,WAAK,WAAW;IAAmB;IAG7B,gBAAwB;AAC9B,YAAM,WAAW,KAAK,aAAY;AAElC,cAAQ,UAAU;QAChB,KAAK;AACH,iBAAO,KAAK,QAAO;QACrB,KAAK;AACH,iBAAO,KAAK,QAAO;QACrB,SAAS;AACP,cAAI,WAAW,KAAM;AACnB,mBAAO,WAAW;UACpB,OAAO;AACL,kBAAM,IAAI,YAAY,iCAAiC,WAAW,QAAQ,CAAC,EAAE;UAC/E;QACF;MACF;IAAC;IAGK,aAAa,MAAc;AACjC,UAAI,OAAO,KAAK,cAAc;AAC5B,cAAM,IAAI,YAAY,oCAAoC,IAAI,2BAA2B,KAAK,YAAY,GAAG;MAC/G;AAEA,WAAK,MAAM,aAAa,IAAI;IAAE;IAGxB,eAAe,MAAc;AACnC,UAAI,OAAO,KAAK,gBAAgB;AAC9B,cAAM,IAAI,YAAY,sCAAsC,IAAI,uBAAuB,KAAK,cAAc,GAAG;MAC/G;AAEA,WAAK,MAAM,eAAe,IAAI;IAAE;IAG1B,aAAa,YAAoB,cAA2C;AAClF,UAAI,CAAC,KAAK,cAAc,KAAK,cAAa,GAAI;AAC5C,eAAO,KAAK,iBAAiB,YAAY,YAAY;MACvD;AACA,aAAO,KAAK,aAAa,YAAY,YAAY;IAAE;;;;IAM7C,iBAAiB,YAAoB,cAA8B;AACzE,UAAI,aAAa,KAAK,cAAc;AAClC,cAAM,IAAI,YACR,2CAA2C,UAAU,qBAAqB,KAAK,YAAY,GAAG;MAElG;AAEA,UAAI,KAAK,MAAM,aAAa,KAAK,MAAM,eAAe,YAAY;AAChE,cAAM;MACR;AAEA,YAAM,SAAS,KAAK,MAAM;AAC1B,UAAI;AACJ,UAAI,KAAK,cAAa,KAAM,KAAK,YAAY,YAAY,UAAU,GAAG;AACpE,iBAAS,KAAK,WAAW,OAAO,KAAK,OAAO,QAAQ,UAAU;MAChE,OAAO;AACL,iBAAS,WAAW,KAAK,OAAO,QAAQ,UAAU;MACpD;AACA,WAAK,OAAO,eAAe;AAC3B,aAAO;IAAO;IAGR,gBAAyB;AAC/B,UAAI,KAAK,MAAM,SAAS,GAAG;AACzB,cAAM,QAAQ,KAAK,MAAM,IAAG;AAC5B,eAAO,MAAM,SAAS;MACxB;AACA,aAAO;IAAM;;;;IAMP,aAAa,YAAoB,YAAgC;AACvE,UAAI,aAAa,KAAK,cAAc;AAClC,cAAM,IAAI,YAAY,oCAAoC,UAAU,qBAAqB,KAAK,YAAY,GAAG;MAC/G;AAEA,UAAI,CAAC,KAAK,aAAa,aAAa,UAAU,GAAG;AAC/C,cAAM;MACR;AAEA,YAAM,SAAS,KAAK,MAAM;AAC1B,YAAM,SAAS,KAAK,MAAM,SAAS,QAAQ,SAAS,UAAU;AAC9D,WAAK,OAAO,aAAa;AACzB,aAAO;IAAO;IAGR,gBAAgB,MAAc,YAA6B;AACjE,UAAI,OAAO,KAAK,cAAc;AAC5B,cAAM,IAAI,YAAY,oCAAoC,IAAI,qBAAqB,KAAK,YAAY,GAAG;MACzG;AAEA,YAAM,UAAU,KAAK,KAAK,QAAQ,KAAK,MAAM,UAAU;AACvD,YAAM,OAAO,KAAK;QAAa;QAAM,aAAa;;MAAe;AACjE,aAAO,KAAK,eAAe,OAAO,MAAM,SAAS,KAAK,OAAO;IAAE;IAGzD,SAAS;AACf,aAAO,KAAK,KAAK,SAAS,KAAK,GAAG;IAAE;IAG9B,UAAU;AAChB,aAAO,KAAK,KAAK,UAAU,KAAK,GAAG;IAAE;IAG/B,UAAU;AAChB,aAAO,KAAK,KAAK,UAAU,KAAK,GAAG;IAAE;IAG/B,SAAiB;AACvB,YAAM,QAAQ,KAAK,KAAK,SAAS,KAAK,GAAG;AACzC,WAAK;AACL,aAAO;IAAM;IAGP,SAAiB;AACvB,YAAM,QAAQ,KAAK,KAAK,QAAQ,KAAK,GAAG;AACxC,WAAK;AACL,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,KAAK,KAAK,UAAU,KAAK,GAAG;AAC1C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,KAAK,KAAK,SAAS,KAAK,GAAG;AACzC,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,KAAK,KAAK,UAAU,KAAK,GAAG;AAC1C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,KAAK,KAAK,SAAS,KAAK,GAAG;AACzC,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,UAAU,KAAK,MAAM,KAAK,GAAG;AAC3C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAkB;AACxB,YAAM,QAAQ,SAAS,KAAK,MAAM,KAAK,GAAG;AAC1C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,kBAA0B;AAChC,YAAM,QAAQ,KAAK,KAAK,aAAa,KAAK,GAAG;AAC7C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,kBAA0B;AAChC,YAAM,QAAQ,KAAK,KAAK,YAAY,KAAK,GAAG;AAC5C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAU;AAChB,YAAM,QAAQ,KAAK,KAAK,WAAW,KAAK,GAAG;AAC3C,WAAK,OAAO;AACZ,aAAO;IAAM;IAGP,UAAU;AAChB,YAAM,QAAQ,KAAK,KAAK,WAAW,KAAK,GAAG;AAC3C,WAAK,OAAO;AACZ,aAAO;IAAM;;;;ACh2BX,WAAU,OACd,QACA,SACS;AACT,UAAM,UAAU,IAAI,QAAQ,OAAO;AACnC,WAAO,QAAQ,OAAO,MAAM;EAAE;;;ACZzB,MAAM,qBAAN,cAAiC,cAAc;AAAA,IASlD,YAAY,KAAc;AACtB,YAAM;AATV,WAAS,OAAO;AAEhB,WAAQ,SAA2B;AACnC,WAAQ,oBAAoB;AAC5B,WAAQ,oBAAoB;AAC5B,WAAQ,kBAAkB;AAKtB,WAAK,MAAM,OAAO,KAAK,cAAc;AAAA,IACzC;AAAA,IAEQ,gBAAwB;AAC5B,YAAM,WAAW,OAAO,SAAS,aAAa,WAAW,SAAS;AAClE,aAAO,GAAG,QAAQ,KAAK,OAAO,SAAS,IAAI;AAAA,IAC/C;AAAA,IAEA,UAAyB;AACrB,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,YAAI;AACA,eAAK,SAAS,IAAI,UAAU,KAAK,GAAG;AACpC,eAAK,OAAO,aAAa;AAEzB,eAAK,OAAO,SAAS,MAAM;AACvB,oBAAQ,IAAI,6BAA6B;AACzC,iBAAK,aAAa,IAAI;AACtB,iBAAK,oBAAoB;AACzB,oBAAQ;AAAA,UACZ;AAEA,eAAK,OAAO,YAAY,CAAC,UAAwB;AAC7C,gBAAI;AACA,oBAAM,MAAM,OAAO,MAAM,IAAI;AAC7B,mBAAK,eAAe,GAAG;AAAA,YAC3B,SAAS,GAAG;AACR,sBAAQ,MAAM,2CAA2C,CAAC;AAAA,YAC9D;AAAA,UACJ;AAEA,eAAK,OAAO,UAAU,MAAM;AACxB,oBAAQ,IAAI,gCAAgC;AAC5C,iBAAK,aAAa,KAAK;AACvB,gBAAI,KAAK,iBAAiB;AACtB,mBAAK,kBAAkB;AAAA,YAC3B;AAAA,UACJ;AAEA,eAAK,OAAO,UAAU,CAAC,UAAU;AAC7B,oBAAQ,MAAM,2BAA2B,KAAK;AAC9C,gBAAI,CAAC,KAAK,WAAW;AACjB,qBAAO,IAAI,MAAM,6BAA6B,CAAC;AAAA,YACnD;AAAA,UACJ;AAAA,QACJ,SAAS,GAAG;AACR,iBAAO,CAAC;AAAA,QACZ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,IAEA,KAAK,SAAuB;AACxB,UAAI,KAAK,UAAU,KAAK,OAAO,eAAe,UAAU,MAAM;AAC1D,aAAK,OAAO,KAAK,OAAO,OAAO,CAAC;AAAA,MACpC,OAAO;AACH,gBAAQ,KAAK,iDAAiD;AAAA,MAClE;AAAA,IACJ;AAAA,IAEA,aAAmB;AACf,WAAK,kBAAkB;AACvB,UAAI,KAAK,QAAQ;AACb,aAAK,OAAO,MAAM;AAClB,aAAK,SAAS;AAAA,MAClB;AACA,WAAK,aAAa,KAAK;AAAA,IAC3B;AAAA,IAEQ,oBAA0B;AAC9B,YAAM,QAAQ,KAAK;AAAA,QACf,MAAO,KAAK,IAAI,GAAG,KAAK,iBAAiB;AAAA,QACzC,KAAK;AAAA,MACT;AAEA,cAAQ,IAAI,2BAA2B,KAAK,OAAO;AAEnD,iBAAW,MAAM;AACb,aAAK;AACL,aAAK,QAAQ,EAAE,MAAM,MAAM;AAAA,QAE3B,CAAC;AAAA,MACL,GAAG,KAAK;AAAA,IACZ;AAAA,EACJ;;;AC5FO,MAAM,gBAAN,cAA4B,cAAc;AAAA,IAQ7C,YAAY,SAAkB;AAC1B,YAAM;AARV,WAAS,OAAO;AAEhB,WAAQ,UAAU;AAClB,WAAQ,sBAA8C;AAEtD,WAAQ,YAA2B;AAI/B,WAAK,UAAU,WAAW,GAAG,OAAO,SAAS,MAAM;AAAA,IACvD;AAAA,IAEA,MAAM,UAAyB;AAC3B,UAAI;AAEA,cAAM,WAAW,MAAM,MAAM,GAAG,KAAK,OAAO,YAAY;AAAA,UACpD,QAAQ;AAAA,UACR,SAAS;AAAA,YACL,gBAAgB;AAAA,YAChB,UAAU;AAAA,UACd;AAAA,UACA,MAAM,OAAO,EAAE,MAAM,OAAO,SAAS,WAAW,OAAO,SAAS,OAAO,CAAC;AAAA,QAC5E,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AACd,gBAAM,IAAI,MAAM,6BAA6B,SAAS,MAAM,EAAE;AAAA,QAClE;AAEA,cAAM,SAAS,MAAM,SAAS,YAAY;AAC1C,cAAM,OAAO,OAAO,MAAM;AAC1B,aAAK,YAAY,KAAK;AAEtB,gBAAQ,IAAI,kCAAkC;AAC9C,aAAK,aAAa,IAAI;AAGtB,aAAK,aAAa;AAAA,MAEtB,SAAS,GAAG;AACR,gBAAQ,MAAM,4CAA4C,CAAC;AAC3D,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,IAEA,MAAc,eAA8B;AACxC,UAAI,KAAK;AAAS;AAClB,WAAK,UAAU;AAEf,aAAO,KAAK,WAAW,KAAK,WAAW;AACnC,YAAI;AACA,eAAK,sBAAsB,IAAI,gBAAgB;AAE/C,gBAAM,WAAW,MAAM,MAAM,GAAG,KAAK,OAAO,iBAAiB,KAAK,SAAS,IAAI;AAAA,YAC3E,QAAQ;AAAA,YACR,QAAQ,KAAK,oBAAoB;AAAA,YACjC,SAAS;AAAA,cACL,UAAU;AAAA,YACd;AAAA,UACJ,CAAC;AAED,cAAI,CAAC,SAAS,IAAI;AACd,gBAAI,SAAS,WAAW,KAAK;AAEzB,sBAAQ,KAAK,+CAA+C;AAC5D,mBAAK,aAAa,KAAK;AACvB,oBAAM,KAAK,QAAQ;AACnB;AAAA,YACJ;AACA,kBAAM,IAAI,MAAM,gBAAgB,SAAS,MAAM,EAAE;AAAA,UACrD;AAEA,gBAAM,SAAS,MAAM,SAAS,YAAY;AAC1C,gBAAM,WAAW,OAAO,MAAM;AAE9B,qBAAW,OAAO,UAAU;AACxB,iBAAK,eAAe,GAAG;AAAA,UAC3B;AAAA,QAEJ,SAAS,GAAG;AACR,cAAI,aAAa,SAAS,EAAE,SAAS,cAAc;AAE/C;AAAA,UACJ;AACA,kBAAQ,MAAM,2BAA2B,CAAC;AAE1C,gBAAM,KAAK,MAAM,GAAI;AAAA,QACzB;AAAA,MACJ;AAAA,IACJ;AAAA,IAEA,MAAM,KAAK,SAAgC;AACvC,UAAI,CAAC,KAAK,aAAa,CAAC,KAAK,WAAW;AACpC,gBAAQ,KAAK,2DAA2D;AACxE;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,WAAW,MAAM,MAAM,GAAG,KAAK,OAAO,UAAU;AAAA,UAClD,QAAQ;AAAA,UACR,SAAS;AAAA,YACL,gBAAgB;AAAA,YAChB,UAAU;AAAA,YACV,oBAAoB,KAAK;AAAA,UAC7B;AAAA,UACA,MAAM,OAAO,OAAO;AAAA,QACxB,CAAC;AAED,YAAI,CAAC,SAAS,IAAI;AACd,gBAAM,IAAI,MAAM,sBAAsB,SAAS,MAAM,EAAE;AAAA,QAC3D;AAGA,cAAM,SAAS,MAAM,SAAS,YAAY;AAC1C,cAAM,SAAS,OAAO,MAAM;AAC5B,aAAK,eAAe,MAAM;AAAA,MAE9B,SAAS,GAAG;AACR,gBAAQ,MAAM,2BAA2B,CAAC;AAAA,MAC9C;AAAA,IACJ;AAAA,IAEA,aAAmB;AACf,WAAK,UAAU;AACf,WAAK,aAAa,KAAK;AAEvB,UAAI,KAAK,qBAAqB;AAC1B,aAAK,oBAAoB,MAAM;AAC/B,aAAK,sBAAsB;AAAA,MAC/B;AAEA,WAAK,YAAY;AAAA,IACrB;AAAA,IAEQ,MAAM,IAA2B;AACrC,aAAO,IAAI,QAAQ,aAAW,WAAW,SAAS,EAAE,CAAC;AAAA,IACzD;AAAA,EACJ;;;AC5HA,MAAM,iBAAkC;AAAA,IACpC,oBAAoB;AAAA,IACpB,iBAAiB;AAAA,IACjB,YAAY;AAAA,EAChB;AAMO,MAAM,mBAAN,MAAuB;AAAA,IAM1B,YAAY,SAAmC,CAAC,GAAG;AALnD,WAAQ,YAA8B;AAEtC,WAAQ,kBAAoD,CAAC;AAC7D,WAAQ,iBAAmD,CAAC;AAGxD,WAAK,SAAS,EAAE,GAAG,gBAAgB,GAAG,OAAO;AAAA,IACjD;AAAA;AAAA;AAAA;AAAA,IAKA,MAAM,UAAyB;AAC3B,YAAM,aAAa,KAAK,qBAAqB;AAE7C,iBAAW,kBAAkB,YAAY;AACrC,YAAI;AACA,kBAAQ,IAAI,kBAAkB,eAAe,IAAI,KAAK;AACtD,eAAK,YAAY,IAAI,eAAe;AAGpC,qBAAW,WAAW,KAAK,iBAAiB;AACxC,iBAAK,UAAU,UAAU,OAAO;AAAA,UACpC;AAGA,eAAK,UAAU,eAAe,CAAC,cAAc;AACzC,iBAAK,qBAAqB,SAAS;AAAA,UACvC,CAAC;AAED,gBAAM,KAAK,UAAU,QAAQ;AAC7B,kBAAQ,IAAI,yBAAyB,KAAK,UAAU,IAAI,EAAE;AAC1D;AAAA,QAEJ,SAAS,GAAG;AACR,kBAAQ,KAAK,WAAW,eAAe,IAAI,2BAA2B,CAAC;AACvE,eAAK,YAAY;AAAA,QACrB;AAAA,MACJ;AAEA,YAAM,IAAI,MAAM,+BAA+B;AAAA,IACnD;AAAA;AAAA;AAAA;AAAA,IAKQ,uBAAkE;AACtE,YAAM,aAAwD,CAAC;AAG/D,UAAI,KAAK,OAAO,sBAAsB,sBAAsB,YAAY,GAAG;AAEvE,YAAI,OAAO,SAAS,aAAa,UAAU;AACvC,qBAAW,KAAK,qBAAyE;AAAA,QAC7F;AAAA,MACJ;AAGA,UAAI,KAAK,OAAO,mBAAmB,OAAO,cAAc,aAAa;AACjE,mBAAW,KAAK,kBAAsE;AAAA,MAC1F;AAGA,UAAI,KAAK,OAAO,YAAY;AACxB,mBAAW,KAAK,aAAiE;AAAA,MACrF;AAEA,aAAO;AAAA,IACX;AAAA;AAAA;AAAA;AAAA,IAKA,KAAK,SAAuB;AACxB,UAAI,KAAK,WAAW;AAChB,aAAK,UAAU,KAAK,OAAO;AAAA,MAC/B,OAAO;AACH,gBAAQ,KAAK,6BAA6B;AAAA,MAC9C;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,UAAU,SAA6C;AACnD,WAAK,gBAAgB,KAAK,OAAO;AACjC,UAAI,KAAK,WAAW;AAChB,aAAK,UAAU,UAAU,OAAO;AAAA,MACpC;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,eAAe,SAA6C;AACxD,WAAK,eAAe,KAAK,OAAO;AAAA,IACpC;AAAA,IAEQ,qBAAqB,WAA0B;AACnD,iBAAW,WAAW,KAAK,gBAAgB;AACvC,gBAAQ,SAAS;AAAA,MACrB;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,aAAmB;AACf,UAAI,KAAK,WAAW;AAChB,aAAK,UAAU,WAAW;AAC1B,aAAK,YAAY;AACjB,aAAK,qBAAqB,KAAK;AAAA,MACnC;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,qBAAoC;AAChC,aAAO,KAAK,WAAW,QAAQ;AAAA,IACnC;AAAA;AAAA;AAAA;AAAA,IAKA,cAAuB;AACnB,aAAO,KAAK,WAAW,YAAY,KAAK;AAAA,IAC5C;AAAA,EACJ;;;AC/JA,MAAI,yBAAyB;AAE7B,WAAS,WAAW,UAAU,QAAQ;AAClC,QAAI,cAAc,OAAO;AACzB,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI;AAGJ,QAAI,OAAO,aAAa,0BAA0B,SAAS,aAAa,wBAAwB;AAC9F;AAAA,IACF;AAGA,aAAS,IAAI,YAAY,SAAS,GAAG,KAAK,GAAG,KAAK;AAC9C,aAAO,YAAY,CAAC;AACpB,iBAAW,KAAK;AAChB,yBAAmB,KAAK;AACxB,kBAAY,KAAK;AAEjB,UAAI,kBAAkB;AAClB,mBAAW,KAAK,aAAa;AAC7B,oBAAY,SAAS,eAAe,kBAAkB,QAAQ;AAE9D,YAAI,cAAc,WAAW;AACzB,cAAI,KAAK,WAAW,SAAQ;AACxB,uBAAW,KAAK;AAAA,UACpB;AACA,mBAAS,eAAe,kBAAkB,UAAU,SAAS;AAAA,QACjE;AAAA,MACJ,OAAO;AACH,oBAAY,SAAS,aAAa,QAAQ;AAE1C,YAAI,cAAc,WAAW;AACzB,mBAAS,aAAa,UAAU,SAAS;AAAA,QAC7C;AAAA,MACJ;AAAA,IACJ;AAIA,QAAI,gBAAgB,SAAS;AAE7B,aAAS,IAAI,cAAc,SAAS,GAAG,KAAK,GAAG,KAAK;AAChD,aAAO,cAAc,CAAC;AACtB,iBAAW,KAAK;AAChB,yBAAmB,KAAK;AAExB,UAAI,kBAAkB;AAClB,mBAAW,KAAK,aAAa;AAE7B,YAAI,CAAC,OAAO,eAAe,kBAAkB,QAAQ,GAAG;AACpD,mBAAS,kBAAkB,kBAAkB,QAAQ;AAAA,QACzD;AAAA,MACJ,OAAO;AACH,YAAI,CAAC,OAAO,aAAa,QAAQ,GAAG;AAChC,mBAAS,gBAAgB,QAAQ;AAAA,QACrC;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAEA,MAAI;AACJ,MAAI,WAAW;AAEf,MAAI,MAAM,OAAO,aAAa,cAAc,SAAY;AACxD,MAAI,uBAAuB,CAAC,CAAC,OAAO,aAAa,IAAI,cAAc,UAAU;AAC7E,MAAI,oBAAoB,CAAC,CAAC,OAAO,IAAI,eAAe,8BAA8B,IAAI,YAAY;AAElG,WAAS,2BAA2B,KAAK;AACrC,QAAI,WAAW,IAAI,cAAc,UAAU;AAC3C,aAAS,YAAY;AACrB,WAAO,SAAS,QAAQ,WAAW,CAAC;AAAA,EACxC;AAEA,WAAS,wBAAwB,KAAK;AAClC,QAAI,CAAC,OAAO;AACR,cAAQ,IAAI,YAAY;AACxB,YAAM,WAAW,IAAI,IAAI;AAAA,IAC7B;AAEA,QAAI,WAAW,MAAM,yBAAyB,GAAG;AACjD,WAAO,SAAS,WAAW,CAAC;AAAA,EAChC;AAEA,WAAS,uBAAuB,KAAK;AACjC,QAAI,WAAW,IAAI,cAAc,MAAM;AACvC,aAAS,YAAY;AACrB,WAAO,SAAS,WAAW,CAAC;AAAA,EAChC;AAUA,WAAS,UAAU,KAAK;AACpB,UAAM,IAAI,KAAK;AACf,QAAI,sBAAsB;AAIxB,aAAO,2BAA2B,GAAG;AAAA,IACvC,WAAW,mBAAmB;AAC5B,aAAO,wBAAwB,GAAG;AAAA,IACpC;AAEA,WAAO,uBAAuB,GAAG;AAAA,EACrC;AAYA,WAAS,iBAAiB,QAAQ,MAAM;AACpC,QAAI,eAAe,OAAO;AAC1B,QAAI,aAAa,KAAK;AACtB,QAAI,eAAe;AAEnB,QAAI,iBAAiB,YAAY;AAC7B,aAAO;AAAA,IACX;AAEA,oBAAgB,aAAa,WAAW,CAAC;AACzC,kBAAc,WAAW,WAAW,CAAC;AAMrC,QAAI,iBAAiB,MAAM,eAAe,IAAI;AAC1C,aAAO,iBAAiB,WAAW,YAAY;AAAA,IACnD,WAAW,eAAe,MAAM,iBAAiB,IAAI;AACjD,aAAO,eAAe,aAAa,YAAY;AAAA,IACnD,OAAO;AACH,aAAO;AAAA,IACX;AAAA,EACJ;AAWA,WAAS,gBAAgB,MAAM,cAAc;AACzC,WAAO,CAAC,gBAAgB,iBAAiB,WACrC,IAAI,cAAc,IAAI,IACtB,IAAI,gBAAgB,cAAc,IAAI;AAAA,EAC9C;AAKA,WAAS,aAAa,QAAQ,MAAM;AAChC,QAAI,WAAW,OAAO;AACtB,WAAO,UAAU;AACb,UAAI,YAAY,SAAS;AACzB,WAAK,YAAY,QAAQ;AACzB,iBAAW;AAAA,IACf;AACA,WAAO;AAAA,EACX;AAEA,WAAS,oBAAoB,QAAQ,MAAM,MAAM;AAC7C,QAAI,OAAO,IAAI,MAAM,KAAK,IAAI,GAAG;AAC7B,aAAO,IAAI,IAAI,KAAK,IAAI;AACxB,UAAI,OAAO,IAAI,GAAG;AACd,eAAO,aAAa,MAAM,EAAE;AAAA,MAChC,OAAO;AACH,eAAO,gBAAgB,IAAI;AAAA,MAC/B;AAAA,IACJ;AAAA,EACJ;AAEA,MAAI,oBAAoB;AAAA,IACpB,QAAQ,SAAS,QAAQ,MAAM;AAC3B,UAAI,aAAa,OAAO;AACxB,UAAI,YAAY;AACZ,YAAI,aAAa,WAAW,SAAS,YAAY;AACjD,YAAI,eAAe,YAAY;AAC3B,uBAAa,WAAW;AACxB,uBAAa,cAAc,WAAW,SAAS,YAAY;AAAA,QAC/D;AACA,YAAI,eAAe,YAAY,CAAC,WAAW,aAAa,UAAU,GAAG;AACjE,cAAI,OAAO,aAAa,UAAU,KAAK,CAAC,KAAK,UAAU;AAInD,mBAAO,aAAa,YAAY,UAAU;AAC1C,mBAAO,gBAAgB,UAAU;AAAA,UACrC;AAIA,qBAAW,gBAAgB;AAAA,QAC/B;AAAA,MACJ;AACA,0BAAoB,QAAQ,MAAM,UAAU;AAAA,IAChD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,OAAO,SAAS,QAAQ,MAAM;AAC1B,0BAAoB,QAAQ,MAAM,SAAS;AAC3C,0BAAoB,QAAQ,MAAM,UAAU;AAE5C,UAAI,OAAO,UAAU,KAAK,OAAO;AAC7B,eAAO,QAAQ,KAAK;AAAA,MACxB;AAEA,UAAI,CAAC,KAAK,aAAa,OAAO,GAAG;AAC7B,eAAO,gBAAgB,OAAO;AAAA,MAClC;AAAA,IACJ;AAAA,IAEA,UAAU,SAAS,QAAQ,MAAM;AAC7B,UAAI,WAAW,KAAK;AACpB,UAAI,OAAO,UAAU,UAAU;AAC3B,eAAO,QAAQ;AAAA,MACnB;AAEA,UAAI,aAAa,OAAO;AACxB,UAAI,YAAY;AAGZ,YAAI,WAAW,WAAW;AAE1B,YAAI,YAAY,YAAa,CAAC,YAAY,YAAY,OAAO,aAAc;AACvE;AAAA,QACJ;AAEA,mBAAW,YAAY;AAAA,MAC3B;AAAA,IACJ;AAAA,IACA,QAAQ,SAAS,QAAQ,MAAM;AAC3B,UAAI,CAAC,KAAK,aAAa,UAAU,GAAG;AAChC,YAAI,gBAAgB;AACpB,YAAI,IAAI;AAKR,YAAI,WAAW,OAAO;AACtB,YAAI;AACJ,YAAI;AACJ,eAAM,UAAU;AACZ,qBAAW,SAAS,YAAY,SAAS,SAAS,YAAY;AAC9D,cAAI,aAAa,YAAY;AACzB,uBAAW;AACX,uBAAW,SAAS;AAEpB,gBAAI,CAAC,UAAU;AACX,yBAAW,SAAS;AACpB,yBAAW;AAAA,YACf;AAAA,UACJ,OAAO;AACH,gBAAI,aAAa,UAAU;AACvB,kBAAI,SAAS,aAAa,UAAU,GAAG;AACnC,gCAAgB;AAChB;AAAA,cACJ;AACA;AAAA,YACJ;AACA,uBAAW,SAAS;AACpB,gBAAI,CAAC,YAAY,UAAU;AACvB,yBAAW,SAAS;AACpB,yBAAW;AAAA,YACf;AAAA,UACJ;AAAA,QACJ;AAEA,eAAO,gBAAgB;AAAA,MAC3B;AAAA,IACJ;AAAA,EACJ;AAEA,MAAI,eAAe;AACnB,MAAI,2BAA2B;AAC/B,MAAI,YAAY;AAChB,MAAI,eAAe;AAEnB,WAAS,OAAO;AAAA,EAAC;AAEjB,WAAS,kBAAkB,MAAM;AAC/B,QAAI,MAAM;AACR,aAAQ,KAAK,gBAAgB,KAAK,aAAa,IAAI,KAAM,KAAK;AAAA,IAChE;AAAA,EACF;AAEA,WAAS,gBAAgBC,aAAY;AAEnC,WAAO,SAASC,UAAS,UAAU,QAAQ,SAAS;AAClD,UAAI,CAAC,SAAS;AACZ,kBAAU,CAAC;AAAA,MACb;AAEA,UAAI,OAAO,WAAW,UAAU;AAC9B,YAAI,SAAS,aAAa,eAAe,SAAS,aAAa,UAAU,SAAS,aAAa,QAAQ;AACrG,cAAI,aAAa;AACjB,mBAAS,IAAI,cAAc,MAAM;AACjC,iBAAO,YAAY;AAAA,QACrB,OAAO;AACL,mBAAS,UAAU,MAAM;AAAA,QAC3B;AAAA,MACF,WAAW,OAAO,aAAa,0BAA0B;AACvD,iBAAS,OAAO;AAAA,MAClB;AAEA,UAAI,aAAa,QAAQ,cAAc;AACvC,UAAI,oBAAoB,QAAQ,qBAAqB;AACrD,UAAI,cAAc,QAAQ,eAAe;AACzC,UAAI,oBAAoB,QAAQ,qBAAqB;AACrD,UAAI,cAAc,QAAQ,eAAe;AACzC,UAAI,wBAAwB,QAAQ,yBAAyB;AAC7D,UAAI,kBAAkB,QAAQ,mBAAmB;AACjD,UAAI,4BAA4B,QAAQ,6BAA6B;AACrE,UAAI,mBAAmB,QAAQ,oBAAoB;AACnD,UAAI,WAAW,QAAQ,YAAY,SAAS,QAAQ,OAAM;AAAE,eAAO,OAAO,YAAY,KAAK;AAAA,MAAG;AAC9F,UAAI,eAAe,QAAQ,iBAAiB;AAG5C,UAAI,kBAAkB,uBAAO,OAAO,IAAI;AACxC,UAAI,mBAAmB,CAAC;AAExB,eAAS,gBAAgB,KAAK;AAC5B,yBAAiB,KAAK,GAAG;AAAA,MAC3B;AAEA,eAAS,wBAAwB,MAAM,gBAAgB;AACrD,YAAI,KAAK,aAAa,cAAc;AAClC,cAAI,WAAW,KAAK;AACpB,iBAAO,UAAU;AAEf,gBAAI,MAAM;AAEV,gBAAI,mBAAmB,MAAM,WAAW,QAAQ,IAAI;AAGlD,8BAAgB,GAAG;AAAA,YACrB,OAAO;AAIL,8BAAgB,QAAQ;AACxB,kBAAI,SAAS,YAAY;AACvB,wCAAwB,UAAU,cAAc;AAAA,cAClD;AAAA,YACF;AAEA,uBAAW,SAAS;AAAA,UACtB;AAAA,QACF;AAAA,MACF;AAUA,eAAS,WAAW,MAAM,YAAY,gBAAgB;AACpD,YAAI,sBAAsB,IAAI,MAAM,OAAO;AACzC;AAAA,QACF;AAEA,YAAI,YAAY;AACd,qBAAW,YAAY,IAAI;AAAA,QAC7B;AAEA,wBAAgB,IAAI;AACpB,gCAAwB,MAAM,cAAc;AAAA,MAC9C;AA8BA,eAAS,UAAU,MAAM;AACvB,YAAI,KAAK,aAAa,gBAAgB,KAAK,aAAa,0BAA0B;AAChF,cAAI,WAAW,KAAK;AACpB,iBAAO,UAAU;AACf,gBAAI,MAAM,WAAW,QAAQ;AAC7B,gBAAI,KAAK;AACP,8BAAgB,GAAG,IAAI;AAAA,YACzB;AAGA,sBAAU,QAAQ;AAElB,uBAAW,SAAS;AAAA,UACtB;AAAA,QACF;AAAA,MACF;AAEA,gBAAU,QAAQ;AAElB,eAAS,gBAAgB,IAAI;AAC3B,oBAAY,EAAE;AAEd,YAAI,WAAW,GAAG;AAClB,eAAO,UAAU;AACf,cAAI,cAAc,SAAS;AAE3B,cAAI,MAAM,WAAW,QAAQ;AAC7B,cAAI,KAAK;AACP,gBAAI,kBAAkB,gBAAgB,GAAG;AAGzC,gBAAI,mBAAmB,iBAAiB,UAAU,eAAe,GAAG;AAClE,uBAAS,WAAW,aAAa,iBAAiB,QAAQ;AAC1D,sBAAQ,iBAAiB,QAAQ;AAAA,YACnC,OAAO;AACL,8BAAgB,QAAQ;AAAA,YAC1B;AAAA,UACF,OAAO;AAGL,4BAAgB,QAAQ;AAAA,UAC1B;AAEA,qBAAW;AAAA,QACb;AAAA,MACF;AAEA,eAAS,cAAc,QAAQ,kBAAkB,gBAAgB;AAI/D,eAAO,kBAAkB;AACvB,cAAI,kBAAkB,iBAAiB;AACvC,cAAK,iBAAiB,WAAW,gBAAgB,GAAI;AAGnD,4BAAgB,cAAc;AAAA,UAChC,OAAO;AAGL;AAAA,cAAW;AAAA,cAAkB;AAAA,cAAQ;AAAA;AAAA,YAA2B;AAAA,UAClE;AACA,6BAAmB;AAAA,QACrB;AAAA,MACF;AAEA,eAAS,QAAQ,QAAQ,MAAMC,eAAc;AAC3C,YAAI,UAAU,WAAW,IAAI;AAE7B,YAAI,SAAS;AAGX,iBAAO,gBAAgB,OAAO;AAAA,QAChC;AAEA,YAAI,CAACA,eAAc;AAEjB,cAAI,qBAAqB,kBAAkB,QAAQ,IAAI;AACvD,cAAI,uBAAuB,OAAO;AAChC;AAAA,UACF,WAAW,8BAA8B,aAAa;AACpD,qBAAS;AAKT,sBAAU,MAAM;AAAA,UAClB;AAGA,UAAAF,YAAW,QAAQ,IAAI;AAEvB,sBAAY,MAAM;AAElB,cAAI,0BAA0B,QAAQ,IAAI,MAAM,OAAO;AACrD;AAAA,UACF;AAAA,QACF;AAEA,YAAI,OAAO,aAAa,YAAY;AAClC,wBAAc,QAAQ,IAAI;AAAA,QAC5B,OAAO;AACL,4BAAkB,SAAS,QAAQ,IAAI;AAAA,QACzC;AAAA,MACF;AAEA,eAAS,cAAc,QAAQ,MAAM;AACnC,YAAI,WAAW,iBAAiB,QAAQ,IAAI;AAC5C,YAAI,iBAAiB,KAAK;AAC1B,YAAI,mBAAmB,OAAO;AAC9B,YAAI;AACJ,YAAI;AAEJ,YAAI;AACJ,YAAI;AACJ,YAAI;AAGJ;AAAO,iBAAO,gBAAgB;AAC5B,4BAAgB,eAAe;AAC/B,2BAAe,WAAW,cAAc;AAGxC,mBAAO,CAAC,YAAY,kBAAkB;AACpC,gCAAkB,iBAAiB;AAEnC,kBAAI,eAAe,cAAc,eAAe,WAAW,gBAAgB,GAAG;AAC5E,iCAAiB;AACjB,mCAAmB;AACnB,yBAAS;AAAA,cACX;AAEA,+BAAiB,WAAW,gBAAgB;AAE5C,kBAAI,kBAAkB,iBAAiB;AAGvC,kBAAI,eAAe;AAEnB,kBAAI,oBAAoB,eAAe,UAAU;AAC/C,oBAAI,oBAAoB,cAAc;AAGpC,sBAAI,cAAc;AAGhB,wBAAI,iBAAiB,gBAAgB;AAInC,0BAAK,iBAAiB,gBAAgB,YAAY,GAAI;AACpD,4BAAI,oBAAoB,gBAAgB;AAMtC,yCAAe;AAAA,wBACjB,OAAO;AAQL,iCAAO,aAAa,gBAAgB,gBAAgB;AAIpD,8BAAI,gBAAgB;AAGlB,4CAAgB,cAAc;AAAA,0BAChC,OAAO;AAGL;AAAA,8BAAW;AAAA,8BAAkB;AAAA,8BAAQ;AAAA;AAAA,4BAA2B;AAAA,0BAClE;AAEA,6CAAmB;AACnB,2CAAiB,WAAW,gBAAgB;AAAA,wBAC9C;AAAA,sBACF,OAAO;AAGL,uCAAe;AAAA,sBACjB;AAAA,oBACF;AAAA,kBACF,WAAW,gBAAgB;AAEzB,mCAAe;AAAA,kBACjB;AAEA,iCAAe,iBAAiB,SAAS,iBAAiB,kBAAkB,cAAc;AAC1F,sBAAI,cAAc;AAKhB,4BAAQ,kBAAkB,cAAc;AAAA,kBAC1C;AAAA,gBAEF,WAAW,oBAAoB,aAAa,mBAAmB,cAAc;AAE3E,iCAAe;AAGf,sBAAI,iBAAiB,cAAc,eAAe,WAAW;AAC3D,qCAAiB,YAAY,eAAe;AAAA,kBAC9C;AAAA,gBAEF;AAAA,cACF;AAEA,kBAAI,cAAc;AAGhB,iCAAiB;AACjB,mCAAmB;AACnB,yBAAS;AAAA,cACX;AAQA,kBAAI,gBAAgB;AAGlB,gCAAgB,cAAc;AAAA,cAChC,OAAO;AAGL;AAAA,kBAAW;AAAA,kBAAkB;AAAA,kBAAQ;AAAA;AAAA,gBAA2B;AAAA,cAClE;AAEA,iCAAmB;AAAA,YACrB;AAMA,gBAAI,iBAAiB,iBAAiB,gBAAgB,YAAY,MAAM,iBAAiB,gBAAgB,cAAc,GAAG;AAExH,kBAAG,CAAC,UAAS;AAAE,yBAAS,QAAQ,cAAc;AAAA,cAAG;AACjD,sBAAQ,gBAAgB,cAAc;AAAA,YACxC,OAAO;AACL,kBAAI,0BAA0B,kBAAkB,cAAc;AAC9D,kBAAI,4BAA4B,OAAO;AACrC,oBAAI,yBAAyB;AAC3B,mCAAiB;AAAA,gBACnB;AAEA,oBAAI,eAAe,WAAW;AAC5B,mCAAiB,eAAe,UAAU,OAAO,iBAAiB,GAAG;AAAA,gBACvE;AACA,yBAAS,QAAQ,cAAc;AAC/B,gCAAgB,cAAc;AAAA,cAChC;AAAA,YACF;AAEA,6BAAiB;AACjB,+BAAmB;AAAA,UACrB;AAEA,sBAAc,QAAQ,kBAAkB,cAAc;AAEtD,YAAI,mBAAmB,kBAAkB,OAAO,QAAQ;AACxD,YAAI,kBAAkB;AACpB,2BAAiB,QAAQ,IAAI;AAAA,QAC/B;AAAA,MACF;AAEA,UAAI,cAAc;AAClB,UAAI,kBAAkB,YAAY;AAClC,UAAI,aAAa,OAAO;AAExB,UAAI,CAAC,cAAc;AAGjB,YAAI,oBAAoB,cAAc;AACpC,cAAI,eAAe,cAAc;AAC/B,gBAAI,CAAC,iBAAiB,UAAU,MAAM,GAAG;AACvC,8BAAgB,QAAQ;AACxB,4BAAc,aAAa,UAAU,gBAAgB,OAAO,UAAU,OAAO,YAAY,CAAC;AAAA,YAC5F;AAAA,UACF,OAAO;AAEL,0BAAc;AAAA,UAChB;AAAA,QACF,WAAW,oBAAoB,aAAa,oBAAoB,cAAc;AAC5E,cAAI,eAAe,iBAAiB;AAClC,gBAAI,YAAY,cAAc,OAAO,WAAW;AAC9C,0BAAY,YAAY,OAAO;AAAA,YACjC;AAEA,mBAAO;AAAA,UACT,OAAO;AAEL,0BAAc;AAAA,UAChB;AAAA,QACF;AAAA,MACF;AAEA,UAAI,gBAAgB,QAAQ;AAG1B,wBAAgB,QAAQ;AAAA,MAC1B,OAAO;AACL,YAAI,OAAO,cAAc,OAAO,WAAW,WAAW,GAAG;AACvD;AAAA,QACF;AAEA,gBAAQ,aAAa,QAAQ,YAAY;AAOzC,YAAI,kBAAkB;AACpB,mBAAS,IAAE,GAAG,MAAI,iBAAiB,QAAQ,IAAE,KAAK,KAAK;AACrD,gBAAI,aAAa,gBAAgB,iBAAiB,CAAC,CAAC;AACpD,gBAAI,YAAY;AACd,yBAAW,YAAY,WAAW,YAAY,KAAK;AAAA,YACrD;AAAA,UACF;AAAA,QACF;AAAA,MACF;AAEA,UAAI,CAAC,gBAAgB,gBAAgB,YAAY,SAAS,YAAY;AACpE,YAAI,YAAY,WAAW;AACzB,wBAAc,YAAY,UAAU,SAAS,iBAAiB,GAAG;AAAA,QACnE;AAMA,iBAAS,WAAW,aAAa,aAAa,QAAQ;AAAA,MACxD;AAEA,aAAO;AAAA,IACT;AAAA,EACF;AAEA,MAAI,WAAW,gBAAgB,UAAU;AAEzC,MAAO,uBAAQ;;;ACnvBR,MAAM,cAAN,MAAM,YAAW;AAAA,IASpB,YAAY,QAAiB,OAAO;AAChC,WAAK,QAAQ;AAAA,IACjB;AAAA;AAAA;AAAA;AAAA;AAAA,IAMQ,WAAW,MAAgC;AAC/C,UAAI,EAAE,gBAAgB;AAAc,eAAO;AAG3C,iBAAW,QAAQ,KAAK,YAAY;AAChC,YAAI,KAAK,KAAK,WAAW,UAAU,GAAG;AAClC,gBAAM,MAAM,GAAG,KAAK,OAAO,IAAI,KAAK,IAAI,IAAI,KAAK,KAAK;AACtD,iBAAO;AAAA,QACX;AAAA,MACJ;AAGA,UAAI,KAAK,MAAM,CAAC,KAAK,GAAG,WAAW,aAAa,GAAG;AAC/C,eAAO,KAAK;AAAA,MAChB;AAGA,UAAI,gBAAgB,oBAChB,gBAAgB,qBAChB,gBAAgB,qBAAqB;AACrC,YAAI,KAAK,MAAM;AACX,iBAAO,GAAG,KAAK,OAAO,SAAS,KAAK,IAAI;AAAA,QAC5C;AAAA,MACJ;AAGA,aAAO;AAAA,IACX;AAAA;AAAA;AAAA;AAAA,IAKQ,mBAAmB,IAAqB;AAC5C,UAAI,GAAG;AAAI,eAAO,IAAI,GAAG,EAAE;AAG3B,YAAM,OAAiB,CAAC;AACxB,UAAI,UAA0B;AAE9B,aAAO,WAAW,YAAY,SAAS,QAAQ,KAAK,SAAS,GAAG;AAC5D,YAAI,WAAW,QAAQ,QAAQ,YAAY;AAG3C,YAAI,QAAQ,IAAI;AACZ,qBAAW,IAAI,QAAQ,EAAE;AACzB,eAAK,QAAQ,QAAQ;AACrB;AAAA,QACJ;AAGA,YAAI,mBAAmB,oBACnB,mBAAmB,qBACnB,mBAAmB,qBAAqB;AACxC,cAAI,QAAQ,MAAM;AACd,wBAAY,UAAU,QAAQ,IAAI;AAAA,UACtC;AAAA,QACJ;AAGA,mBAAW,QAAQ,QAAQ,YAAY;AACnC,cAAI,KAAK,KAAK,WAAW,UAAU,GAAG;AAClC,wBAAY,IAAI,KAAK,IAAI,KAAK,KAAK,KAAK;AACxC;AAAA,UACJ;AAAA,QACJ;AAGA,YAAI,QAAQ,eAAe;AACvB,gBAAM,OAAO,MAAM,KAAK,QAAQ,cAAc,QAAQ;AACtD,gBAAM,WAAW,KAAK,OAAO,OAAK,EAAE,YAAY,QAAS,OAAO;AAChE,cAAI,SAAS,SAAS,GAAG;AACrB,kBAAM,MAAM,SAAS,QAAQ,OAAO,IAAI;AACxC,wBAAY,gBAAgB,GAAG;AAAA,UACnC;AAAA,QACJ;AAEA,aAAK,QAAQ,QAAQ;AACrB,kBAAU,QAAQ;AAAA,MACtB;AAEA,aAAO,KAAK,KAAK,KAAK;AAAA,IAC1B;AAAA;AAAA;AAAA;AAAA,IAKQ,oBAAuC;AAC3C,YAAM,SAAS,SAAS;AACxB,UAAI,CAAC,UAAU,WAAW,SAAS,QAAQ,WAAW,SAAS;AAAiB,eAAO;AAEvF,YAAM,QAAoB;AAAA,QACtB,UAAU,KAAK,mBAAmB,MAAM;AAAA,QACxC,IAAI,OAAO,MAAM;AAAA,QACjB,SAAS,OAAO;AAAA,QAChB,gBAAgB;AAAA,QAChB,cAAc;AAAA,QACd,WAAW;AAAA,QACX,YAAY;AAAA,QACZ,OAAO;AAAA,MACX;AAEA,UAAI,kBAAkB,oBAAoB,kBAAkB,qBAAqB;AAC7E,cAAM,iBAAiB,OAAO;AAC9B,cAAM,eAAe,OAAO;AAC5B,cAAM,YAAY,OAAO;AACzB,cAAM,aAAa,OAAO;AAC1B,cAAM,QAAQ,OAAO;AAAA,MACzB;AAEA,aAAO;AAAA,IACX;AAAA;AAAA;AAAA;AAAA,IAKQ,kBAAkB,OAAgC;AACtD,UAAI,CAAC;AAAO;AAGZ,UAAI,KAAqB;AACzB,UAAI,MAAM,IAAI;AACV,aAAK,SAAS,eAAe,MAAM,EAAE;AAAA,MACzC;AACA,UAAI,CAAC,MAAM,MAAM,UAAU;AACvB,YAAI;AACA,eAAK,SAAS,cAAc,MAAM,QAAQ;AAAA,QAC9C,SAAS,GAAG;AAAA,QAEZ;AAAA,MACJ;AAEA,UAAI,CAAC;AAAI;AAGT,MAAC,GAAmB,MAAM;AAG1B,UAAI,cAAc,oBAAoB,cAAc,qBAAqB;AAErE,YAAI,MAAM,SAAS,GAAG,UAAU,MAAM,OAAO;AACzC,aAAG,QAAQ,MAAM;AAAA,QACrB;AAEA,YAAI,MAAM,mBAAmB,QAAQ,MAAM,iBAAiB,MAAM;AAC9D,cAAI;AACA,eAAG,kBAAkB,MAAM,gBAAgB,MAAM,YAAY;AAAA,UACjE,SAAS,GAAG;AAAA,UAEZ;AAAA,QACJ;AACA,WAAG,YAAY,MAAM;AACrB,WAAG,aAAa,MAAM;AAAA,MAC1B;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,OAAO,SAAuB;AAE1B,kBAAW,aAAa;AACxB,UAAI,KAAK,OAAO;AACZ,gBAAQ,IAAI,8CAA8C,YAAW,UAAU;AAAA,MACnF;AAEA,UAAI;AAEA,cAAM,aAAa,KAAK,kBAAkB;AAG1C,cAAM,aAAa,oBAAI,IAA0E;AACjG,iBAAS,iBAAiB,yBAAyB,EAAE,QAAQ,CAAC,IAAI,QAAQ;AACtE,gBAAM,MAAM,KAAK,WAAW,EAAE,KAAK,WAAW,GAAG;AACjD,cAAI,cAAc,kBAAkB;AAChC,uBAAW,IAAI,KAAK;AAAA,cAChB,OAAO,GAAG;AAAA,cACV,SAAS,GAAG,SAAS,cAAc,GAAG,SAAS,UAAU,GAAG,UAAU;AAAA,YAC1E,CAAC;AAAA,UACL,WAAW,cAAc,mBAAmB;AACxC,uBAAW,IAAI,KAAK,EAAE,OAAO,GAAG,OAAO,eAAe,GAAG,cAAc,CAAC;AAAA,UAC5E,WAAW,cAAc,qBAAqB;AAC1C,uBAAW,IAAI,KAAK,EAAE,OAAO,GAAG,MAAM,CAAC;AAAA,UAC3C;AAAA,QACJ,CAAC;AAED,YAAI,sBAAU;AACV,cAAI;AACA,iCAAS,SAAS,iBAAiB,SAAS;AAAA;AAAA,cAExC,YAAY,CAAC,SAAe,KAAK,WAAW,IAAI;AAAA,cAEhD,mBAAmB,CAAC,QAAQ,SAAS;AAMjC,oBAAI,kBAAkB,oBAAoB,gBAAgB,kBAAkB;AACxE,sBAAI,OAAO,SAAS,cAAc,OAAO,SAAS,SAAS;AACvD,yBAAK,UAAU,OAAO;AAAA,kBAC1B,OAAO;AACH,0BAAM,IAAI,KAAK,SAAS;AACxB,0BAAM,IAAI,OAAO,SAAS;AAC1B,wBAAI,EAAE,WAAW,CAAC,KAAK,EAAE,WAAW,CAAC,GAAG;AACpC,2BAAK,QAAQ;AAAA,oBACjB;AAAA,kBACJ;AAAA,gBACJ;AAEA,oBAAI,kBAAkB,uBAAuB,gBAAgB,qBAAqB;AAC9E,wBAAM,IAAI,KAAK,SAAS;AACxB,wBAAM,IAAI,OAAO,SAAS;AAC1B,sBAAI,EAAE,WAAW,CAAC,KAAK,EAAE,WAAW,CAAC,GAAG;AACpC,yBAAK,QAAQ;AAAA,kBACjB;AAAA,gBACJ;AAGA,oBAAI,kBAAkB,qBAAqB,gBAAgB,mBAAmB;AAE1E,sBAAI,OAAO,SAAS,MAAM,KAAK,KAAK,OAAO,EAAE,KAAK,OAAK,EAAE,UAAU,OAAO,KAAK,GAAG;AAC9E,yBAAK,QAAQ,OAAO;AAAA,kBACxB,WAAW,OAAO,iBAAiB,KAAK,OAAO,gBAAgB,KAAK,QAAQ,QAAQ;AAChF,yBAAK,gBAAgB,OAAO;AAAA,kBAChC;AAAA,gBACJ;AAGA,oBAAI,OAAO,MAAM,OAAO,GAAG,WAAW,aAAa,KAAK,CAAC,KAAK,IAAI;AAC9D,uBAAK,KAAK,OAAO;AAAA,gBACrB;AAEA,uBAAO;AAAA,cACX;AAAA,cAEA,uBAAuB,MAAM;AAAA,YACjC,CAAC;AAAA,UACL,SAAS,GAAG;AACR,oBAAQ,MAAM,oBAAoB,CAAC;AACnC,qBAAS,KAAK;AACd,qBAAS,MAAM,OAAO;AACtB,qBAAS,MAAM;AAAA,UACnB;AAGA,eAAK,kBAAkB,UAAU;AAAA,QACrC,OAAO;AACH,mBAAS,KAAK;AACd,mBAAS,MAAM,OAAO;AACtB,mBAAS,MAAM;AAAA,QACnB;AAAA,MACJ,UAAE;AAEE,mBAAW,MAAM;AACb,sBAAW,aAAa;AAAA,QAC5B,GAAG,CAAC;AAAA,MACR;AAAA,IACJ;AAAA,EACJ;AA9QI;AAAA;AAAA;AAAA;AAAA,EALS,YAKF,aAAa;AALjB,MAAM,aAAN;;;ACXA,MAAM,sBAAN,MAA0B;AAAA,IAc7B,YAAYG,MAAkB;AAZ9B,WAAQ,aAAa,oBAAI,IAAoB;AAC7C,WAAQ,aAAa,oBAAI,IAAoB;AAE7C,WAAQ,kBAAkB;AAAA,QACtB;AAAA,QAAS;AAAA,QAAU;AAAA,QAAS;AAAA,QAC5B;AAAA,QAAW;AAAA,QAAS;AAAA,QAAS;AAAA,QAC7B;AAAA,QAAc;AAAA,QAAc;AAAA,QAAU;AAAA,MAC1C;AAGA;AAAA,WAAQ,uBAAuB,CAAC,SAAS,QAAQ,cAAc,YAAY;AAGvE,WAAK,MAAMA;AAAA,IACf;AAAA,IAEQ,YAAY,MAAmB;AACnC,UAAI,KAAK,IAAI,UAAU,EAAE,OAAO;AAC5B,gBAAQ,IAAI,GAAG,IAAI;AAAA,MACvB;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA,OAAa;AACT,WAAK,gBAAgB,QAAQ,eAAa;AACtC,cAAM,UAAW,cAAc,gBAAgB,cAAc,gBAAgB,cAAc,WAAW,cAAc,UAAU,cAAc,WACtI,EAAE,SAAS,KAAK,IAChB;AAEN,iBAAS,iBAAiB,WAAW,CAAC,MAAM,KAAK,YAAY,CAAC,GAAG,OAAO;AAAA,MAC5E,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKQ,YAAY,SAAsB,WAA+E;AACrH,YAAM,cAAc,WAAW,SAAS;AACxC,YAAM,YAAY,QAAQ,aAAa,WAAW;AAClD,UAAI,CAAC;AAAW,eAAO,CAAC;AAExB,UAAI,UAAU,KAAK,EAAE,WAAW,GAAG,GAAG;AAClC,YAAI;AACA,gBAAM,WAAW,KAAK,MAAM,SAAS;AACrC,cAAI,MAAM,QAAQ,QAAQ,GAAG;AACzB,mBAAO,SAAS,IAAI,CAAC,OAAY;AAAA,cAC7B,MAAM,EAAE;AAAA,cACR,WAAW,EAAE,aAAa,CAAC;AAAA,cAC3B,MAAM,EAAE;AAAA,YACZ,EAAE;AAAA,UACN;AAAA,QACJ,SAAS,GAAG;AACR,kBAAQ,MAAM,iCAAiC,CAAC;AAAA,QACpD;AAAA,MACJ,OAAO;AAEH,cAAM,gBAAgB,QAAQ,aAAa,kBAAkB,SAAS,EAAE;AACxE,cAAM,YAAY,gBAAgB,cAAc,MAAM,GAAG,EAAE,OAAO,OAAK,CAAC,IAAI,CAAC;AAC7E,eAAO,CAAC,EAAE,MAAM,WAAW,WAAW,MAAM,OAAU,CAAC;AAAA,MAC3D;AACA,aAAO,CAAC;AAAA,IACZ;AAAA;AAAA;AAAA;AAAA,IAKA,MAAc,YAAY,GAAyB;AAC/C,YAAM,YAAY,EAAE;AAGpB,UAAI,WAAW,cAAc,KAAK,qBAAqB,SAAS,SAAS,GAAG;AACxE,aAAK,SAAS,8CAA8C,WAAW,eAAe,WAAW,UAAU;AAC3G;AAAA,MACJ;AAEA,WAAK,SAAS,+BAA+B,WAAW,eAAe,WAAW,UAAU;AAG5F,YAAM,OAAO,EAAE,eAAe,EAAE,aAAa,IAAI,CAAC;AAClD,UAAI,qBAAqB;AAEzB,iBAAW,QAAQ,MAAM;AACrB,YAAI;AAAoB;AAExB,YAAI,gBAAgB,aAAa;AAC7B,gBAAM,UAAU;AAChB,gBAAM,WAAW,KAAK,YAAY,SAAS,SAAS;AAEpD,cAAI,SAAS,SAAS,GAAG;AACrB,iBAAK,SAAS,mCAAmC,QAAQ,SAAS,QAAQ;AAE1E,uBAAW,KAAK,UAAU;AAEtB,kBAAI,CAAC,EAAE,UAAU,SAAS,QAAQ,KAAK,CAAC,EAAE,UAAU,SAAS,SAAS,GAAG;AACrE,qBAAK,aAAa,SAAS,WAAW,EAAE,MAAM,EAAE,WAAW,GAAG,EAAE,IAAI;AACpE,oBAAI,EAAE;AAAc,uCAAqB;AAAA,cAC7C;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAGA,WAAK,kBAAkB,CAAC;AAAA,IAC5B;AAAA;AAAA;AAAA;AAAA,IAKQ,kBAAkB,GAAgB;AACtC,YAAM,YAAY,EAAE;AACpB,YAAM,iBAAiB,mBAAmB,SAAS;AACnD,YAAM,kBAAkB,mBAAmB,SAAS;AAEpD,YAAM,aAAa,SAAS,iBAAiB,GAAG,cAAc,KAAK,eAAe,EAAE;AAEpF,iBAAW,QAAQ,QAAM;AACrB,YAAI,EAAE,cAAc;AAAc;AAElC,cAAM,WAAW,KAAK,YAAY,IAAI,SAAS;AAC/C,mBAAW,KAAK,UAAU;AAEtB,cAAI,EAAE,UAAU,SAAS,QAAQ,GAAG;AAChC,iBAAK,aAAa,IAAI,WAAW,EAAE,MAAM,EAAE,WAAW,GAAG,EAAE,IAAI;AAAA,UACnE;AAGA,cAAI,EAAE,UAAU,SAAS,SAAS,GAAG;AACjC,kBAAM,SAAS,EAAE;AACjB,gBAAI,UAAU,CAAC,GAAG,SAAS,MAAM,GAAG;AAChC,mBAAK,aAAa,IAAI,WAAW,EAAE,MAAM,EAAE,WAAW,GAAG,EAAE,IAAI;AAAA,YACnE;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKQ,aAAa,SAAsB,WAAmB,aAAqB,WAAqB,GAAU,cAA4B;AAC1I,WAAK,SAAS,kBAAkB,WAAW,YAAY,aAAa,cAAc,SAAS;AAK3F,UAAI,UAAU,SAAS,SAAS,KAAK,cAAc,UAAU;AACzD,aAAK,SAAS,uCAAuC;AACrD,UAAE,eAAe;AAAA,MACrB;AAGA,UAAI,UAAU,SAAS,MAAM,GAAG;AAC5B,UAAE,gBAAgB;AAAA,MACtB;AAGA,UAAI,UAAU,SAAS,MAAM,GAAG;AAC5B,YAAI,EAAE,WAAW;AAAS;AAAA,MAC9B;AAKA,UAAI,UAAU,SAAS,OAAO,KAAK,CAAE,EAAU;AAAU;AACzD,UAAI,UAAU,SAAS,MAAM,KAAK,CAAE,EAAU;AAAS;AACvD,UAAI,UAAU,SAAS,KAAK,KAAK,CAAE,EAAU;AAAQ;AACrD,UAAI,UAAU,SAAS,MAAM,KAAK,CAAE,EAAU;AAAS;AACvD,UAAI,UAAU,SAAS,KAAK,KAAK,CAAE,EAAU;AAAS;AAEtD,UAAI,aAAa,eAAe;AAE5B,cAAM,YAAY,CAAC,SAAS,UAAU,SAAS,OAAO,MAAM,QAAQ,QAAQ,OAAO;AAEnF,cAAM,aAAa,CAAC,SAAS,QAAQ,OAAO,QAAQ,OAAO,UAAU,WAAW,WAAW,QAAQ,QAAQ,YAAY,UAAU;AAGjI,cAAM,eAAe,UAAU,OAAO,OAAK;AACvC,cAAI,WAAW,SAAS,CAAC;AAAG,mBAAO;AACnC,cAAI,EAAE,WAAW,UAAU,KAAK,EAAE,WAAW,UAAU;AAAG,mBAAO;AACjE,cAAI,EAAE,SAAS,IAAI;AAAG,mBAAO;AAC7B,iBAAO,UAAU,SAAS,CAAC,KAAK,EAAE,WAAW;AAAA,QACjD,CAAC;AAED,YAAI,aAAa,SAAS,GAAG;AACzB,gBAAM,aAAa,EAAE,IAAI,YAAY;AACrC,eAAK,SAAS,sCAAsC,YAAY,cAAc,YAAY;AAG1F,gBAAM,SAAiC;AAAA,YACnC,UAAU;AAAA,YACV,OAAO;AAAA,YACP,SAAS;AAAA,YACT,SAAS;AAAA,YACT,YAAY;AAAA,YACZ,KAAK;AAAA,YACL,OAAO;AAAA,YACP,MAAM;AAAA,YACN,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,aAAa;AAAA,YACb,SAAS;AAAA,YACT,cAAc;AAAA,UAClB;AAGA,gBAAM,uBAAuB,OAAO,UAAU,KAAK;AAGnD,cAAI,QAAQ;AACZ,qBAAW,cAAc,cAAc;AACnC,kBAAM,YAAY,OAAO,UAAU,KAAK;AACxC,iBAAK,SAAS,wCAAwC,YAAY,MAAM,WAAW,MAAM,sBAAsB,SAAS,EAAE,IAAI;AAG9H,gBAAI,cAAc,sBAAsB;AACpC,sBAAQ;AACR;AAAA,YACJ;AAIA,gBAAI,EAAE,QAAQ,EAAE,KAAK,YAAY,MAAM,MAAM,SAAS,IAAI;AACtD,sBAAQ;AACR;AAAA,YACJ;AAAA,UACJ;AACA,cAAI,CAAC,OAAO;AACR,iBAAK,SAAS,oCAAoC;AAClD;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAGA,YAAM,cAAc,UAAU,KAAK,OAAK,EAAE,WAAW,UAAU,CAAC;AAChE,YAAM,cAAc,UAAU,KAAK,OAAK,EAAE,WAAW,UAAU,CAAC;AAEhE,YAAM,YAAY,QAAQ,MAAM,KAAK,YAAY,OAAO;AACxD,YAAM,WAAW,GAAG,SAAS,IAAI,SAAS,IAAI,WAAW;AAEzD,UAAI,aAAa;AACb,cAAM,WAAW,KAAK,cAAc,WAAW,GAAG;AAElD,YAAI,KAAK,WAAW,IAAI,QAAQ,GAAG;AAC/B,iBAAO,aAAa,KAAK,WAAW,IAAI,QAAQ,CAAC;AAAA,QACrD;AAEA,cAAM,QAAQ,OAAO,WAAW,MAAM;AAClC,eAAK,WAAW,OAAO,QAAQ;AAC/B,eAAK,cAAc,SAAS,WAAW,aAAa,GAAG,YAAY;AAAA,QACvE,GAAG,QAAQ;AAEX,aAAK,WAAW,IAAI,UAAU,KAAK;AACnC;AAAA,MACJ;AAEA,UAAI,aAAa;AACb,cAAM,WAAW,KAAK,cAAc,WAAW,GAAG;AAClD,YAAI,KAAK,WAAW,IAAI,QAAQ;AAAG;AAEnC,aAAK,WAAW,IAAI,UAAU,KAAK,IAAI,CAAC;AAExC,aAAK,cAAc,SAAS,WAAW,aAAa,GAAG,YAAY;AAEnE,eAAO,WAAW,MAAM;AACpB,eAAK,WAAW,OAAO,QAAQ;AAAA,QACnC,GAAG,QAAQ;AACX;AAAA,MACJ;AAGA,WAAK,cAAc,SAAS,WAAW,aAAa,GAAG,YAAY;AAAA,IACvE;AAAA;AAAA;AAAA;AAAA,IAKQ,cAAc,SAAsB,WAAmB,SAAiB,GAAU,cAA4B;AAElH,UAAI,OAA4B,CAAC;AACjC,UAAI,gBAAgB,aAAa,SAAS,GAAG;AACzC,qBAAa,QAAQ,CAAC,KAAU,MAAc;AAC1C,eAAK,MAAM,CAAC,EAAE,IAAI;AAAA,QACtB,CAAC;AAAA,MACL,OAAO;AACH,eAAO,KAAK,QAAQ,OAAO;AAAA,MAC/B;AAEA,YAAM,YAAuB;AAAA,QACzB,MAAM;AAAA,QACN,IAAI,QAAQ;AAAA,QACZ;AAAA,MACJ;AAGA,UAAI,mBAAmB,kBAAkB;AACrC,kBAAU,QAAQ,QAAQ;AAC1B,YAAI,QAAQ,SAAS,cAAc,QAAQ,SAAS,SAAS;AACzD,oBAAU,UAAU,QAAQ;AAAA,QAChC;AAAA,MACJ,WAAW,mBAAmB,uBAAuB,mBAAmB,mBAAmB;AACvF,kBAAU,QAAQ,QAAQ;AAAA,MAC9B;AAGA,UAAI,aAAa,eAAe;AAC5B,kBAAU,MAAM,EAAE;AAClB,kBAAU,UAAU,EAAE;AAAA,MAC1B;AAGA,UAAI,cAAc,YAAY,mBAAmB,iBAAiB;AAC9D,cAAM,WAAW,IAAI,SAAS,OAAO;AACrC,cAAM,OAA4B,CAAC;AACnC,iBAAS,QAAQ,CAAC,OAAO,QAAQ;AAC7B,cAAI,EAAE,iBAAiB,OAAO;AAC1B,iBAAK,GAAG,IAAI,MAAM,SAAS;AAAA,UAC/B;AAAA,QACJ,CAAC;AACD,kBAAU,WAAW;AAAA,MACzB;AAEA,WAAK,IAAI,UAAU,SAAS,SAAS;AAAA,IACzC;AAAA,IAEQ,cAAc,WAAqB,iBAAiC;AACxE,YAAM,cAAc,UAAU,UAAU,OAAK,EAAE,WAAW,UAAU,CAAC;AACrE,YAAM,cAAc,UAAU,UAAU,OAAK,EAAE,WAAW,UAAU,CAAC;AACrE,YAAM,MAAM,gBAAgB,KAAK,cAAc;AAE/C,UAAI,QAAQ,MAAM,UAAU,MAAM,CAAC,GAAG;AAClC,cAAM,OAAO,UAAU,MAAM,CAAC;AAC9B,YAAI,KAAK,SAAS,IAAI,GAAG;AACrB,gBAAM,MAAM,SAAS,IAAI;AACzB,cAAI,CAAC,MAAM,GAAG;AAAG,mBAAO;AAAA,QAC5B;AAAA,MACJ;AAGA,YAAM,MAAM,UAAU,GAAG;AACzB,UAAI,OAAO,IAAI,SAAS,GAAG,GAAG;AAC1B,cAAM,QAAQ,IAAI,MAAM,GAAG;AAC3B,cAAM,MAAM,SAAS,MAAM,CAAC,CAAC;AAC7B,YAAI,CAAC,MAAM,GAAG;AAAG,iBAAO;AAAA,MAC5B;AAEA,aAAO;AAAA,IACX;AAAA,IAEQ,YAAY,SAA8B;AAC9C,UAAI,CAAC,QAAQ,IAAI;AACb,gBAAQ,KAAK,gBAAgB,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC;AAAA,MACvE;AACA,aAAO,QAAQ;AAAA,IACnB;AAAA,IAEQ,QAAQ,SAA2C;AACvD,YAAM,OAAgC,CAAC;AACvC,UAAI,mBAAmB,aAAa;AAChC,mBAAW,OAAO,QAAQ,SAAS;AAC/B,cAAI,IAAI,WAAW,KAAK,GAAG;AACvB,gBAAI;AACA,mBAAK,GAAG,IAAI,KAAK,MAAM,QAAQ,QAAQ,GAAG,KAAK,MAAM;AAAA,YACzD,SAAS,GAAG;AACR,mBAAK,GAAG,IAAI,QAAQ,QAAQ,GAAG;AAAA,YACnC;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AACA,aAAO;AAAA,IACX;AAAA,EACJ;;;ACtXA,MAAMC,kBAA+B;AAAA,IACjC,UAAU;AAAA,IACV,oBAAoB;AAAA,IACpB,iBAAiB;AAAA,IACjB,YAAY;AAAA,IACZ,OAAO;AAAA,EACX;AAOO,MAAM,YAAN,MAAgB;AAAA,IAWnB,YAAY,SAAgC,CAAC,GAAG;AAPhD,WAAU,cAAc;AAExB,WAAU,eAAyB,CAAC;AACpC,WAAU,cAAwB,CAAC;AACnC,WAAU,cAAc;AACxB,WAAU,cAAc;AAGpB,WAAK,SAAS,EAAE,GAAGA,iBAAgB,GAAG,OAAO;AAC7C,WAAK,YAAY,IAAI,iBAAiB,KAAK,MAAM;AACjD,WAAK,UAAU,IAAI,WAAW,KAAK,OAAO,KAAK;AAC/C,WAAK,eAAe,IAAI,oBAAoB,IAAI;AAAA,IACpD;AAAA,IAEA,YAA0B;AACtB,aAAO,KAAK;AAAA,IAChB;AAAA;AAAA;AAAA;AAAA,IAKA,MAAM,OAAsB;AACxB,UAAI,KAAK;AAAa;AACtB,WAAK,cAAc;AAGnB,WAAK,UAAU,UAAU,CAAC,QAAQ,KAAK,cAAc,GAAG,CAAC;AACzD,WAAK,UAAU,eAAe,CAAC,cAAc,KAAK,mBAAmB,SAAS,CAAC;AAG/E,UAAI;AACA,cAAM,KAAK,UAAU,QAAQ;AAAA,MACjC,SAAS,GAAG;AACR,gBAAQ,MAAM,8BAA8B,CAAC;AAAA,MACjD;AAGA,WAAK,gBAAgB;AACrB,WAAK,mBAAmB;AAGxB,WAAK,aAAa,KAAK;AAEvB,cAAQ,IAAI,mCAAmC,KAAK,UAAU,mBAAmB,CAAC,gBAAgB,KAAK,aAAa,MAAM,WAAW,KAAK,WAAW,GAAG;AAAA,IAC5J;AAAA;AAAA;AAAA;AAAA,IAKU,mBAAmB,WAA0B;AACnD,WAAK,cAAc;AAAA,IAEvB;AAAA;AAAA;AAAA;AAAA,IAKU,kBAAwB;AAC9B,YAAM,aAAa,SAAS,eAAe,kBAAkB;AAC7D,UAAI,YAAY;AACZ,YAAI;AACA,gBAAM,OAAO,KAAK,MAAM,WAAW,eAAe,IAAI;AACtD,eAAK,eAAe,KAAK,iBAAiB,CAAC;AAC3C,eAAK,cAAc,CAAC,CAAC,KAAK;AAC1B,cAAI,KAAK,UAAU,QAAW;AAC1B,iBAAK,OAAO,QAAQ,CAAC,CAAC,KAAK;AAAA,UAC/B;AAEA,eAAK,cAAc,KAAK,aAAa,IAAI,OAAK,KAAK,eAAe,CAAC,CAAC;AAAA,QACxE,SAAS,GAAG;AACR,kBAAQ,KAAK,wCAAwC,CAAC;AAAA,QAC1D;AAAA,MACJ;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKU,eAAe,SAAyB;AAE9C,UAAI,QAAQ,QAAQ,QAAQ,sBAAsB,MAAM;AAExD,cAAQ,MAAM,QAAQ,oBAAoB,SAAS;AAEnD,cAAQ,MAAM,QAAQ,yBAAyB,SAAS;AACxD,aAAO,IAAI,OAAO,IAAI,KAAK,GAAG;AAAA,IAClC;AAAA;AAAA;AAAA;AAAA,IAKU,cAAc,MAAuB;AAC3C,aAAO,KAAK,YAAY,KAAK,WAAS,MAAM,KAAK,IAAI,CAAC;AAAA,IAC1D;AAAA;AAAA;AAAA;AAAA,IAKU,qBAA2B;AAEjC,aAAO,iBAAiB,YAAY,MAAM;AACtC,aAAK,aAAa,OAAO,SAAS,WAAW,OAAO,SAAS,MAAM;AAAA,MACvE,CAAC;AAED,UAAI,KAAK,aAAa,WAAW,KAAK,CAAC,KAAK;AAAa;AAGzD,eAAS,iBAAiB,SAAS,CAAC,MAAM;AACtC,cAAM,OAAQ,EAAE,OAAmB,QAAQ,SAAS;AACpD,YAAI,CAAC;AAAM;AAGX,YAAI,KAAK,WAAW,OAAO,SAAS;AAAQ;AAG5C,YAAI,KAAK,aAAa,UAAU,KAAK,KAAK,WAAW;AAAU;AAG/D,YAAI,kBAAkB;AAEtB,YAAI,KAAK,aAAa;AAClB,4BAAkB;AAAA,QACtB,WAAW,KAAK,cAAc,KAAK,QAAQ,GAAG;AAC1C,4BAAkB;AAAA,QACtB;AAEA,YAAI,iBAAiB;AACjB,YAAE,eAAe;AACjB,eAAK,WAAW,KAAK,WAAW,KAAK,MAAM;AAAA,QAC/C;AAAA,MACJ,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKA,WAAW,MAAoB;AAC3B,UAAI,CAAC,KAAK,aAAa;AACnB,gBAAQ,KAAK,sCAAsC;AACnD;AAAA,MACJ;AAEA,cAAQ,UAAU,CAAC,GAAG,IAAI,IAAI;AAC9B,WAAK,aAAa,IAAI;AAAA,IAC1B;AAAA;AAAA;AAAA;AAAA,IAKU,aAAa,MAAoB;AACvC,YAAM,UAA2B;AAAA,QAC7B,MAAM;AAAA,QACN;AAAA,MACJ;AACA,WAAK,UAAU,KAAK,OAAO;AAAA,IAC/B;AAAA;AAAA;AAAA;AAAA,IAKA,UAAU,SAAiB,MAAuB;AAC9C,YAAM,UAAyB;AAAA,QAC3B,MAAM;AAAA,QACN;AAAA,QACA,MAAM,OAAO,SAAS,WAAW,OAAO,SAAS;AAAA,QACjD;AAAA,MACJ;AACA,WAAK,UAAU,KAAK,OAAO;AAAA,IAC/B;AAAA;AAAA;AAAA;AAAA,IAKA,MAAgB,cAAc,KAAmC;AAC7D,cAAQ,IAAI,MAAM;AAAA,QACd,KAAK;AACD,cAAI,IAAI,MAAM;AACV,iBAAK,QAAQ,OAAO,IAAI,IAAI;AAAA,UAChC;AACA;AAAA,QAEJ,KAAK;AACD,kBAAQ,IAAI,sBAAsB;AAClC,iBAAO,SAAS,OAAO;AACvB;AAAA,QAEJ,KAAK;AACD,kBAAQ,MAAM,yBAAyB,IAAI,KAAK;AAChD;AAAA,QAEJ,KAAK;AAED,kBAAQ,MAAM,kBAAkB,IAAI,KAAK;AACzC;AAAA,QAEJ,KAAK;AACD,cAAI,IAAI,SAAS,IAAI,MAAM,SAAS,GAAG;AACnC,kBAAM,SAAS;AACf,kBAAM,SAAS,IAAI,MAAM,KAAK,IAAI;AAClC,gBAAI,IAAI,UAAU,SAAS;AACvB,sBAAQ,MAAM,QAAQ,MAAM;AAAA,YAChC,WAAW,IAAI,UAAU,QAAQ;AAC7B,sBAAQ,KAAK,QAAQ,MAAM;AAAA,YAC/B,OAAO;AACH,sBAAQ,IAAI,QAAQ,MAAM;AAAA,YAC9B;AAAA,UACJ;AACA;AAAA,QAEJ;AACI,kBAAQ,KAAK,gCAAgC,GAAG;AAAA,MACxD;AAAA,IACJ;AAAA;AAAA;AAAA;AAAA,IAKA,eAA8B;AAC1B,aAAO,KAAK,UAAU,mBAAmB;AAAA,IAC7C;AAAA;AAAA;AAAA;AAAA,IAKA,aAAmB;AACf,WAAK,UAAU,WAAW;AAAA,IAC9B;AAAA,EACJ;;;AtBnPA,MAAM,MAAM,IAAI,UAAU;AAE1B,MAAI,SAAS,eAAe,WAAW;AACnC,aAAS,iBAAiB,oBAAoB,MAAM,IAAI,KAAK,CAAC;AAAA,EAClE,OAAO;AACH,QAAI,KAAK;AAAA,EACb;",
  "names": ["encode", "decode", "size", "morphAttrs", "morphdom", "childrenOnly", "app", "DEFAULT_CONFIG"]
}
